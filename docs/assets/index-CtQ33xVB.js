var Dn=Object.defineProperty;var xn=(l,g,P)=>g in l?Dn(l,g,{enumerable:!0,configurable:!0,writable:!0,value:P}):l[g]=P;var U=(l,g,P)=>xn(l,typeof g!="symbol"?g+"":g,P);(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const z of document.querySelectorAll('link[rel="modulepreload"]'))B(z);new MutationObserver(z=>{for(const V of z)if(V.type==="childList")for(const I of V.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&B(I)}).observe(document,{childList:!0,subtree:!0});function P(z){const V={};return z.integrity&&(V.integrity=z.integrity),z.referrerPolicy&&(V.referrerPolicy=z.referrerPolicy),z.crossOrigin==="use-credentials"?V.credentials="include":z.crossOrigin==="anonymous"?V.credentials="omit":V.credentials="same-origin",V}function B(z){if(z.ep)return;z.ep=!0;const V=P(z);fetch(z.href,V)}})();function yn(l,g){return class extends l{constructor(...P){super(...P),g(this)}}}const mn=yn(Array,l=>l.fill(0));let E=1e-6;function An(l){const g=E;return E=l,g}function Pn(l){return l*Math.PI/180}function Bn(l){return l*180/Math.PI}function zn(l,g,P){return l+(g-l)*P}function Sn(l,g,P){const B=g-l;return Math.abs(g-l)<E?l:(P-l)/B}function vn(l,g){return(l%g+g)%g}var Wt={__proto__:null,get EPSILON(){return E},degToRad:Pn,euclideanModulo:vn,inverseLerp:Sn,lerp:zn,radToDeg:Bn,setEpsilon:An};function Tn(l){function g(t=0,r=0){const n=new l(2);return t!==void 0&&(n[0]=t,r!==void 0&&(n[1]=r)),n}const P=g;function B(t,r,n){const s=n??new l(2);return s[0]=t,s[1]=r,s}function z(t,r){const n=r??new l(2);return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n}function V(t,r){const n=r??new l(2);return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n}function I(t,r){const n=r??new l(2);return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n}function F(t,r=0,n=1,s){const u=s??new l(2);return u[0]=Math.min(n,Math.max(r,t[0])),u[1]=Math.min(n,Math.max(r,t[1])),u}function Y(t,r,n){const s=n??new l(2);return s[0]=t[0]+r[0],s[1]=t[1]+r[1],s}function j(t,r,n,s){const u=s??new l(2);return u[0]=t[0]+r[0]*n,u[1]=t[1]+r[1]*n,u}function $(t,r){const n=t[0],s=t[1],u=r[0],p=r[1],y=Math.sqrt(n*n+s*s),i=Math.sqrt(u*u+p*p),a=y*i,d=a&&dt(t,r)/a;return Math.acos(d)}function R(t,r,n){const s=n??new l(2);return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s}const k=R;function Q(t,r){return Math.abs(t[0]-r[0])<E&&Math.abs(t[1]-r[1])<E}function b(t,r){return t[0]===r[0]&&t[1]===r[1]}function C(t,r,n,s){const u=s??new l(2);return u[0]=t[0]+n*(r[0]-t[0]),u[1]=t[1]+n*(r[1]-t[1]),u}function lt(t,r,n,s){const u=s??new l(2);return u[0]=t[0]+n[0]*(r[0]-t[0]),u[1]=t[1]+n[1]*(r[1]-t[1]),u}function Bt(t,r,n){const s=n??new l(2);return s[0]=Math.max(t[0],r[0]),s[1]=Math.max(t[1],r[1]),s}function st(t,r,n){const s=n??new l(2);return s[0]=Math.min(t[0],r[0]),s[1]=Math.min(t[1],r[1]),s}function tt(t,r,n){const s=n??new l(2);return s[0]=t[0]*r,s[1]=t[1]*r,s}const zt=tt;function ht(t,r,n){const s=n??new l(2);return s[0]=t[0]/r,s[1]=t[1]/r,s}function ot(t,r){const n=r??new l(2);return n[0]=1/t[0],n[1]=1/t[1],n}const St=ot;function wt(t,r,n){const s=n??new l(3),u=t[0]*r[1]-t[1]*r[0];return s[0]=0,s[1]=0,s[2]=u,s}function dt(t,r){return t[0]*r[0]+t[1]*r[1]}function W(t){const r=t[0],n=t[1];return Math.sqrt(r*r+n*n)}const mt=W;function O(t){const r=t[0],n=t[1];return r*r+n*n}const X=O;function _(t,r){const n=t[0]-r[0],s=t[1]-r[1];return Math.sqrt(n*n+s*s)}const Et=_;function pt(t,r){const n=t[0]-r[0],s=t[1]-r[1];return n*n+s*s}const Gt=pt;function Mt(t,r){const n=r??new l(2),s=t[0],u=t[1],p=Math.sqrt(s*s+u*u);return p>1e-5?(n[0]=s/p,n[1]=u/p):(n[0]=0,n[1]=0),n}function _t(t,r){const n=r??new l(2);return n[0]=-t[0],n[1]=-t[1],n}function N(t,r){const n=r??new l(2);return n[0]=t[0],n[1]=t[1],n}const Ot=N;function At(t,r,n){const s=n??new l(2);return s[0]=t[0]*r[0],s[1]=t[1]*r[1],s}const Lt=At;function Pt(t,r,n){const s=n??new l(2);return s[0]=t[0]/r[0],s[1]=t[1]/r[1],s}const qt=Pt;function vt(t=1,r){const n=r??new l(2),s=Math.random()*2*Math.PI;return n[0]=Math.cos(s)*t,n[1]=Math.sin(s)*t,n}function o(t){const r=t??new l(2);return r[0]=0,r[1]=0,r}function h(t,r,n){const s=n??new l(2),u=t[0],p=t[1];return s[0]=u*r[0]+p*r[4]+r[12],s[1]=u*r[1]+p*r[5]+r[13],s}function e(t,r,n){const s=n??new l(2),u=t[0],p=t[1];return s[0]=r[0]*u+r[4]*p+r[8],s[1]=r[1]*u+r[5]*p+r[9],s}function c(t,r,n,s){const u=s??new l(2),p=t[0]-r[0],y=t[1]-r[1],i=Math.sin(n),a=Math.cos(n);return u[0]=p*a-y*i+r[0],u[1]=p*i+y*a+r[1],u}function f(t,r,n){const s=n??new l(2);return Mt(t,s),tt(s,r,s)}function w(t,r,n){const s=n??new l(2);return W(t)>r?f(t,r,s):N(t,s)}function x(t,r,n){const s=n??new l(2);return C(t,r,.5,s)}return{create:g,fromValues:P,set:B,ceil:z,floor:V,round:I,clamp:F,add:Y,addScaled:j,angle:$,subtract:R,sub:k,equalsApproximately:Q,equals:b,lerp:C,lerpV:lt,max:Bt,min:st,mulScalar:tt,scale:zt,divScalar:ht,inverse:ot,invert:St,cross:wt,dot:dt,length:W,len:mt,lengthSq:O,lenSq:X,distance:_,dist:Et,distanceSq:pt,distSq:Gt,normalize:Mt,negate:_t,copy:N,clone:Ot,multiply:At,mul:Lt,divide:Pt,div:qt,random:vt,zero:o,transformMat4:h,transformMat3:e,rotate:c,setLength:f,truncate:w,midpoint:x}}const on=new Map;function wn(l){let g=on.get(l);return g||(g=Tn(l),on.set(l,g)),g}function Un(l){function g(i,a,d){const M=new l(3);return i!==void 0&&(M[0]=i,a!==void 0&&(M[1]=a,d!==void 0&&(M[2]=d))),M}const P=g;function B(i,a,d,M){const D=M??new l(3);return D[0]=i,D[1]=a,D[2]=d,D}function z(i,a){const d=a??new l(3);return d[0]=Math.ceil(i[0]),d[1]=Math.ceil(i[1]),d[2]=Math.ceil(i[2]),d}function V(i,a){const d=a??new l(3);return d[0]=Math.floor(i[0]),d[1]=Math.floor(i[1]),d[2]=Math.floor(i[2]),d}function I(i,a){const d=a??new l(3);return d[0]=Math.round(i[0]),d[1]=Math.round(i[1]),d[2]=Math.round(i[2]),d}function F(i,a=0,d=1,M){const D=M??new l(3);return D[0]=Math.min(d,Math.max(a,i[0])),D[1]=Math.min(d,Math.max(a,i[1])),D[2]=Math.min(d,Math.max(a,i[2])),D}function Y(i,a,d){const M=d??new l(3);return M[0]=i[0]+a[0],M[1]=i[1]+a[1],M[2]=i[2]+a[2],M}function j(i,a,d,M){const D=M??new l(3);return D[0]=i[0]+a[0]*d,D[1]=i[1]+a[1]*d,D[2]=i[2]+a[2]*d,D}function $(i,a){const d=i[0],M=i[1],D=i[2],m=a[0],A=a[1],v=a[2],q=Math.sqrt(d*d+M*M+D*D),S=Math.sqrt(m*m+A*A+v*v),T=q*S,G=T&&dt(i,a)/T;return Math.acos(G)}function R(i,a,d){const M=d??new l(3);return M[0]=i[0]-a[0],M[1]=i[1]-a[1],M[2]=i[2]-a[2],M}const k=R;function Q(i,a){return Math.abs(i[0]-a[0])<E&&Math.abs(i[1]-a[1])<E&&Math.abs(i[2]-a[2])<E}function b(i,a){return i[0]===a[0]&&i[1]===a[1]&&i[2]===a[2]}function C(i,a,d,M){const D=M??new l(3);return D[0]=i[0]+d*(a[0]-i[0]),D[1]=i[1]+d*(a[1]-i[1]),D[2]=i[2]+d*(a[2]-i[2]),D}function lt(i,a,d,M){const D=M??new l(3);return D[0]=i[0]+d[0]*(a[0]-i[0]),D[1]=i[1]+d[1]*(a[1]-i[1]),D[2]=i[2]+d[2]*(a[2]-i[2]),D}function Bt(i,a,d){const M=d??new l(3);return M[0]=Math.max(i[0],a[0]),M[1]=Math.max(i[1],a[1]),M[2]=Math.max(i[2],a[2]),M}function st(i,a,d){const M=d??new l(3);return M[0]=Math.min(i[0],a[0]),M[1]=Math.min(i[1],a[1]),M[2]=Math.min(i[2],a[2]),M}function tt(i,a,d){const M=d??new l(3);return M[0]=i[0]*a,M[1]=i[1]*a,M[2]=i[2]*a,M}const zt=tt;function ht(i,a,d){const M=d??new l(3);return M[0]=i[0]/a,M[1]=i[1]/a,M[2]=i[2]/a,M}function ot(i,a){const d=a??new l(3);return d[0]=1/i[0],d[1]=1/i[1],d[2]=1/i[2],d}const St=ot;function wt(i,a,d){const M=d??new l(3),D=i[2]*a[0]-i[0]*a[2],m=i[0]*a[1]-i[1]*a[0];return M[0]=i[1]*a[2]-i[2]*a[1],M[1]=D,M[2]=m,M}function dt(i,a){return i[0]*a[0]+i[1]*a[1]+i[2]*a[2]}function W(i){const a=i[0],d=i[1],M=i[2];return Math.sqrt(a*a+d*d+M*M)}const mt=W;function O(i){const a=i[0],d=i[1],M=i[2];return a*a+d*d+M*M}const X=O;function _(i,a){const d=i[0]-a[0],M=i[1]-a[1],D=i[2]-a[2];return Math.sqrt(d*d+M*M+D*D)}const Et=_;function pt(i,a){const d=i[0]-a[0],M=i[1]-a[1],D=i[2]-a[2];return d*d+M*M+D*D}const Gt=pt;function Mt(i,a){const d=a??new l(3),M=i[0],D=i[1],m=i[2],A=Math.sqrt(M*M+D*D+m*m);return A>1e-5?(d[0]=M/A,d[1]=D/A,d[2]=m/A):(d[0]=0,d[1]=0,d[2]=0),d}function _t(i,a){const d=a??new l(3);return d[0]=-i[0],d[1]=-i[1],d[2]=-i[2],d}function N(i,a){const d=a??new l(3);return d[0]=i[0],d[1]=i[1],d[2]=i[2],d}const Ot=N;function At(i,a,d){const M=d??new l(3);return M[0]=i[0]*a[0],M[1]=i[1]*a[1],M[2]=i[2]*a[2],M}const Lt=At;function Pt(i,a,d){const M=d??new l(3);return M[0]=i[0]/a[0],M[1]=i[1]/a[1],M[2]=i[2]/a[2],M}const qt=Pt;function vt(i=1,a){const d=a??new l(3),M=Math.random()*2*Math.PI,D=Math.random()*2-1,m=Math.sqrt(1-D*D)*i;return d[0]=Math.cos(M)*m,d[1]=Math.sin(M)*m,d[2]=D*i,d}function o(i){const a=i??new l(3);return a[0]=0,a[1]=0,a[2]=0,a}function h(i,a,d){const M=d??new l(3),D=i[0],m=i[1],A=i[2],v=a[3]*D+a[7]*m+a[11]*A+a[15]||1;return M[0]=(a[0]*D+a[4]*m+a[8]*A+a[12])/v,M[1]=(a[1]*D+a[5]*m+a[9]*A+a[13])/v,M[2]=(a[2]*D+a[6]*m+a[10]*A+a[14])/v,M}function e(i,a,d){const M=d??new l(3),D=i[0],m=i[1],A=i[2];return M[0]=D*a[0*4+0]+m*a[1*4+0]+A*a[2*4+0],M[1]=D*a[0*4+1]+m*a[1*4+1]+A*a[2*4+1],M[2]=D*a[0*4+2]+m*a[1*4+2]+A*a[2*4+2],M}function c(i,a,d){const M=d??new l(3),D=i[0],m=i[1],A=i[2];return M[0]=D*a[0]+m*a[4]+A*a[8],M[1]=D*a[1]+m*a[5]+A*a[9],M[2]=D*a[2]+m*a[6]+A*a[10],M}function f(i,a,d){const M=d??new l(3),D=a[0],m=a[1],A=a[2],v=a[3]*2,q=i[0],S=i[1],T=i[2],G=m*T-A*S,L=A*q-D*T,H=D*S-m*q;return M[0]=q+G*v+(m*H-A*L)*2,M[1]=S+L*v+(A*G-D*H)*2,M[2]=T+H*v+(D*L-m*G)*2,M}function w(i,a){const d=a??new l(3);return d[0]=i[12],d[1]=i[13],d[2]=i[14],d}function x(i,a,d){const M=d??new l(3),D=a*4;return M[0]=i[D+0],M[1]=i[D+1],M[2]=i[D+2],M}function t(i,a){const d=a??new l(3),M=i[0],D=i[1],m=i[2],A=i[4],v=i[5],q=i[6],S=i[8],T=i[9],G=i[10];return d[0]=Math.sqrt(M*M+D*D+m*m),d[1]=Math.sqrt(A*A+v*v+q*q),d[2]=Math.sqrt(S*S+T*T+G*G),d}function r(i,a,d,M){const D=M??new l(3),m=[],A=[];return m[0]=i[0]-a[0],m[1]=i[1]-a[1],m[2]=i[2]-a[2],A[0]=m[0],A[1]=m[1]*Math.cos(d)-m[2]*Math.sin(d),A[2]=m[1]*Math.sin(d)+m[2]*Math.cos(d),D[0]=A[0]+a[0],D[1]=A[1]+a[1],D[2]=A[2]+a[2],D}function n(i,a,d,M){const D=M??new l(3),m=[],A=[];return m[0]=i[0]-a[0],m[1]=i[1]-a[1],m[2]=i[2]-a[2],A[0]=m[2]*Math.sin(d)+m[0]*Math.cos(d),A[1]=m[1],A[2]=m[2]*Math.cos(d)-m[0]*Math.sin(d),D[0]=A[0]+a[0],D[1]=A[1]+a[1],D[2]=A[2]+a[2],D}function s(i,a,d,M){const D=M??new l(3),m=[],A=[];return m[0]=i[0]-a[0],m[1]=i[1]-a[1],m[2]=i[2]-a[2],A[0]=m[0]*Math.cos(d)-m[1]*Math.sin(d),A[1]=m[0]*Math.sin(d)+m[1]*Math.cos(d),A[2]=m[2],D[0]=A[0]+a[0],D[1]=A[1]+a[1],D[2]=A[2]+a[2],D}function u(i,a,d){const M=d??new l(3);return Mt(i,M),tt(M,a,M)}function p(i,a,d){const M=d??new l(3);return W(i)>a?u(i,a,M):N(i,M)}function y(i,a,d){const M=d??new l(3);return C(i,a,.5,M)}return{create:g,fromValues:P,set:B,ceil:z,floor:V,round:I,clamp:F,add:Y,addScaled:j,angle:$,subtract:R,sub:k,equalsApproximately:Q,equals:b,lerp:C,lerpV:lt,max:Bt,min:st,mulScalar:tt,scale:zt,divScalar:ht,inverse:ot,invert:St,cross:wt,dot:dt,length:W,len:mt,lengthSq:O,lenSq:X,distance:_,dist:Et,distanceSq:pt,distSq:Gt,normalize:Mt,negate:_t,copy:N,clone:Ot,multiply:At,mul:Lt,divide:Pt,div:qt,random:vt,zero:o,transformMat4:h,transformMat4Upper3x3:e,transformMat3:c,transformQuat:f,getTranslation:w,getAxis:x,getScaling:t,rotateX:r,rotateY:n,rotateZ:s,setLength:u,truncate:p,midpoint:y}}const cn=new Map;function kt(l){let g=cn.get(l);return g||(g=Un(l),cn.set(l,g)),g}function Vn(l){const g=wn(l),P=kt(l);function B(o,h,e,c,f,w,x,t,r){const n=new l(12);return n[3]=0,n[7]=0,n[11]=0,o!==void 0&&(n[0]=o,h!==void 0&&(n[1]=h,e!==void 0&&(n[2]=e,c!==void 0&&(n[4]=c,f!==void 0&&(n[5]=f,w!==void 0&&(n[6]=w,x!==void 0&&(n[8]=x,t!==void 0&&(n[9]=t,r!==void 0&&(n[10]=r))))))))),n}function z(o,h,e,c,f,w,x,t,r,n){const s=n??new l(12);return s[0]=o,s[1]=h,s[2]=e,s[3]=0,s[4]=c,s[5]=f,s[6]=w,s[7]=0,s[8]=x,s[9]=t,s[10]=r,s[11]=0,s}function V(o,h){const e=h??new l(12);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=0,e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=0,e[8]=o[8],e[9]=o[9],e[10]=o[10],e[11]=0,e}function I(o,h){const e=h??new l(12),c=o[0],f=o[1],w=o[2],x=o[3],t=c+c,r=f+f,n=w+w,s=c*t,u=f*t,p=f*r,y=w*t,i=w*r,a=w*n,d=x*t,M=x*r,D=x*n;return e[0]=1-p-a,e[1]=u+D,e[2]=y-M,e[3]=0,e[4]=u-D,e[5]=1-s-a,e[6]=i+d,e[7]=0,e[8]=y+M,e[9]=i-d,e[10]=1-s-p,e[11]=0,e}function F(o,h){const e=h??new l(12);return e[0]=-o[0],e[1]=-o[1],e[2]=-o[2],e[4]=-o[4],e[5]=-o[5],e[6]=-o[6],e[8]=-o[8],e[9]=-o[9],e[10]=-o[10],e}function Y(o,h){const e=h??new l(12);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[8]=o[8],e[9]=o[9],e[10]=o[10],e}const j=Y;function $(o,h){return Math.abs(o[0]-h[0])<E&&Math.abs(o[1]-h[1])<E&&Math.abs(o[2]-h[2])<E&&Math.abs(o[4]-h[4])<E&&Math.abs(o[5]-h[5])<E&&Math.abs(o[6]-h[6])<E&&Math.abs(o[8]-h[8])<E&&Math.abs(o[9]-h[9])<E&&Math.abs(o[10]-h[10])<E}function R(o,h){return o[0]===h[0]&&o[1]===h[1]&&o[2]===h[2]&&o[4]===h[4]&&o[5]===h[5]&&o[6]===h[6]&&o[8]===h[8]&&o[9]===h[9]&&o[10]===h[10]}function k(o){const h=o??new l(12);return h[0]=1,h[1]=0,h[2]=0,h[4]=0,h[5]=1,h[6]=0,h[8]=0,h[9]=0,h[10]=1,h}function Q(o,h){const e=h??new l(12);if(e===o){let p;return p=o[1],o[1]=o[4],o[4]=p,p=o[2],o[2]=o[8],o[8]=p,p=o[6],o[6]=o[9],o[9]=p,e}const c=o[0*4+0],f=o[0*4+1],w=o[0*4+2],x=o[1*4+0],t=o[1*4+1],r=o[1*4+2],n=o[2*4+0],s=o[2*4+1],u=o[2*4+2];return e[0]=c,e[1]=x,e[2]=n,e[4]=f,e[5]=t,e[6]=s,e[8]=w,e[9]=r,e[10]=u,e}function b(o,h){const e=h??new l(12),c=o[0*4+0],f=o[0*4+1],w=o[0*4+2],x=o[1*4+0],t=o[1*4+1],r=o[1*4+2],n=o[2*4+0],s=o[2*4+1],u=o[2*4+2],p=u*t-r*s,y=-u*x+r*n,i=s*x-t*n,a=1/(c*p+f*y+w*i);return e[0]=p*a,e[1]=(-u*f+w*s)*a,e[2]=(r*f-w*t)*a,e[4]=y*a,e[5]=(u*c-w*n)*a,e[6]=(-r*c+w*x)*a,e[8]=i*a,e[9]=(-s*c+f*n)*a,e[10]=(t*c-f*x)*a,e}function C(o){const h=o[0],e=o[0*4+1],c=o[0*4+2],f=o[1*4+0],w=o[1*4+1],x=o[1*4+2],t=o[2*4+0],r=o[2*4+1],n=o[2*4+2];return h*(w*n-r*x)-f*(e*n-r*c)+t*(e*x-w*c)}const lt=b;function Bt(o,h,e){const c=e??new l(12),f=o[0],w=o[1],x=o[2],t=o[4],r=o[5],n=o[6],s=o[8],u=o[9],p=o[10],y=h[0],i=h[1],a=h[2],d=h[4],M=h[5],D=h[6],m=h[8],A=h[9],v=h[10];return c[0]=f*y+t*i+s*a,c[1]=w*y+r*i+u*a,c[2]=x*y+n*i+p*a,c[4]=f*d+t*M+s*D,c[5]=w*d+r*M+u*D,c[6]=x*d+n*M+p*D,c[8]=f*m+t*A+s*v,c[9]=w*m+r*A+u*v,c[10]=x*m+n*A+p*v,c}const st=Bt;function tt(o,h,e){const c=e??k();return o!==c&&(c[0]=o[0],c[1]=o[1],c[2]=o[2],c[4]=o[4],c[5]=o[5],c[6]=o[6]),c[8]=h[0],c[9]=h[1],c[10]=1,c}function zt(o,h){const e=h??g.create();return e[0]=o[8],e[1]=o[9],e}function ht(o,h,e){const c=e??g.create(),f=h*4;return c[0]=o[f+0],c[1]=o[f+1],c}function ot(o,h,e,c){const f=c===o?o:Y(o,c),w=e*4;return f[w+0]=h[0],f[w+1]=h[1],f}function St(o,h){const e=h??g.create(),c=o[0],f=o[1],w=o[4],x=o[5];return e[0]=Math.sqrt(c*c+f*f),e[1]=Math.sqrt(w*w+x*x),e}function wt(o,h){const e=h??P.create(),c=o[0],f=o[1],w=o[2],x=o[4],t=o[5],r=o[6],n=o[8],s=o[9],u=o[10];return e[0]=Math.sqrt(c*c+f*f+w*w),e[1]=Math.sqrt(x*x+t*t+r*r),e[2]=Math.sqrt(n*n+s*s+u*u),e}function dt(o,h){const e=h??new l(12);return e[0]=1,e[1]=0,e[2]=0,e[4]=0,e[5]=1,e[6]=0,e[8]=o[0],e[9]=o[1],e[10]=1,e}function W(o,h,e){const c=e??new l(12),f=h[0],w=h[1],x=o[0],t=o[1],r=o[2],n=o[1*4+0],s=o[1*4+1],u=o[1*4+2],p=o[2*4+0],y=o[2*4+1],i=o[2*4+2];return o!==c&&(c[0]=x,c[1]=t,c[2]=r,c[4]=n,c[5]=s,c[6]=u),c[8]=x*f+n*w+p,c[9]=t*f+s*w+y,c[10]=r*f+u*w+i,c}function mt(o,h){const e=h??new l(12),c=Math.cos(o),f=Math.sin(o);return e[0]=c,e[1]=f,e[2]=0,e[4]=-f,e[5]=c,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function O(o,h,e){const c=e??new l(12),f=o[0*4+0],w=o[0*4+1],x=o[0*4+2],t=o[1*4+0],r=o[1*4+1],n=o[1*4+2],s=Math.cos(h),u=Math.sin(h);return c[0]=s*f+u*t,c[1]=s*w+u*r,c[2]=s*x+u*n,c[4]=s*t-u*f,c[5]=s*r-u*w,c[6]=s*n-u*x,o!==c&&(c[8]=o[8],c[9]=o[9],c[10]=o[10]),c}function X(o,h){const e=h??new l(12),c=Math.cos(o),f=Math.sin(o);return e[0]=1,e[1]=0,e[2]=0,e[4]=0,e[5]=c,e[6]=f,e[8]=0,e[9]=-f,e[10]=c,e}function _(o,h,e){const c=e??new l(12),f=o[4],w=o[5],x=o[6],t=o[8],r=o[9],n=o[10],s=Math.cos(h),u=Math.sin(h);return c[4]=s*f+u*t,c[5]=s*w+u*r,c[6]=s*x+u*n,c[8]=s*t-u*f,c[9]=s*r-u*w,c[10]=s*n-u*x,o!==c&&(c[0]=o[0],c[1]=o[1],c[2]=o[2]),c}function Et(o,h){const e=h??new l(12),c=Math.cos(o),f=Math.sin(o);return e[0]=c,e[1]=0,e[2]=-f,e[4]=0,e[5]=1,e[6]=0,e[8]=f,e[9]=0,e[10]=c,e}function pt(o,h,e){const c=e??new l(12),f=o[0*4+0],w=o[0*4+1],x=o[0*4+2],t=o[2*4+0],r=o[2*4+1],n=o[2*4+2],s=Math.cos(h),u=Math.sin(h);return c[0]=s*f-u*t,c[1]=s*w-u*r,c[2]=s*x-u*n,c[8]=s*t+u*f,c[9]=s*r+u*w,c[10]=s*n+u*x,o!==c&&(c[4]=o[4],c[5]=o[5],c[6]=o[6]),c}const Gt=mt,Mt=O;function _t(o,h){const e=h??new l(12);return e[0]=o[0],e[1]=0,e[2]=0,e[4]=0,e[5]=o[1],e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function N(o,h,e){const c=e??new l(12),f=h[0],w=h[1];return c[0]=f*o[0*4+0],c[1]=f*o[0*4+1],c[2]=f*o[0*4+2],c[4]=w*o[1*4+0],c[5]=w*o[1*4+1],c[6]=w*o[1*4+2],o!==c&&(c[8]=o[8],c[9]=o[9],c[10]=o[10]),c}function Ot(o,h){const e=h??new l(12);return e[0]=o[0],e[1]=0,e[2]=0,e[4]=0,e[5]=o[1],e[6]=0,e[8]=0,e[9]=0,e[10]=o[2],e}function At(o,h,e){const c=e??new l(12),f=h[0],w=h[1],x=h[2];return c[0]=f*o[0*4+0],c[1]=f*o[0*4+1],c[2]=f*o[0*4+2],c[4]=w*o[1*4+0],c[5]=w*o[1*4+1],c[6]=w*o[1*4+2],c[8]=x*o[2*4+0],c[9]=x*o[2*4+1],c[10]=x*o[2*4+2],c}function Lt(o,h){const e=h??new l(12);return e[0]=o,e[1]=0,e[2]=0,e[4]=0,e[5]=o,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function Pt(o,h,e){const c=e??new l(12);return c[0]=h*o[0*4+0],c[1]=h*o[0*4+1],c[2]=h*o[0*4+2],c[4]=h*o[1*4+0],c[5]=h*o[1*4+1],c[6]=h*o[1*4+2],o!==c&&(c[8]=o[8],c[9]=o[9],c[10]=o[10]),c}function qt(o,h){const e=h??new l(12);return e[0]=o,e[1]=0,e[2]=0,e[4]=0,e[5]=o,e[6]=0,e[8]=0,e[9]=0,e[10]=o,e}function vt(o,h,e){const c=e??new l(12);return c[0]=h*o[0*4+0],c[1]=h*o[0*4+1],c[2]=h*o[0*4+2],c[4]=h*o[1*4+0],c[5]=h*o[1*4+1],c[6]=h*o[1*4+2],c[8]=h*o[2*4+0],c[9]=h*o[2*4+1],c[10]=h*o[2*4+2],c}return{clone:j,create:B,set:z,fromMat4:V,fromQuat:I,negate:F,copy:Y,equalsApproximately:$,equals:R,identity:k,transpose:Q,inverse:b,invert:lt,determinant:C,mul:st,multiply:Bt,setTranslation:tt,getTranslation:zt,getAxis:ht,setAxis:ot,getScaling:St,get3DScaling:wt,translation:dt,translate:W,rotation:mt,rotate:O,rotationX:X,rotateX:_,rotationY:Et,rotateY:pt,rotationZ:Gt,rotateZ:Mt,scaling:_t,scale:N,uniformScaling:Lt,uniformScale:Pt,scaling3D:Ot,scale3D:At,uniformScaling3D:qt,uniformScale3D:vt}}const rn=new Map;function qn(l){let g=rn.get(l);return g||(g=Vn(l),rn.set(l,g)),g}function En(l){const g=kt(l);function P(t,r,n,s,u,p,y,i,a,d,M,D,m,A,v,q){const S=new l(16);return t!==void 0&&(S[0]=t,r!==void 0&&(S[1]=r,n!==void 0&&(S[2]=n,s!==void 0&&(S[3]=s,u!==void 0&&(S[4]=u,p!==void 0&&(S[5]=p,y!==void 0&&(S[6]=y,i!==void 0&&(S[7]=i,a!==void 0&&(S[8]=a,d!==void 0&&(S[9]=d,M!==void 0&&(S[10]=M,D!==void 0&&(S[11]=D,m!==void 0&&(S[12]=m,A!==void 0&&(S[13]=A,v!==void 0&&(S[14]=v,q!==void 0&&(S[15]=q)))))))))))))))),S}function B(t,r,n,s,u,p,y,i,a,d,M,D,m,A,v,q,S){const T=S??new l(16);return T[0]=t,T[1]=r,T[2]=n,T[3]=s,T[4]=u,T[5]=p,T[6]=y,T[7]=i,T[8]=a,T[9]=d,T[10]=M,T[11]=D,T[12]=m,T[13]=A,T[14]=v,T[15]=q,T}function z(t,r){const n=r??new l(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=0,n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=0,n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function V(t,r){const n=r??new l(16),s=t[0],u=t[1],p=t[2],y=t[3],i=s+s,a=u+u,d=p+p,M=s*i,D=u*i,m=u*a,A=p*i,v=p*a,q=p*d,S=y*i,T=y*a,G=y*d;return n[0]=1-m-q,n[1]=D+G,n[2]=A-T,n[3]=0,n[4]=D-G,n[5]=1-M-q,n[6]=v+S,n[7]=0,n[8]=A+T,n[9]=v-S,n[10]=1-M-m,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function I(t,r){const n=r??new l(16);return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n[4]=-t[4],n[5]=-t[5],n[6]=-t[6],n[7]=-t[7],n[8]=-t[8],n[9]=-t[9],n[10]=-t[10],n[11]=-t[11],n[12]=-t[12],n[13]=-t[13],n[14]=-t[14],n[15]=-t[15],n}function F(t,r){const n=r??new l(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}const Y=F;function j(t,r){return Math.abs(t[0]-r[0])<E&&Math.abs(t[1]-r[1])<E&&Math.abs(t[2]-r[2])<E&&Math.abs(t[3]-r[3])<E&&Math.abs(t[4]-r[4])<E&&Math.abs(t[5]-r[5])<E&&Math.abs(t[6]-r[6])<E&&Math.abs(t[7]-r[7])<E&&Math.abs(t[8]-r[8])<E&&Math.abs(t[9]-r[9])<E&&Math.abs(t[10]-r[10])<E&&Math.abs(t[11]-r[11])<E&&Math.abs(t[12]-r[12])<E&&Math.abs(t[13]-r[13])<E&&Math.abs(t[14]-r[14])<E&&Math.abs(t[15]-r[15])<E}function $(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]&&t[4]===r[4]&&t[5]===r[5]&&t[6]===r[6]&&t[7]===r[7]&&t[8]===r[8]&&t[9]===r[9]&&t[10]===r[10]&&t[11]===r[11]&&t[12]===r[12]&&t[13]===r[13]&&t[14]===r[14]&&t[15]===r[15]}function R(t){const r=t??new l(16);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function k(t,r){const n=r??new l(16);if(n===t){let L;return L=t[1],t[1]=t[4],t[4]=L,L=t[2],t[2]=t[8],t[8]=L,L=t[3],t[3]=t[12],t[12]=L,L=t[6],t[6]=t[9],t[9]=L,L=t[7],t[7]=t[13],t[13]=L,L=t[11],t[11]=t[14],t[14]=L,n}const s=t[0*4+0],u=t[0*4+1],p=t[0*4+2],y=t[0*4+3],i=t[1*4+0],a=t[1*4+1],d=t[1*4+2],M=t[1*4+3],D=t[2*4+0],m=t[2*4+1],A=t[2*4+2],v=t[2*4+3],q=t[3*4+0],S=t[3*4+1],T=t[3*4+2],G=t[3*4+3];return n[0]=s,n[1]=i,n[2]=D,n[3]=q,n[4]=u,n[5]=a,n[6]=m,n[7]=S,n[8]=p,n[9]=d,n[10]=A,n[11]=T,n[12]=y,n[13]=M,n[14]=v,n[15]=G,n}function Q(t,r){const n=r??new l(16),s=t[0*4+0],u=t[0*4+1],p=t[0*4+2],y=t[0*4+3],i=t[1*4+0],a=t[1*4+1],d=t[1*4+2],M=t[1*4+3],D=t[2*4+0],m=t[2*4+1],A=t[2*4+2],v=t[2*4+3],q=t[3*4+0],S=t[3*4+1],T=t[3*4+2],G=t[3*4+3],L=A*G,H=T*v,K=d*G,J=T*M,nt=d*v,ct=A*M,rt=p*G,it=T*y,ut=p*v,at=A*y,gt=p*M,Dt=d*y,xt=D*S,yt=q*m,Tt=i*S,Ut=q*a,Vt=i*m,$t=D*a,Nt=s*S,Rt=q*u,Ht=s*m,jt=D*u,Zt=s*a,Qt=i*u,tn=L*a+J*m+nt*S-(H*a+K*m+ct*S),nn=H*u+rt*m+at*S-(L*u+it*m+ut*S),en=K*u+it*a+gt*S-(J*u+rt*a+Dt*S),sn=ct*u+ut*a+Dt*m-(nt*u+at*a+gt*m),ft=1/(s*tn+i*nn+D*en+q*sn);return n[0]=ft*tn,n[1]=ft*nn,n[2]=ft*en,n[3]=ft*sn,n[4]=ft*(H*i+K*D+ct*q-(L*i+J*D+nt*q)),n[5]=ft*(L*s+it*D+ut*q-(H*s+rt*D+at*q)),n[6]=ft*(J*s+rt*i+Dt*q-(K*s+it*i+gt*q)),n[7]=ft*(nt*s+at*i+gt*D-(ct*s+ut*i+Dt*D)),n[8]=ft*(xt*M+Ut*v+Vt*G-(yt*M+Tt*v+$t*G)),n[9]=ft*(yt*y+Nt*v+jt*G-(xt*y+Rt*v+Ht*G)),n[10]=ft*(Tt*y+Rt*M+Zt*G-(Ut*y+Nt*M+Qt*G)),n[11]=ft*($t*y+Ht*M+Qt*v-(Vt*y+jt*M+Zt*v)),n[12]=ft*(Tt*A+$t*T+yt*d-(Vt*T+xt*d+Ut*A)),n[13]=ft*(Ht*T+xt*p+Rt*A-(Nt*A+jt*T+yt*p)),n[14]=ft*(Nt*d+Qt*T+Ut*p-(Zt*T+Tt*p+Rt*d)),n[15]=ft*(Zt*A+Vt*p+jt*d-(Ht*d+Qt*A+$t*p)),n}function b(t){const r=t[0],n=t[0*4+1],s=t[0*4+2],u=t[0*4+3],p=t[1*4+0],y=t[1*4+1],i=t[1*4+2],a=t[1*4+3],d=t[2*4+0],M=t[2*4+1],D=t[2*4+2],m=t[2*4+3],A=t[3*4+0],v=t[3*4+1],q=t[3*4+2],S=t[3*4+3],T=D*S,G=q*m,L=i*S,H=q*a,K=i*m,J=D*a,nt=s*S,ct=q*u,rt=s*m,it=D*u,ut=s*a,at=i*u,gt=T*y+H*M+K*v-(G*y+L*M+J*v),Dt=G*n+nt*M+it*v-(T*n+ct*M+rt*v),xt=L*n+ct*y+ut*v-(H*n+nt*y+at*v),yt=J*n+rt*y+at*M-(K*n+it*y+ut*M);return r*gt+p*Dt+d*xt+A*yt}const C=Q;function lt(t,r,n){const s=n??new l(16),u=t[0],p=t[1],y=t[2],i=t[3],a=t[4],d=t[5],M=t[6],D=t[7],m=t[8],A=t[9],v=t[10],q=t[11],S=t[12],T=t[13],G=t[14],L=t[15],H=r[0],K=r[1],J=r[2],nt=r[3],ct=r[4],rt=r[5],it=r[6],ut=r[7],at=r[8],gt=r[9],Dt=r[10],xt=r[11],yt=r[12],Tt=r[13],Ut=r[14],Vt=r[15];return s[0]=u*H+a*K+m*J+S*nt,s[1]=p*H+d*K+A*J+T*nt,s[2]=y*H+M*K+v*J+G*nt,s[3]=i*H+D*K+q*J+L*nt,s[4]=u*ct+a*rt+m*it+S*ut,s[5]=p*ct+d*rt+A*it+T*ut,s[6]=y*ct+M*rt+v*it+G*ut,s[7]=i*ct+D*rt+q*it+L*ut,s[8]=u*at+a*gt+m*Dt+S*xt,s[9]=p*at+d*gt+A*Dt+T*xt,s[10]=y*at+M*gt+v*Dt+G*xt,s[11]=i*at+D*gt+q*Dt+L*xt,s[12]=u*yt+a*Tt+m*Ut+S*Vt,s[13]=p*yt+d*Tt+A*Ut+T*Vt,s[14]=y*yt+M*Tt+v*Ut+G*Vt,s[15]=i*yt+D*Tt+q*Ut+L*Vt,s}const Bt=lt;function st(t,r,n){const s=n??R();return t!==s&&(s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11]),s[12]=r[0],s[13]=r[1],s[14]=r[2],s[15]=1,s}function tt(t,r){const n=r??g.create();return n[0]=t[12],n[1]=t[13],n[2]=t[14],n}function zt(t,r,n){const s=n??g.create(),u=r*4;return s[0]=t[u+0],s[1]=t[u+1],s[2]=t[u+2],s}function ht(t,r,n,s){const u=s===t?s:F(t,s),p=n*4;return u[p+0]=r[0],u[p+1]=r[1],u[p+2]=r[2],u}function ot(t,r){const n=r??g.create(),s=t[0],u=t[1],p=t[2],y=t[4],i=t[5],a=t[6],d=t[8],M=t[9],D=t[10];return n[0]=Math.sqrt(s*s+u*u+p*p),n[1]=Math.sqrt(y*y+i*i+a*a),n[2]=Math.sqrt(d*d+M*M+D*D),n}function St(t,r,n,s,u){const p=u??new l(16),y=Math.tan(Math.PI*.5-.5*t);if(p[0]=y/r,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=y,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,Number.isFinite(s)){const i=1/(n-s);p[10]=s*i,p[14]=s*n*i}else p[10]=-1,p[14]=-n;return p}function wt(t,r,n,s=1/0,u){const p=u??new l(16),y=1/Math.tan(t*.5);if(p[0]=y/r,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=y,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,s===1/0)p[10]=0,p[14]=n;else{const i=1/(s-n);p[10]=n*i,p[14]=s*n*i}return p}function dt(t,r,n,s,u,p,y){const i=y??new l(16);return i[0]=2/(r-t),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/(s-n),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1/(u-p),i[11]=0,i[12]=(r+t)/(t-r),i[13]=(s+n)/(n-s),i[14]=u/(u-p),i[15]=1,i}function W(t,r,n,s,u,p,y){const i=y??new l(16),a=r-t,d=s-n,M=u-p;return i[0]=2*u/a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*u/d,i[6]=0,i[7]=0,i[8]=(t+r)/a,i[9]=(s+n)/d,i[10]=p/M,i[11]=-1,i[12]=0,i[13]=0,i[14]=u*p/M,i[15]=0,i}function mt(t,r,n,s,u,p=1/0,y){const i=y??new l(16),a=r-t,d=s-n;if(i[0]=2*u/a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*u/d,i[6]=0,i[7]=0,i[8]=(t+r)/a,i[9]=(s+n)/d,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p===1/0)i[10]=0,i[14]=u;else{const M=1/(p-u);i[10]=u*M,i[14]=p*u*M}return i}const O=g.create(),X=g.create(),_=g.create();function Et(t,r,n,s){const u=s??new l(16);return g.normalize(g.subtract(r,t,_),_),g.normalize(g.cross(n,_,O),O),g.normalize(g.cross(_,O,X),X),u[0]=O[0],u[1]=O[1],u[2]=O[2],u[3]=0,u[4]=X[0],u[5]=X[1],u[6]=X[2],u[7]=0,u[8]=_[0],u[9]=_[1],u[10]=_[2],u[11]=0,u[12]=t[0],u[13]=t[1],u[14]=t[2],u[15]=1,u}function pt(t,r,n,s){const u=s??new l(16);return g.normalize(g.subtract(t,r,_),_),g.normalize(g.cross(n,_,O),O),g.normalize(g.cross(_,O,X),X),u[0]=O[0],u[1]=O[1],u[2]=O[2],u[3]=0,u[4]=X[0],u[5]=X[1],u[6]=X[2],u[7]=0,u[8]=_[0],u[9]=_[1],u[10]=_[2],u[11]=0,u[12]=t[0],u[13]=t[1],u[14]=t[2],u[15]=1,u}function Gt(t,r,n,s){const u=s??new l(16);return g.normalize(g.subtract(t,r,_),_),g.normalize(g.cross(n,_,O),O),g.normalize(g.cross(_,O,X),X),u[0]=O[0],u[1]=X[0],u[2]=_[0],u[3]=0,u[4]=O[1],u[5]=X[1],u[6]=_[1],u[7]=0,u[8]=O[2],u[9]=X[2],u[10]=_[2],u[11]=0,u[12]=-(O[0]*t[0]+O[1]*t[1]+O[2]*t[2]),u[13]=-(X[0]*t[0]+X[1]*t[1]+X[2]*t[2]),u[14]=-(_[0]*t[0]+_[1]*t[1]+_[2]*t[2]),u[15]=1,u}function Mt(t,r){const n=r??new l(16);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n}function _t(t,r,n){const s=n??new l(16),u=r[0],p=r[1],y=r[2],i=t[0],a=t[1],d=t[2],M=t[3],D=t[1*4+0],m=t[1*4+1],A=t[1*4+2],v=t[1*4+3],q=t[2*4+0],S=t[2*4+1],T=t[2*4+2],G=t[2*4+3],L=t[3*4+0],H=t[3*4+1],K=t[3*4+2],J=t[3*4+3];return t!==s&&(s[0]=i,s[1]=a,s[2]=d,s[3]=M,s[4]=D,s[5]=m,s[6]=A,s[7]=v,s[8]=q,s[9]=S,s[10]=T,s[11]=G),s[12]=i*u+D*p+q*y+L,s[13]=a*u+m*p+S*y+H,s[14]=d*u+A*p+T*y+K,s[15]=M*u+v*p+G*y+J,s}function N(t,r){const n=r??new l(16),s=Math.cos(t),u=Math.sin(t);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=u,n[7]=0,n[8]=0,n[9]=-u,n[10]=s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ot(t,r,n){const s=n??new l(16),u=t[4],p=t[5],y=t[6],i=t[7],a=t[8],d=t[9],M=t[10],D=t[11],m=Math.cos(r),A=Math.sin(r);return s[4]=m*u+A*a,s[5]=m*p+A*d,s[6]=m*y+A*M,s[7]=m*i+A*D,s[8]=m*a-A*u,s[9]=m*d-A*p,s[10]=m*M-A*y,s[11]=m*D-A*i,t!==s&&(s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s}function At(t,r){const n=r??new l(16),s=Math.cos(t),u=Math.sin(t);return n[0]=s,n[1]=0,n[2]=-u,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=u,n[9]=0,n[10]=s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Lt(t,r,n){const s=n??new l(16),u=t[0*4+0],p=t[0*4+1],y=t[0*4+2],i=t[0*4+3],a=t[2*4+0],d=t[2*4+1],M=t[2*4+2],D=t[2*4+3],m=Math.cos(r),A=Math.sin(r);return s[0]=m*u-A*a,s[1]=m*p-A*d,s[2]=m*y-A*M,s[3]=m*i-A*D,s[8]=m*a+A*u,s[9]=m*d+A*p,s[10]=m*M+A*y,s[11]=m*D+A*i,t!==s&&(s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s}function Pt(t,r){const n=r??new l(16),s=Math.cos(t),u=Math.sin(t);return n[0]=s,n[1]=u,n[2]=0,n[3]=0,n[4]=-u,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function qt(t,r,n){const s=n??new l(16),u=t[0*4+0],p=t[0*4+1],y=t[0*4+2],i=t[0*4+3],a=t[1*4+0],d=t[1*4+1],M=t[1*4+2],D=t[1*4+3],m=Math.cos(r),A=Math.sin(r);return s[0]=m*u+A*a,s[1]=m*p+A*d,s[2]=m*y+A*M,s[3]=m*i+A*D,s[4]=m*a-A*u,s[5]=m*d-A*p,s[6]=m*M-A*y,s[7]=m*D-A*i,t!==s&&(s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s}function vt(t,r,n){const s=n??new l(16);let u=t[0],p=t[1],y=t[2];const i=Math.sqrt(u*u+p*p+y*y);u/=i,p/=i,y/=i;const a=u*u,d=p*p,M=y*y,D=Math.cos(r),m=Math.sin(r),A=1-D;return s[0]=a+(1-a)*D,s[1]=u*p*A+y*m,s[2]=u*y*A-p*m,s[3]=0,s[4]=u*p*A-y*m,s[5]=d+(1-d)*D,s[6]=p*y*A+u*m,s[7]=0,s[8]=u*y*A+p*m,s[9]=p*y*A-u*m,s[10]=M+(1-M)*D,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}const o=vt;function h(t,r,n,s){const u=s??new l(16);let p=r[0],y=r[1],i=r[2];const a=Math.sqrt(p*p+y*y+i*i);p/=a,y/=a,i/=a;const d=p*p,M=y*y,D=i*i,m=Math.cos(n),A=Math.sin(n),v=1-m,q=d+(1-d)*m,S=p*y*v+i*A,T=p*i*v-y*A,G=p*y*v-i*A,L=M+(1-M)*m,H=y*i*v+p*A,K=p*i*v+y*A,J=y*i*v-p*A,nt=D+(1-D)*m,ct=t[0],rt=t[1],it=t[2],ut=t[3],at=t[4],gt=t[5],Dt=t[6],xt=t[7],yt=t[8],Tt=t[9],Ut=t[10],Vt=t[11];return u[0]=q*ct+S*at+T*yt,u[1]=q*rt+S*gt+T*Tt,u[2]=q*it+S*Dt+T*Ut,u[3]=q*ut+S*xt+T*Vt,u[4]=G*ct+L*at+H*yt,u[5]=G*rt+L*gt+H*Tt,u[6]=G*it+L*Dt+H*Ut,u[7]=G*ut+L*xt+H*Vt,u[8]=K*ct+J*at+nt*yt,u[9]=K*rt+J*gt+nt*Tt,u[10]=K*it+J*Dt+nt*Ut,u[11]=K*ut+J*xt+nt*Vt,t!==u&&(u[12]=t[12],u[13]=t[13],u[14]=t[14],u[15]=t[15]),u}const e=h;function c(t,r){const n=r??new l(16);return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function f(t,r,n){const s=n??new l(16),u=r[0],p=r[1],y=r[2];return s[0]=u*t[0*4+0],s[1]=u*t[0*4+1],s[2]=u*t[0*4+2],s[3]=u*t[0*4+3],s[4]=p*t[1*4+0],s[5]=p*t[1*4+1],s[6]=p*t[1*4+2],s[7]=p*t[1*4+3],s[8]=y*t[2*4+0],s[9]=y*t[2*4+1],s[10]=y*t[2*4+2],s[11]=y*t[2*4+3],t!==s&&(s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s}function w(t,r){const n=r??new l(16);return n[0]=t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function x(t,r,n){const s=n??new l(16);return s[0]=r*t[0*4+0],s[1]=r*t[0*4+1],s[2]=r*t[0*4+2],s[3]=r*t[0*4+3],s[4]=r*t[1*4+0],s[5]=r*t[1*4+1],s[6]=r*t[1*4+2],s[7]=r*t[1*4+3],s[8]=r*t[2*4+0],s[9]=r*t[2*4+1],s[10]=r*t[2*4+2],s[11]=r*t[2*4+3],t!==s&&(s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s}return{create:P,set:B,fromMat3:z,fromQuat:V,negate:I,copy:F,clone:Y,equalsApproximately:j,equals:$,identity:R,transpose:k,inverse:Q,determinant:b,invert:C,multiply:lt,mul:Bt,setTranslation:st,getTranslation:tt,getAxis:zt,setAxis:ht,getScaling:ot,perspective:St,perspectiveReverseZ:wt,ortho:dt,frustum:W,frustumReverseZ:mt,aim:Et,cameraAim:pt,lookAt:Gt,translation:Mt,translate:_t,rotationX:N,rotateX:Ot,rotationY:At,rotateY:Lt,rotationZ:Pt,rotateZ:qt,axisRotation:vt,rotation:o,axisRotate:h,rotate:e,scaling:c,scale:f,uniformScaling:w,uniformScale:x}}const un=new Map;function Gn(l){let g=un.get(l);return g||(g=En(l),un.set(l,g)),g}function _n(l){const g=kt(l);function P(o,h,e,c){const f=new l(4);return o!==void 0&&(f[0]=o,h!==void 0&&(f[1]=h,e!==void 0&&(f[2]=e,c!==void 0&&(f[3]=c)))),f}const B=P;function z(o,h,e,c,f){const w=f??new l(4);return w[0]=o,w[1]=h,w[2]=e,w[3]=c,w}function V(o,h,e){const c=e??new l(4),f=h*.5,w=Math.sin(f);return c[0]=w*o[0],c[1]=w*o[1],c[2]=w*o[2],c[3]=Math.cos(f),c}function I(o,h){const e=h??g.create(3),c=Math.acos(o[3])*2,f=Math.sin(c*.5);return f>E?(e[0]=o[0]/f,e[1]=o[1]/f,e[2]=o[2]/f):(e[0]=1,e[1]=0,e[2]=0),{angle:c,axis:e}}function F(o,h){const e=W(o,h);return Math.acos(2*e*e-1)}function Y(o,h,e){const c=e??new l(4),f=o[0],w=o[1],x=o[2],t=o[3],r=h[0],n=h[1],s=h[2],u=h[3];return c[0]=f*u+t*r+w*s-x*n,c[1]=w*u+t*n+x*r-f*s,c[2]=x*u+t*s+f*n-w*r,c[3]=t*u-f*r-w*n-x*s,c}const j=Y;function $(o,h,e){const c=e??new l(4),f=h*.5,w=o[0],x=o[1],t=o[2],r=o[3],n=Math.sin(f),s=Math.cos(f);return c[0]=w*s+r*n,c[1]=x*s+t*n,c[2]=t*s-x*n,c[3]=r*s-w*n,c}function R(o,h,e){const c=e??new l(4),f=h*.5,w=o[0],x=o[1],t=o[2],r=o[3],n=Math.sin(f),s=Math.cos(f);return c[0]=w*s-t*n,c[1]=x*s+r*n,c[2]=t*s+w*n,c[3]=r*s-x*n,c}function k(o,h,e){const c=e??new l(4),f=h*.5,w=o[0],x=o[1],t=o[2],r=o[3],n=Math.sin(f),s=Math.cos(f);return c[0]=w*s+x*n,c[1]=x*s-w*n,c[2]=t*s+r*n,c[3]=r*s-t*n,c}function Q(o,h,e,c){const f=c??new l(4),w=o[0],x=o[1],t=o[2],r=o[3];let n=h[0],s=h[1],u=h[2],p=h[3],y=w*n+x*s+t*u+r*p;y<0&&(y=-y,n=-n,s=-s,u=-u,p=-p);let i,a;if(1-y>E){const d=Math.acos(y),M=Math.sin(d);i=Math.sin((1-e)*d)/M,a=Math.sin(e*d)/M}else i=1-e,a=e;return f[0]=i*w+a*n,f[1]=i*x+a*s,f[2]=i*t+a*u,f[3]=i*r+a*p,f}function b(o,h){const e=h??new l(4),c=o[0],f=o[1],w=o[2],x=o[3],t=c*c+f*f+w*w+x*x,r=t?1/t:0;return e[0]=-c*r,e[1]=-f*r,e[2]=-w*r,e[3]=x*r,e}function C(o,h){const e=h??new l(4);return e[0]=-o[0],e[1]=-o[1],e[2]=-o[2],e[3]=o[3],e}function lt(o,h){const e=h??new l(4),c=o[0]+o[5]+o[10];if(c>0){const f=Math.sqrt(c+1);e[3]=.5*f;const w=.5/f;e[0]=(o[6]-o[9])*w,e[1]=(o[8]-o[2])*w,e[2]=(o[1]-o[4])*w}else{let f=0;o[5]>o[0]&&(f=1),o[10]>o[f*4+f]&&(f=2);const w=(f+1)%3,x=(f+2)%3,t=Math.sqrt(o[f*4+f]-o[w*4+w]-o[x*4+x]+1);e[f]=.5*t;const r=.5/t;e[3]=(o[w*4+x]-o[x*4+w])*r,e[w]=(o[w*4+f]+o[f*4+w])*r,e[x]=(o[x*4+f]+o[f*4+x])*r}return e}function Bt(o,h,e,c,f){const w=f??new l(4),x=o*.5,t=h*.5,r=e*.5,n=Math.sin(x),s=Math.cos(x),u=Math.sin(t),p=Math.cos(t),y=Math.sin(r),i=Math.cos(r);switch(c){case"xyz":w[0]=n*p*i+s*u*y,w[1]=s*u*i-n*p*y,w[2]=s*p*y+n*u*i,w[3]=s*p*i-n*u*y;break;case"xzy":w[0]=n*p*i-s*u*y,w[1]=s*u*i-n*p*y,w[2]=s*p*y+n*u*i,w[3]=s*p*i+n*u*y;break;case"yxz":w[0]=n*p*i+s*u*y,w[1]=s*u*i-n*p*y,w[2]=s*p*y-n*u*i,w[3]=s*p*i+n*u*y;break;case"yzx":w[0]=n*p*i+s*u*y,w[1]=s*u*i+n*p*y,w[2]=s*p*y-n*u*i,w[3]=s*p*i-n*u*y;break;case"zxy":w[0]=n*p*i-s*u*y,w[1]=s*u*i+n*p*y,w[2]=s*p*y+n*u*i,w[3]=s*p*i-n*u*y;break;case"zyx":w[0]=n*p*i-s*u*y,w[1]=s*u*i+n*p*y,w[2]=s*p*y-n*u*i,w[3]=s*p*i+n*u*y;break;default:throw new Error(`Unknown rotation order: ${c}`)}return w}function st(o,h){const e=h??new l(4);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e}const tt=st;function zt(o,h,e){const c=e??new l(4);return c[0]=o[0]+h[0],c[1]=o[1]+h[1],c[2]=o[2]+h[2],c[3]=o[3]+h[3],c}function ht(o,h,e){const c=e??new l(4);return c[0]=o[0]-h[0],c[1]=o[1]-h[1],c[2]=o[2]-h[2],c[3]=o[3]-h[3],c}const ot=ht;function St(o,h,e){const c=e??new l(4);return c[0]=o[0]*h,c[1]=o[1]*h,c[2]=o[2]*h,c[3]=o[3]*h,c}const wt=St;function dt(o,h,e){const c=e??new l(4);return c[0]=o[0]/h,c[1]=o[1]/h,c[2]=o[2]/h,c[3]=o[3]/h,c}function W(o,h){return o[0]*h[0]+o[1]*h[1]+o[2]*h[2]+o[3]*h[3]}function mt(o,h,e,c){const f=c??new l(4);return f[0]=o[0]+e*(h[0]-o[0]),f[1]=o[1]+e*(h[1]-o[1]),f[2]=o[2]+e*(h[2]-o[2]),f[3]=o[3]+e*(h[3]-o[3]),f}function O(o){const h=o[0],e=o[1],c=o[2],f=o[3];return Math.sqrt(h*h+e*e+c*c+f*f)}const X=O;function _(o){const h=o[0],e=o[1],c=o[2],f=o[3];return h*h+e*e+c*c+f*f}const Et=_;function pt(o,h){const e=h??new l(4),c=o[0],f=o[1],w=o[2],x=o[3],t=Math.sqrt(c*c+f*f+w*w+x*x);return t>1e-5?(e[0]=c/t,e[1]=f/t,e[2]=w/t,e[3]=x/t):(e[0]=0,e[1]=0,e[2]=0,e[3]=1),e}function Gt(o,h){return Math.abs(o[0]-h[0])<E&&Math.abs(o[1]-h[1])<E&&Math.abs(o[2]-h[2])<E&&Math.abs(o[3]-h[3])<E}function Mt(o,h){return o[0]===h[0]&&o[1]===h[1]&&o[2]===h[2]&&o[3]===h[3]}function _t(o){const h=o??new l(4);return h[0]=0,h[1]=0,h[2]=0,h[3]=1,h}const N=g.create(),Ot=g.create(),At=g.create();function Lt(o,h,e){const c=e??new l(4),f=g.dot(o,h);return f<-.999999?(g.cross(Ot,o,N),g.len(N)<1e-6&&g.cross(At,o,N),g.normalize(N,N),V(N,Math.PI,c),c):f>.999999?(c[0]=0,c[1]=0,c[2]=0,c[3]=1,c):(g.cross(o,h,N),c[0]=N[0],c[1]=N[1],c[2]=N[2],c[3]=1+f,pt(c,c))}const Pt=new l(4),qt=new l(4);function vt(o,h,e,c,f,w){const x=w??new l(4);return Q(o,c,f,Pt),Q(h,e,f,qt),Q(Pt,qt,2*f*(1-f),x),x}return{create:P,fromValues:B,set:z,fromAxisAngle:V,toAxisAngle:I,angle:F,multiply:Y,mul:j,rotateX:$,rotateY:R,rotateZ:k,slerp:Q,inverse:b,conjugate:C,fromMat:lt,fromEuler:Bt,copy:st,clone:tt,add:zt,subtract:ht,sub:ot,mulScalar:St,scale:wt,divScalar:dt,dot:W,lerp:mt,length:O,len:X,lengthSq:_,lenSq:Et,normalize:pt,equalsApproximately:Gt,equals:Mt,identity:_t,rotationTo:Lt,sqlerp:vt}}const an=new Map;function On(l){let g=an.get(l);return g||(g=_n(l),an.set(l,g)),g}function Ln(l){function g(e,c,f,w){const x=new l(4);return e!==void 0&&(x[0]=e,c!==void 0&&(x[1]=c,f!==void 0&&(x[2]=f,w!==void 0&&(x[3]=w)))),x}const P=g;function B(e,c,f,w,x){const t=x??new l(4);return t[0]=e,t[1]=c,t[2]=f,t[3]=w,t}function z(e,c){const f=c??new l(4);return f[0]=Math.ceil(e[0]),f[1]=Math.ceil(e[1]),f[2]=Math.ceil(e[2]),f[3]=Math.ceil(e[3]),f}function V(e,c){const f=c??new l(4);return f[0]=Math.floor(e[0]),f[1]=Math.floor(e[1]),f[2]=Math.floor(e[2]),f[3]=Math.floor(e[3]),f}function I(e,c){const f=c??new l(4);return f[0]=Math.round(e[0]),f[1]=Math.round(e[1]),f[2]=Math.round(e[2]),f[3]=Math.round(e[3]),f}function F(e,c=0,f=1,w){const x=w??new l(4);return x[0]=Math.min(f,Math.max(c,e[0])),x[1]=Math.min(f,Math.max(c,e[1])),x[2]=Math.min(f,Math.max(c,e[2])),x[3]=Math.min(f,Math.max(c,e[3])),x}function Y(e,c,f){const w=f??new l(4);return w[0]=e[0]+c[0],w[1]=e[1]+c[1],w[2]=e[2]+c[2],w[3]=e[3]+c[3],w}function j(e,c,f,w){const x=w??new l(4);return x[0]=e[0]+c[0]*f,x[1]=e[1]+c[1]*f,x[2]=e[2]+c[2]*f,x[3]=e[3]+c[3]*f,x}function $(e,c,f){const w=f??new l(4);return w[0]=e[0]-c[0],w[1]=e[1]-c[1],w[2]=e[2]-c[2],w[3]=e[3]-c[3],w}const R=$;function k(e,c){return Math.abs(e[0]-c[0])<E&&Math.abs(e[1]-c[1])<E&&Math.abs(e[2]-c[2])<E&&Math.abs(e[3]-c[3])<E}function Q(e,c){return e[0]===c[0]&&e[1]===c[1]&&e[2]===c[2]&&e[3]===c[3]}function b(e,c,f,w){const x=w??new l(4);return x[0]=e[0]+f*(c[0]-e[0]),x[1]=e[1]+f*(c[1]-e[1]),x[2]=e[2]+f*(c[2]-e[2]),x[3]=e[3]+f*(c[3]-e[3]),x}function C(e,c,f,w){const x=w??new l(4);return x[0]=e[0]+f[0]*(c[0]-e[0]),x[1]=e[1]+f[1]*(c[1]-e[1]),x[2]=e[2]+f[2]*(c[2]-e[2]),x[3]=e[3]+f[3]*(c[3]-e[3]),x}function lt(e,c,f){const w=f??new l(4);return w[0]=Math.max(e[0],c[0]),w[1]=Math.max(e[1],c[1]),w[2]=Math.max(e[2],c[2]),w[3]=Math.max(e[3],c[3]),w}function Bt(e,c,f){const w=f??new l(4);return w[0]=Math.min(e[0],c[0]),w[1]=Math.min(e[1],c[1]),w[2]=Math.min(e[2],c[2]),w[3]=Math.min(e[3],c[3]),w}function st(e,c,f){const w=f??new l(4);return w[0]=e[0]*c,w[1]=e[1]*c,w[2]=e[2]*c,w[3]=e[3]*c,w}const tt=st;function zt(e,c,f){const w=f??new l(4);return w[0]=e[0]/c,w[1]=e[1]/c,w[2]=e[2]/c,w[3]=e[3]/c,w}function ht(e,c){const f=c??new l(4);return f[0]=1/e[0],f[1]=1/e[1],f[2]=1/e[2],f[3]=1/e[3],f}const ot=ht;function St(e,c){return e[0]*c[0]+e[1]*c[1]+e[2]*c[2]+e[3]*c[3]}function wt(e){const c=e[0],f=e[1],w=e[2],x=e[3];return Math.sqrt(c*c+f*f+w*w+x*x)}const dt=wt;function W(e){const c=e[0],f=e[1],w=e[2],x=e[3];return c*c+f*f+w*w+x*x}const mt=W;function O(e,c){const f=e[0]-c[0],w=e[1]-c[1],x=e[2]-c[2],t=e[3]-c[3];return Math.sqrt(f*f+w*w+x*x+t*t)}const X=O;function _(e,c){const f=e[0]-c[0],w=e[1]-c[1],x=e[2]-c[2],t=e[3]-c[3];return f*f+w*w+x*x+t*t}const Et=_;function pt(e,c){const f=c??new l(4),w=e[0],x=e[1],t=e[2],r=e[3],n=Math.sqrt(w*w+x*x+t*t+r*r);return n>1e-5?(f[0]=w/n,f[1]=x/n,f[2]=t/n,f[3]=r/n):(f[0]=0,f[1]=0,f[2]=0,f[3]=0),f}function Gt(e,c){const f=c??new l(4);return f[0]=-e[0],f[1]=-e[1],f[2]=-e[2],f[3]=-e[3],f}function Mt(e,c){const f=c??new l(4);return f[0]=e[0],f[1]=e[1],f[2]=e[2],f[3]=e[3],f}const _t=Mt;function N(e,c,f){const w=f??new l(4);return w[0]=e[0]*c[0],w[1]=e[1]*c[1],w[2]=e[2]*c[2],w[3]=e[3]*c[3],w}const Ot=N;function At(e,c,f){const w=f??new l(4);return w[0]=e[0]/c[0],w[1]=e[1]/c[1],w[2]=e[2]/c[2],w[3]=e[3]/c[3],w}const Lt=At;function Pt(e){const c=e??new l(4);return c[0]=0,c[1]=0,c[2]=0,c[3]=0,c}function qt(e,c,f){const w=f??new l(4),x=e[0],t=e[1],r=e[2],n=e[3];return w[0]=c[0]*x+c[4]*t+c[8]*r+c[12]*n,w[1]=c[1]*x+c[5]*t+c[9]*r+c[13]*n,w[2]=c[2]*x+c[6]*t+c[10]*r+c[14]*n,w[3]=c[3]*x+c[7]*t+c[11]*r+c[15]*n,w}function vt(e,c,f){const w=f??new l(4);return pt(e,w),st(w,c,w)}function o(e,c,f){const w=f??new l(4);return wt(e)>c?vt(e,c,w):Mt(e,w)}function h(e,c,f){const w=f??new l(4);return b(e,c,.5,w)}return{create:g,fromValues:P,set:B,ceil:z,floor:V,round:I,clamp:F,add:Y,addScaled:j,subtract:$,sub:R,equalsApproximately:k,equals:Q,lerp:b,lerpV:C,max:lt,min:Bt,mulScalar:st,scale:tt,divScalar:zt,inverse:ht,invert:ot,dot:St,length:wt,len:dt,lengthSq:W,lenSq:mt,distance:O,dist:X,distanceSq:_,distSq:Et,normalize:pt,negate:Gt,copy:Mt,clone:_t,multiply:N,mul:Ot,divide:At,div:Lt,zero:Pt,transformMat4:qt,setLength:vt,truncate:o,midpoint:h}}const fn=new Map;function In(l){let g=fn.get(l);return g||(g=Ln(l),fn.set(l,g)),g}function Ct(l,g,P,B,z,V){return{mat3:qn(l),mat4:Gn(g),quat:On(P),vec2:wn(B),vec3:kt(z),vec4:In(V)}}const{mat3:te,mat4:Z,quat:bt,vec2:ne,vec3:It,vec4:ee}=Ct(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);Ct(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);Ct(mn,Array,Array,Array,Array,Array);const Ft={vsync:!1,resolution:{width:1024,height:768}};let Jt,dn,pn;const Fn="back";async function Yn(){const l=await navigator.gpu.requestAdapter();if(!l)throw new Error("No appropriate GPU Adapter found!");Jt=await l.requestDevice(),dn=Jt.queue,Nn()}function et(){return Jt}function Yt(){return dn}const Xn={cullMode:Fn,topology:"triangle-list"};Z.perspective(2*Math.PI/5,Ft.resolution.width/Ft.resolution.height,1,100);const $n={depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"};function Nn(){pn=Jt.createTexture({size:[Ft.resolution.width,Ft.resolution.height,1],dimension:"2d",format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC})}function Rn(){return pn.createView()}class Hn{constructor(){U(this,"position_",It.fromValues(0,0,0));U(this,"rotation_",It.fromValues(0,0,0));U(this,"scale_",It.fromValues(1,1,1));U(this,"mvpMatrix_",Z.create());U(this,"modelMatrix",Z.create());U(this,"mesh_",null)}setScale(g=1,P=1,B=1){g*P*B!==0&&(this.scale_=It.fromValues(g,P,B))}translate(g=0,P=0,B=0){this.position_=It.fromValues(g,P,B)}rotate(g=0,P=0,B=0){this.rotation_=It.fromValues(g,P,B)}get scale(){return[...this.scale_]}get position(){return[...this.position_]}get rotation(){return[...this.rotation_]}get mvpMatrix(){return Z.copy(this.mvpMatrix_)}get mesh(){return this.renderable?this.mesh_:null}get renderable(){return this.mesh_!==null&&this.mesh_.indexCount>0}addMesh(g){return this.mesh_=g,this.mesh_}calculateMVPMatrix(g,P){return Z.identity(this.modelMatrix),Z.translate(this.modelMatrix,this.position_,this.modelMatrix),Z.rotateX(this.modelMatrix,this.rotation_[0],this.modelMatrix),Z.rotateY(this.modelMatrix,this.rotation_[1],this.modelMatrix),Z.rotateZ(this.modelMatrix,this.rotation_[2],this.modelMatrix),Z.scale(this.modelMatrix,this.scale_,this.modelMatrix),Z.multiply(P,g,this.mvpMatrix_),Z.multiply(this.mvpMatrix_,this.modelMatrix,this.mvpMatrix_),this.mvpMatrix_}}class jn{constructor(){U(this,"pitchAngle",0);U(this,"yawAngle",0);U(this,"fov",60*Math.PI/180);U(this,"aspect",Ft.resolution.width/Ft.resolution.height);U(this,"near",.1);U(this,"far",1e3);U(this,"projectionMatrix",Z.perspective(this.fov,this.aspect,this.near,this.far));U(this,"cameraPos",It.fromValues(0,0,0));U(this,"targetPos",It.fromValues(0,0,-1));U(this,"up",It.fromValues(0,1,0));U(this,"viewMatrix",Z.identity())}set setFOV(g){this.fov=g*Math.PI/180}set setNear(g){this.near=Math.max(.001,g)}set setFar(g){this.far=Math.max(this.near+.001,g)}set setCameraPos(g){g!=this.targetPos&&(this.cameraPos=g)}set setTargetPos(g){g!=this.cameraPos&&(this.targetPos=g)}orbitEuler(g,P,B){const z=Z.identity();Z.rotateY(z,g,z),Z.rotateX(z,P,z),Z.translate(z,[0,0,B],z),this.viewMatrix=Z.invert(z)}orbitQuat(g,P,B){this.yawAngle+=Wt.degToRad(Wt.degToRad(g)),this.pitchAngle+=Wt.degToRad(Wt.degToRad(P));const z=bt.fromAxisAngle(this.up,this.yawAngle),V=bt.fromAxisAngle([1,0,0],this.pitchAngle),I=bt.multiply(z,V),F=Z.fromQuat(I);Z.translate(F,[0,0,B],F),this.viewMatrix=Z.invert(F)}update(){return[this.projectionMatrix,this.viewMatrix]}}class Zn{constructor(g){U(this,"canvas",null);U(this,"deltaX",0);U(this,"deltaY",0);U(this,"lastDeltaX",0);U(this,"lastDeltaY",0);U(this,"onMouseDown",()=>{var g;(g=this.canvas)==null||g.requestPointerLock()});U(this,"onMouseMove",g=>{document.pointerLockElement===this.canvas&&(this.deltaX=g.movementX,this.deltaY=g.movementY)});U(this,"onMouseUp",()=>{document.exitPointerLock(),this.deltaX=0,this.deltaY=0});U(this,"update",()=>{this.deltaX===this.lastDeltaX&&this.deltaY===this.lastDeltaY&&(this.deltaX=0,this.deltaY=0),this.lastDeltaX=this.deltaX,this.lastDeltaY=this.deltaY,requestAnimationFrame(this.update)});if(this.canvas=document.getElementById(g),!this.canvas){console.error("Could find Canvas to attach controls");return}this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseup",this.onMouseUp),this.canvas.addEventListener("mouseleave",this.onMouseUp),requestAnimationFrame(this.update)}get x(){return this.deltaX}get y(){return this.deltaY}}class Qn{constructor(){U(this,"context",null);U(this,"canvasFormat");U(this,"entityList",[]);U(this,"lastFrameMS",Date.now());U(this,"simpleOrbitCam");U(this,"input")}async init(g){await Yn();const P=document.getElementById(g);if(P)P.width=Ft.resolution.width,P.height=Ft.resolution.height;else return;console.log("GPU Device initialized",et()),this.canvasFormat=navigator.gpu.getPreferredCanvasFormat(),this.input=new Zn("viewport"),this.context=P.getContext("webgpu"),this.context!=null&&(this.context.configure({device:et(),format:this.canvasFormat}),this.simpleOrbitCam=new jn)}renderFrame(){var Y;if(this.context==null)return;const g=Date.now(),P=(g-this.lastFrameMS)/1e3;this.lastFrameMS=g;const B=et().createCommandEncoder(),z=B.beginRenderPass({colorAttachments:[{view:this.context.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:Rn(),depthLoadOp:"clear",depthStoreOp:"store",stencilLoadOp:"clear",stencilStoreOp:"store",depthClearValue:1,stencilClearValue:0}});this.simpleOrbitCam.orbitQuat(this.input.x*150*P,this.input.y*150*P,6.66);const[V,I]=this.simpleOrbitCam.update();for(let j=0;j<this.entityList.length;j++){const $=(Y=this.entityList[j])==null?void 0:Y.mesh,R=$==null?void 0:$.material,k=R==null?void 0:R.getPipeline;if(!$||!k||!R.ready)continue;z.setPipeline(k),this.entityList[j].calculateMVPMatrix(I,V);const Q=new Float32Array(this.entityList[j].mvpMatrix);Yt().writeBuffer($.material.getMVPUniformBuffer,0,Q.buffer,Q.byteOffset,Q.byteLength);const b=$.material.getCommonBindGroup,C=$.material.getMaterialBindGroup;z.setBindGroup(0,b),z.setBindGroup(1,C),z.setVertexBuffer(0,$.positionBuffer),z.setVertexBuffer(1,$.colorBuffer),z.setVertexBuffer(2,$.normalBuffer),z.setVertexBuffer(3,$.uvBuffer),z.setIndexBuffer($.indexBuffer,"uint16"),z.drawIndexed($.indexCount)}z.end();const F=B.finish();Yt().submit([F])}addEntity(){const g=new Hn;return this.entityList.push(g),g}}class Mn{constructor(g,P,B=null,z=null,V){U(this,"positionBuffer");U(this,"colorBuffer");U(this,"indexBuffer");U(this,"normalBuffer");U(this,"uvBuffer");U(this,"positions");U(this,"colors");U(this,"indices");U(this,"normals");U(this,"uvs");U(this,"material_");U(this,"passIndex",0);this.positions=g,this.positionBuffer=et().createBuffer({label:"Positions",size:this.positions.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),Yt().writeBuffer(this.positionBuffer,0,this.positions),this.indices=P,this.indexBuffer=et().createBuffer({label:"Indices",size:P.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST}),Yt().writeBuffer(this.indexBuffer,0,P);let I=g.length/3;if(B===null){const F=new Float32Array(I*3);for(let Y=0;Y<I;Y++)F[Y*3]=1,F[Y*3+1]=0,F[Y*3+2]=1;this.colors=F}else this.colors=B;this.colorBuffer=et().createBuffer({label:"Colors",size:this.colors.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),Yt().writeBuffer(this.colorBuffer,0,this.colors),z===null?this.normals=new Float32Array(I*3).fill(0):this.normals=z,this.normalBuffer=et().createBuffer({label:"Normals",size:this.normals.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),Yt().writeBuffer(this.normalBuffer,0,this.normals),V===null?this.uvs=new Float32Array(I*2).fill(0):this.uvs=V,this.uvBuffer=et().createBuffer({label:"UVs",size:this.uvs.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),Yt().writeBuffer(this.uvBuffer,0,this.uvs)}get material(){return this.material_}set material(g){this.material_=g}get indexCount(){return this.indices.length}}function ln(l){const g=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,1,1,-1,1,1,-1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1]),P=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),B=new Float32Array([0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0]),z=new Uint16Array([0,1,2,0,2,3,4,7,6,4,6,5,8,9,10,8,10,11,12,14,13,12,15,14,16,19,18,16,18,17,20,21,22,20,22,23]);return new Mn(g,z,l,P,B)}class hn{static async loadFile(g){const P=await fetch(g);if(!P.ok)return Promise.reject(console.error(`Failed to load file:${P.statusText}`));const B=await P.json(),V=B.meshes[0].primitives[0],I=V.attributes.POSITION,F=B.accessors[I],Y=B.bufferViews[F.bufferView],j=B.buffers[Y.buffer],R=await(await fetch("./mesh/"+j.uri)).arrayBuffer(),k=Y.byteOffset,Q=F.type==="VEC3"?3:2,b=new Float32Array(R,k,F.count*Q),C=V.attributes.TEXCOORD_0,lt=B.accessors[C],st=B.bufferViews[lt.bufferView].byteOffset,tt=2,zt=new Float32Array(R,st,lt.count*tt),ht=V.indices,ot=B.accessors[ht],wt=B.bufferViews[ot.bufferView].byteOffset,dt=new Uint16Array(R,wt,ot.count),W=new Mn(b,dt,null,null,zt);return new Promise(mt=>{mt(W)})}}const Wn=`struct Uniforms {\r
    mvpMatrix: mat4x4f\r
}\r
\r
struct VSOut {\r
    @builtin(position) Position: vec4f,\r
    @location(0) color: vec3f,\r
    @location(1) uv: vec2f\r
 };\r
\r
@vertex\r
fn main_vert(@location(0) inPos: vec4f,\r
        @location(1) inColor: vec3f,\r
        @location(2) inNrm: vec3f,\r
        @location(3) inUV: vec2f) -> VSOut {\r
    var vsOut: VSOut;\r
\r
    var col: vec4f;\r
    col = 0.5 * (inPos + vec4(1.0, 1.0, 1.0, 1.0));\r
    vsOut.uv = inUV;\r
    vsOut.Position =  uniforms.mvpMatrix * inPos;\r
    vsOut.color = col.xyz;\r
    return vsOut;\r
}\r
\r
`,Kn=`@fragment\r
fn main_frag(\r
    @location(0) vertColor: vec3f,\r
    @location(1) uvs: vec2f\r
    ) -> @location(0) vec4f {\r
    return textureSample(albedo, albedoSampler, uvs);\r
}`;async function gn(l){const P=await(await fetch(l)).blob();return await createImageBitmap(P)}class Jn{constructor(g,P,B){U(this,"pipeline");U(this,"assembledShaderModule");U(this,"vertexCode","");U(this,"fragmentCode","");U(this,"properties");U(this,"MVPUniformBuffer");U(this,"commonBindGroup");U(this,"materialBindGroup");U(this,"generateStates",()=>{const g={arrayStride:12,attributes:[{format:"float32x3",offset:0,shaderLocation:0}]},P={arrayStride:3*4,attributes:[{format:"float32x3",offset:0,shaderLocation:1}]},B={arrayStride:3*4,attributes:[{shaderLocation:2,format:"float32x3",offset:0}]},z={arrayStride:2*4,attributes:[{shaderLocation:3,format:"float32x2",offset:0}]},V={module:this.assembledShaderModule,entryPoint:"main_vert",buffers:[g,P,B,z]},I={module:this.assembledShaderModule,entryPoint:"main_frag",targets:[{format:"bgra8unorm"}]};return[V,I]});this.properties=g,this.fragmentCode=B,this.vertexCode=P,this.compileShader(),this.generatePipeline(),this.generateCommonBindGroup(),this.generateMaterialBindGroup()}get getPipeline(){return this.pipeline}get getMVPUniformBuffer(){return this.MVPUniformBuffer}get getCommonBindGroup(){return this.commonBindGroup}get getMaterialBindGroup(){return this.materialBindGroup}get ready(){return this.commonBindGroup!=null&&this.materialBindGroup!=null}async setTexture(g,P){const B=await gn(P),z=et().createTexture({size:[B.width,B.height],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});this.properties.textures[g]={image:B,textureHandle:z,uri:P},this.generateMaterialBindGroup(),B.close()}async generateCommonBindGroup(){this.MVPUniformBuffer=et().createBuffer({size:4*16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.commonBindGroup=et().createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.MVPUniformBuffer}}]})}async generateMaterialBindGroup(){Object.entries(this.properties.textures).forEach(([g,P])=>{const B=P;et().queue.copyExternalImageToTexture({source:B.image},{texture:B.textureHandle},[B.image.width,B.image.height]);const z=B.textureHandle.createView(),V=et().createSampler({magFilter:"linear",minFilter:"linear"});this.materialBindGroup=et().createBindGroup({layout:this.pipeline.getBindGroupLayout(1),entries:[{binding:0,resource:V},{binding:1,resource:z}]})})}generatePipeline(){const[g,P]=this.generateStates(),B={layout:"auto",vertex:g,fragment:P,primitive:Xn,depthStencil:$n};this.pipeline=et().createRenderPipeline(B)}compileShader(){const B=`
        @binding(0) @group(0) var<uniform> uniforms : Uniforms;
        
            @group(1) @binding(0) var albedoSampler: sampler;
            @group(1) @binding(1) var albedo: texture_2d<f32>;
            

        
        ${this.vertexCode}
        

        ${this.fragmentCode}
        `;try{this.assembledShaderModule=et().createShaderModule({code:B})}catch(z){console.error(z)}}}const Kt=async()=>{const l=await gn("uv1.png"),g=et().createTexture({size:[l.width,l.height],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),P={textures:{albedo:{image:l,uri:"uv1.png",textureHandle:g}},scalars:{baseColor:It.fromValues(1,1,1)}};return l.close(),new Jn(P,Wn,Kn)},Xt=new Qn,kn=async()=>{await Xt.init("viewport");const l=Xt.addEntity(),g=l.addMesh(ln());g.material=await Kt(),g.material.setTexture("albedo","./test.jpg"),l.translate(-3.3,0,-1);const P=Xt.addEntity(),B=P.addMesh(ln());B.material=await Kt(),B.material.setTexture("albedo","./test.jpg"),P.translate(3.5,0,1);const z=await hn.loadFile("./mesh/suzanne.gltf"),V=Xt.addEntity(),I=V.addMesh(z);I.material=await Kt(),I.material.setTexture("albedo","./muscle.jpg"),V.setScale(1,1,1),V.rotate(0,45,0),V.translate(-3,2.5,0);const F=await hn.loadFile("./mesh/octo.gltf"),Y=Xt.addEntity(),j=Y.addMesh(F);j.material=await Kt(),j.material.setTexture("albedo","./mesh/octo.png"),Y.setScale(3,3,3),Y.translate(0,0,0)},bn=()=>{kn();let l=performance.now();const g=()=>{performance.now()-l,l=performance.now(),Xt.renderFrame(),requestAnimationFrame(g)};g()};bn();
