var An=Object.defineProperty;var Sn=(u,g,B)=>g in u?An(u,g,{enumerable:!0,configurable:!0,writable:!0,value:B}):u[g]=B;var S=(u,g,B)=>Sn(u,typeof g!="symbol"?g+"":g,B);(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const P of document.querySelectorAll('link[rel="modulepreload"]'))A(P);new MutationObserver(P=>{for(const _ of P)if(_.type==="childList")for(const I of _.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&A(I)}).observe(document,{childList:!0,subtree:!0});function B(P){const _={};return P.integrity&&(_.integrity=P.integrity),P.referrerPolicy&&(_.referrerPolicy=P.referrerPolicy),P.crossOrigin==="use-credentials"?_.credentials="include":P.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function A(P){if(P.ep)return;P.ep=!0;const _=B(P);fetch(P.href,_)}})();function Pn(u,g){return class extends u{constructor(...B){super(...B),g(this)}}}const zn=Pn(Array,u=>u.fill(0));let E=1e-6;function Ln(u){const g=E;return E=u,g}function Gn(u){return u*Math.PI/180}function _n(u){return u*180/Math.PI}function Tn(u,g,B){return u+(g-u)*B}function En(u,g,B){const A=g-u;return Math.abs(g-u)<E?u:(B-u)/A}function Un(u,g){return(u%g+g)%g}var Xt={__proto__:null,get EPSILON(){return E},degToRad:Gn,euclideanModulo:Un,inverseLerp:En,lerp:Tn,radToDeg:_n,setEpsilon:Ln};function Vn(u){function g(t=0,r=0){const n=new u(2);return t!==void 0&&(n[0]=t,r!==void 0&&(n[1]=r)),n}const B=g;function A(t,r,n){const s=n??new u(2);return s[0]=t,s[1]=r,s}function P(t,r){const n=r??new u(2);return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n}function _(t,r){const n=r??new u(2);return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n}function I(t,r){const n=r??new u(2);return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n}function N(t,r=0,n=1,s){const a=s??new u(2);return a[0]=Math.min(n,Math.max(r,t[0])),a[1]=Math.min(n,Math.max(r,t[1])),a}function F(t,r,n){const s=n??new u(2);return s[0]=t[0]+r[0],s[1]=t[1]+r[1],s}function ht(t,r,n,s){const a=s??new u(2);return a[0]=t[0]+r[0]*n,a[1]=t[1]+r[1]*n,a}function k(t,r){const n=t[0],s=t[1],a=r[0],p=r[1],x=Math.sqrt(n*n+s*s),i=Math.sqrt(a*a+p*p),f=x*i,d=f&&Mt(t,r)/f;return Math.acos(d)}function $(t,r,n){const s=n??new u(2);return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s}const R=$;function Z(t,r){return Math.abs(t[0]-r[0])<E&&Math.abs(t[1]-r[1])<E}function C(t,r){return t[0]===r[0]&&t[1]===r[1]}function tt(t,r,n,s){const a=s??new u(2);return a[0]=t[0]+n*(r[0]-t[0]),a[1]=t[1]+n*(r[1]-t[1]),a}function et(t,r,n,s){const a=s??new u(2);return a[0]=t[0]+n[0]*(r[0]-t[0]),a[1]=t[1]+n[1]*(r[1]-t[1]),a}function wt(t,r,n){const s=n??new u(2);return s[0]=Math.max(t[0],r[0]),s[1]=Math.max(t[1],r[1]),s}function nt(t,r,n){const s=n??new u(2);return s[0]=Math.min(t[0],r[0]),s[1]=Math.min(t[1],r[1]),s}function b(t,r,n){const s=n??new u(2);return s[0]=t[0]*r,s[1]=t[1]*r,s}const Pt=b;function dt(t,r,n){const s=n??new u(2);return s[0]=t[0]/r,s[1]=t[1]/r,s}function ct(t,r){const n=r??new u(2);return n[0]=1/t[0],n[1]=1/t[1],n}const zt=ct;function pt(t,r,n){const s=n??new u(3),a=t[0]*r[1]-t[1]*r[0];return s[0]=0,s[1]=0,s[2]=a,s}function Mt(t,r){return t[0]*r[0]+t[1]*r[1]}function W(t){const r=t[0],n=t[1];return Math.sqrt(r*r+n*n)}const vt=W;function V(t){const r=t[0],n=t[1];return r*r+n*n}const Y=V;function U(t,r){const n=t[0]-r[0],s=t[1]-r[1];return Math.sqrt(n*n+s*s)}const Lt=U;function st(t,r){const n=t[0]-r[0],s=t[1]-r[1];return n*n+s*s}const Gt=st;function gt(t,r){const n=r??new u(2),s=t[0],a=t[1],p=Math.sqrt(s*s+a*a);return p>1e-5?(n[0]=s/p,n[1]=a/p):(n[0]=0,n[1]=0),n}function Ot(t,r){const n=r??new u(2);return n[0]=-t[0],n[1]=-t[1],n}function X(t,r){const n=r??new u(2);return n[0]=t[0],n[1]=t[1],n}const qt=X;function Bt(t,r,n){const s=n??new u(2);return s[0]=t[0]*r[0],s[1]=t[1]*r[1],s}const Ft=Bt;function At(t,r,n){const s=n??new u(2);return s[0]=t[0]/r[0],s[1]=t[1]/r[1],s}const Vt=At;function _t(t=1,r){const n=r??new u(2),s=Math.random()*2*Math.PI;return n[0]=Math.cos(s)*t,n[1]=Math.sin(s)*t,n}function o(t){const r=t??new u(2);return r[0]=0,r[1]=0,r}function h(t,r,n){const s=n??new u(2),a=t[0],p=t[1];return s[0]=a*r[0]+p*r[4]+r[12],s[1]=a*r[1]+p*r[5]+r[13],s}function e(t,r,n){const s=n??new u(2),a=t[0],p=t[1];return s[0]=r[0]*a+r[4]*p+r[8],s[1]=r[1]*a+r[5]*p+r[9],s}function c(t,r,n,s){const a=s??new u(2),p=t[0]-r[0],x=t[1]-r[1],i=Math.sin(n),f=Math.cos(n);return a[0]=p*f-x*i+r[0],a[1]=p*i+x*f+r[1],a}function l(t,r,n){const s=n??new u(2);return gt(t,s),b(s,r,s)}function w(t,r,n){const s=n??new u(2);return W(t)>r?l(t,r,s):X(t,s)}function y(t,r,n){const s=n??new u(2);return tt(t,r,.5,s)}return{create:g,fromValues:B,set:A,ceil:P,floor:_,round:I,clamp:N,add:F,addScaled:ht,angle:k,subtract:$,sub:R,equalsApproximately:Z,equals:C,lerp:tt,lerpV:et,max:wt,min:nt,mulScalar:b,scale:Pt,divScalar:dt,inverse:ct,invert:zt,cross:pt,dot:Mt,length:W,len:vt,lengthSq:V,lenSq:Y,distance:U,dist:Lt,distanceSq:st,distSq:Gt,normalize:gt,negate:Ot,copy:X,clone:qt,multiply:Bt,mul:Ft,divide:At,div:Vt,random:_t,zero:o,transformMat4:h,transformMat3:e,rotate:c,setLength:l,truncate:w,midpoint:y}}const hn=new Map;function yn(u){let g=hn.get(u);return g||(g=Vn(u),hn.set(u,g)),g}function On(u){function g(i,f,d){const M=new u(3);return i!==void 0&&(M[0]=i,f!==void 0&&(M[1]=f,d!==void 0&&(M[2]=d))),M}const B=g;function A(i,f,d,M){const D=M??new u(3);return D[0]=i,D[1]=f,D[2]=d,D}function P(i,f){const d=f??new u(3);return d[0]=Math.ceil(i[0]),d[1]=Math.ceil(i[1]),d[2]=Math.ceil(i[2]),d}function _(i,f){const d=f??new u(3);return d[0]=Math.floor(i[0]),d[1]=Math.floor(i[1]),d[2]=Math.floor(i[2]),d}function I(i,f){const d=f??new u(3);return d[0]=Math.round(i[0]),d[1]=Math.round(i[1]),d[2]=Math.round(i[2]),d}function N(i,f=0,d=1,M){const D=M??new u(3);return D[0]=Math.min(d,Math.max(f,i[0])),D[1]=Math.min(d,Math.max(f,i[1])),D[2]=Math.min(d,Math.max(f,i[2])),D}function F(i,f,d){const M=d??new u(3);return M[0]=i[0]+f[0],M[1]=i[1]+f[1],M[2]=i[2]+f[2],M}function ht(i,f,d,M){const D=M??new u(3);return D[0]=i[0]+f[0]*d,D[1]=i[1]+f[1]*d,D[2]=i[2]+f[2]*d,D}function k(i,f){const d=i[0],M=i[1],D=i[2],m=f[0],v=f[1],L=f[2],T=Math.sqrt(d*d+M*M+D*D),z=Math.sqrt(m*m+v*v+L*L),G=T*z,O=G&&Mt(i,f)/G;return Math.acos(O)}function $(i,f,d){const M=d??new u(3);return M[0]=i[0]-f[0],M[1]=i[1]-f[1],M[2]=i[2]-f[2],M}const R=$;function Z(i,f){return Math.abs(i[0]-f[0])<E&&Math.abs(i[1]-f[1])<E&&Math.abs(i[2]-f[2])<E}function C(i,f){return i[0]===f[0]&&i[1]===f[1]&&i[2]===f[2]}function tt(i,f,d,M){const D=M??new u(3);return D[0]=i[0]+d*(f[0]-i[0]),D[1]=i[1]+d*(f[1]-i[1]),D[2]=i[2]+d*(f[2]-i[2]),D}function et(i,f,d,M){const D=M??new u(3);return D[0]=i[0]+d[0]*(f[0]-i[0]),D[1]=i[1]+d[1]*(f[1]-i[1]),D[2]=i[2]+d[2]*(f[2]-i[2]),D}function wt(i,f,d){const M=d??new u(3);return M[0]=Math.max(i[0],f[0]),M[1]=Math.max(i[1],f[1]),M[2]=Math.max(i[2],f[2]),M}function nt(i,f,d){const M=d??new u(3);return M[0]=Math.min(i[0],f[0]),M[1]=Math.min(i[1],f[1]),M[2]=Math.min(i[2],f[2]),M}function b(i,f,d){const M=d??new u(3);return M[0]=i[0]*f,M[1]=i[1]*f,M[2]=i[2]*f,M}const Pt=b;function dt(i,f,d){const M=d??new u(3);return M[0]=i[0]/f,M[1]=i[1]/f,M[2]=i[2]/f,M}function ct(i,f){const d=f??new u(3);return d[0]=1/i[0],d[1]=1/i[1],d[2]=1/i[2],d}const zt=ct;function pt(i,f,d){const M=d??new u(3),D=i[2]*f[0]-i[0]*f[2],m=i[0]*f[1]-i[1]*f[0];return M[0]=i[1]*f[2]-i[2]*f[1],M[1]=D,M[2]=m,M}function Mt(i,f){return i[0]*f[0]+i[1]*f[1]+i[2]*f[2]}function W(i){const f=i[0],d=i[1],M=i[2];return Math.sqrt(f*f+d*d+M*M)}const vt=W;function V(i){const f=i[0],d=i[1],M=i[2];return f*f+d*d+M*M}const Y=V;function U(i,f){const d=i[0]-f[0],M=i[1]-f[1],D=i[2]-f[2];return Math.sqrt(d*d+M*M+D*D)}const Lt=U;function st(i,f){const d=i[0]-f[0],M=i[1]-f[1],D=i[2]-f[2];return d*d+M*M+D*D}const Gt=st;function gt(i,f){const d=f??new u(3),M=i[0],D=i[1],m=i[2],v=Math.sqrt(M*M+D*D+m*m);return v>1e-5?(d[0]=M/v,d[1]=D/v,d[2]=m/v):(d[0]=0,d[1]=0,d[2]=0),d}function Ot(i,f){const d=f??new u(3);return d[0]=-i[0],d[1]=-i[1],d[2]=-i[2],d}function X(i,f){const d=f??new u(3);return d[0]=i[0],d[1]=i[1],d[2]=i[2],d}const qt=X;function Bt(i,f,d){const M=d??new u(3);return M[0]=i[0]*f[0],M[1]=i[1]*f[1],M[2]=i[2]*f[2],M}const Ft=Bt;function At(i,f,d){const M=d??new u(3);return M[0]=i[0]/f[0],M[1]=i[1]/f[1],M[2]=i[2]/f[2],M}const Vt=At;function _t(i=1,f){const d=f??new u(3),M=Math.random()*2*Math.PI,D=Math.random()*2-1,m=Math.sqrt(1-D*D)*i;return d[0]=Math.cos(M)*m,d[1]=Math.sin(M)*m,d[2]=D*i,d}function o(i){const f=i??new u(3);return f[0]=0,f[1]=0,f[2]=0,f}function h(i,f,d){const M=d??new u(3),D=i[0],m=i[1],v=i[2],L=f[3]*D+f[7]*m+f[11]*v+f[15]||1;return M[0]=(f[0]*D+f[4]*m+f[8]*v+f[12])/L,M[1]=(f[1]*D+f[5]*m+f[9]*v+f[13])/L,M[2]=(f[2]*D+f[6]*m+f[10]*v+f[14])/L,M}function e(i,f,d){const M=d??new u(3),D=i[0],m=i[1],v=i[2];return M[0]=D*f[0*4+0]+m*f[1*4+0]+v*f[2*4+0],M[1]=D*f[0*4+1]+m*f[1*4+1]+v*f[2*4+1],M[2]=D*f[0*4+2]+m*f[1*4+2]+v*f[2*4+2],M}function c(i,f,d){const M=d??new u(3),D=i[0],m=i[1],v=i[2];return M[0]=D*f[0]+m*f[4]+v*f[8],M[1]=D*f[1]+m*f[5]+v*f[9],M[2]=D*f[2]+m*f[6]+v*f[10],M}function l(i,f,d){const M=d??new u(3),D=f[0],m=f[1],v=f[2],L=f[3]*2,T=i[0],z=i[1],G=i[2],O=m*G-v*z,q=v*T-D*G,Q=D*z-m*T;return M[0]=T+O*L+(m*Q-v*q)*2,M[1]=z+q*L+(v*O-D*Q)*2,M[2]=G+Q*L+(D*q-m*O)*2,M}function w(i,f){const d=f??new u(3);return d[0]=i[12],d[1]=i[13],d[2]=i[14],d}function y(i,f,d){const M=d??new u(3),D=f*4;return M[0]=i[D+0],M[1]=i[D+1],M[2]=i[D+2],M}function t(i,f){const d=f??new u(3),M=i[0],D=i[1],m=i[2],v=i[4],L=i[5],T=i[6],z=i[8],G=i[9],O=i[10];return d[0]=Math.sqrt(M*M+D*D+m*m),d[1]=Math.sqrt(v*v+L*L+T*T),d[2]=Math.sqrt(z*z+G*G+O*O),d}function r(i,f,d,M){const D=M??new u(3),m=[],v=[];return m[0]=i[0]-f[0],m[1]=i[1]-f[1],m[2]=i[2]-f[2],v[0]=m[0],v[1]=m[1]*Math.cos(d)-m[2]*Math.sin(d),v[2]=m[1]*Math.sin(d)+m[2]*Math.cos(d),D[0]=v[0]+f[0],D[1]=v[1]+f[1],D[2]=v[2]+f[2],D}function n(i,f,d,M){const D=M??new u(3),m=[],v=[];return m[0]=i[0]-f[0],m[1]=i[1]-f[1],m[2]=i[2]-f[2],v[0]=m[2]*Math.sin(d)+m[0]*Math.cos(d),v[1]=m[1],v[2]=m[2]*Math.cos(d)-m[0]*Math.sin(d),D[0]=v[0]+f[0],D[1]=v[1]+f[1],D[2]=v[2]+f[2],D}function s(i,f,d,M){const D=M??new u(3),m=[],v=[];return m[0]=i[0]-f[0],m[1]=i[1]-f[1],m[2]=i[2]-f[2],v[0]=m[0]*Math.cos(d)-m[1]*Math.sin(d),v[1]=m[0]*Math.sin(d)+m[1]*Math.cos(d),v[2]=m[2],D[0]=v[0]+f[0],D[1]=v[1]+f[1],D[2]=v[2]+f[2],D}function a(i,f,d){const M=d??new u(3);return gt(i,M),b(M,f,M)}function p(i,f,d){const M=d??new u(3);return W(i)>f?a(i,f,M):X(i,M)}function x(i,f,d){const M=d??new u(3);return tt(i,f,.5,M)}return{create:g,fromValues:B,set:A,ceil:P,floor:_,round:I,clamp:N,add:F,addScaled:ht,angle:k,subtract:$,sub:R,equalsApproximately:Z,equals:C,lerp:tt,lerpV:et,max:wt,min:nt,mulScalar:b,scale:Pt,divScalar:dt,inverse:ct,invert:zt,cross:pt,dot:Mt,length:W,len:vt,lengthSq:V,lenSq:Y,distance:U,dist:Lt,distanceSq:st,distSq:Gt,normalize:gt,negate:Ot,copy:X,clone:qt,multiply:Bt,mul:Ft,divide:At,div:Vt,random:_t,zero:o,transformMat4:h,transformMat4Upper3x3:e,transformMat3:c,transformQuat:l,getTranslation:w,getAxis:y,getScaling:t,rotateX:r,rotateY:n,rotateZ:s,setLength:a,truncate:p,midpoint:x}}const wn=new Map;function tn(u){let g=wn.get(u);return g||(g=On(u),wn.set(u,g)),g}function qn(u){const g=yn(u),B=tn(u);function A(o,h,e,c,l,w,y,t,r){const n=new u(12);return n[3]=0,n[7]=0,n[11]=0,o!==void 0&&(n[0]=o,h!==void 0&&(n[1]=h,e!==void 0&&(n[2]=e,c!==void 0&&(n[4]=c,l!==void 0&&(n[5]=l,w!==void 0&&(n[6]=w,y!==void 0&&(n[8]=y,t!==void 0&&(n[9]=t,r!==void 0&&(n[10]=r))))))))),n}function P(o,h,e,c,l,w,y,t,r,n){const s=n??new u(12);return s[0]=o,s[1]=h,s[2]=e,s[3]=0,s[4]=c,s[5]=l,s[6]=w,s[7]=0,s[8]=y,s[9]=t,s[10]=r,s[11]=0,s}function _(o,h){const e=h??new u(12);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=0,e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=0,e[8]=o[8],e[9]=o[9],e[10]=o[10],e[11]=0,e}function I(o,h){const e=h??new u(12),c=o[0],l=o[1],w=o[2],y=o[3],t=c+c,r=l+l,n=w+w,s=c*t,a=l*t,p=l*r,x=w*t,i=w*r,f=w*n,d=y*t,M=y*r,D=y*n;return e[0]=1-p-f,e[1]=a+D,e[2]=x-M,e[3]=0,e[4]=a-D,e[5]=1-s-f,e[6]=i+d,e[7]=0,e[8]=x+M,e[9]=i-d,e[10]=1-s-p,e[11]=0,e}function N(o,h){const e=h??new u(12);return e[0]=-o[0],e[1]=-o[1],e[2]=-o[2],e[4]=-o[4],e[5]=-o[5],e[6]=-o[6],e[8]=-o[8],e[9]=-o[9],e[10]=-o[10],e}function F(o,h){const e=h??new u(12);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[8]=o[8],e[9]=o[9],e[10]=o[10],e}const ht=F;function k(o,h){return Math.abs(o[0]-h[0])<E&&Math.abs(o[1]-h[1])<E&&Math.abs(o[2]-h[2])<E&&Math.abs(o[4]-h[4])<E&&Math.abs(o[5]-h[5])<E&&Math.abs(o[6]-h[6])<E&&Math.abs(o[8]-h[8])<E&&Math.abs(o[9]-h[9])<E&&Math.abs(o[10]-h[10])<E}function $(o,h){return o[0]===h[0]&&o[1]===h[1]&&o[2]===h[2]&&o[4]===h[4]&&o[5]===h[5]&&o[6]===h[6]&&o[8]===h[8]&&o[9]===h[9]&&o[10]===h[10]}function R(o){const h=o??new u(12);return h[0]=1,h[1]=0,h[2]=0,h[4]=0,h[5]=1,h[6]=0,h[8]=0,h[9]=0,h[10]=1,h}function Z(o,h){const e=h??new u(12);if(e===o){let p;return p=o[1],o[1]=o[4],o[4]=p,p=o[2],o[2]=o[8],o[8]=p,p=o[6],o[6]=o[9],o[9]=p,e}const c=o[0*4+0],l=o[0*4+1],w=o[0*4+2],y=o[1*4+0],t=o[1*4+1],r=o[1*4+2],n=o[2*4+0],s=o[2*4+1],a=o[2*4+2];return e[0]=c,e[1]=y,e[2]=n,e[4]=l,e[5]=t,e[6]=s,e[8]=w,e[9]=r,e[10]=a,e}function C(o,h){const e=h??new u(12),c=o[0*4+0],l=o[0*4+1],w=o[0*4+2],y=o[1*4+0],t=o[1*4+1],r=o[1*4+2],n=o[2*4+0],s=o[2*4+1],a=o[2*4+2],p=a*t-r*s,x=-a*y+r*n,i=s*y-t*n,f=1/(c*p+l*x+w*i);return e[0]=p*f,e[1]=(-a*l+w*s)*f,e[2]=(r*l-w*t)*f,e[4]=x*f,e[5]=(a*c-w*n)*f,e[6]=(-r*c+w*y)*f,e[8]=i*f,e[9]=(-s*c+l*n)*f,e[10]=(t*c-l*y)*f,e}function tt(o){const h=o[0],e=o[0*4+1],c=o[0*4+2],l=o[1*4+0],w=o[1*4+1],y=o[1*4+2],t=o[2*4+0],r=o[2*4+1],n=o[2*4+2];return h*(w*n-r*y)-l*(e*n-r*c)+t*(e*y-w*c)}const et=C;function wt(o,h,e){const c=e??new u(12),l=o[0],w=o[1],y=o[2],t=o[4],r=o[5],n=o[6],s=o[8],a=o[9],p=o[10],x=h[0],i=h[1],f=h[2],d=h[4],M=h[5],D=h[6],m=h[8],v=h[9],L=h[10];return c[0]=l*x+t*i+s*f,c[1]=w*x+r*i+a*f,c[2]=y*x+n*i+p*f,c[4]=l*d+t*M+s*D,c[5]=w*d+r*M+a*D,c[6]=y*d+n*M+p*D,c[8]=l*m+t*v+s*L,c[9]=w*m+r*v+a*L,c[10]=y*m+n*v+p*L,c}const nt=wt;function b(o,h,e){const c=e??R();return o!==c&&(c[0]=o[0],c[1]=o[1],c[2]=o[2],c[4]=o[4],c[5]=o[5],c[6]=o[6]),c[8]=h[0],c[9]=h[1],c[10]=1,c}function Pt(o,h){const e=h??g.create();return e[0]=o[8],e[1]=o[9],e}function dt(o,h,e){const c=e??g.create(),l=h*4;return c[0]=o[l+0],c[1]=o[l+1],c}function ct(o,h,e,c){const l=c===o?o:F(o,c),w=e*4;return l[w+0]=h[0],l[w+1]=h[1],l}function zt(o,h){const e=h??g.create(),c=o[0],l=o[1],w=o[4],y=o[5];return e[0]=Math.sqrt(c*c+l*l),e[1]=Math.sqrt(w*w+y*y),e}function pt(o,h){const e=h??B.create(),c=o[0],l=o[1],w=o[2],y=o[4],t=o[5],r=o[6],n=o[8],s=o[9],a=o[10];return e[0]=Math.sqrt(c*c+l*l+w*w),e[1]=Math.sqrt(y*y+t*t+r*r),e[2]=Math.sqrt(n*n+s*s+a*a),e}function Mt(o,h){const e=h??new u(12);return e[0]=1,e[1]=0,e[2]=0,e[4]=0,e[5]=1,e[6]=0,e[8]=o[0],e[9]=o[1],e[10]=1,e}function W(o,h,e){const c=e??new u(12),l=h[0],w=h[1],y=o[0],t=o[1],r=o[2],n=o[1*4+0],s=o[1*4+1],a=o[1*4+2],p=o[2*4+0],x=o[2*4+1],i=o[2*4+2];return o!==c&&(c[0]=y,c[1]=t,c[2]=r,c[4]=n,c[5]=s,c[6]=a),c[8]=y*l+n*w+p,c[9]=t*l+s*w+x,c[10]=r*l+a*w+i,c}function vt(o,h){const e=h??new u(12),c=Math.cos(o),l=Math.sin(o);return e[0]=c,e[1]=l,e[2]=0,e[4]=-l,e[5]=c,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function V(o,h,e){const c=e??new u(12),l=o[0*4+0],w=o[0*4+1],y=o[0*4+2],t=o[1*4+0],r=o[1*4+1],n=o[1*4+2],s=Math.cos(h),a=Math.sin(h);return c[0]=s*l+a*t,c[1]=s*w+a*r,c[2]=s*y+a*n,c[4]=s*t-a*l,c[5]=s*r-a*w,c[6]=s*n-a*y,o!==c&&(c[8]=o[8],c[9]=o[9],c[10]=o[10]),c}function Y(o,h){const e=h??new u(12),c=Math.cos(o),l=Math.sin(o);return e[0]=1,e[1]=0,e[2]=0,e[4]=0,e[5]=c,e[6]=l,e[8]=0,e[9]=-l,e[10]=c,e}function U(o,h,e){const c=e??new u(12),l=o[4],w=o[5],y=o[6],t=o[8],r=o[9],n=o[10],s=Math.cos(h),a=Math.sin(h);return c[4]=s*l+a*t,c[5]=s*w+a*r,c[6]=s*y+a*n,c[8]=s*t-a*l,c[9]=s*r-a*w,c[10]=s*n-a*y,o!==c&&(c[0]=o[0],c[1]=o[1],c[2]=o[2]),c}function Lt(o,h){const e=h??new u(12),c=Math.cos(o),l=Math.sin(o);return e[0]=c,e[1]=0,e[2]=-l,e[4]=0,e[5]=1,e[6]=0,e[8]=l,e[9]=0,e[10]=c,e}function st(o,h,e){const c=e??new u(12),l=o[0*4+0],w=o[0*4+1],y=o[0*4+2],t=o[2*4+0],r=o[2*4+1],n=o[2*4+2],s=Math.cos(h),a=Math.sin(h);return c[0]=s*l-a*t,c[1]=s*w-a*r,c[2]=s*y-a*n,c[8]=s*t+a*l,c[9]=s*r+a*w,c[10]=s*n+a*y,o!==c&&(c[4]=o[4],c[5]=o[5],c[6]=o[6]),c}const Gt=vt,gt=V;function Ot(o,h){const e=h??new u(12);return e[0]=o[0],e[1]=0,e[2]=0,e[4]=0,e[5]=o[1],e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function X(o,h,e){const c=e??new u(12),l=h[0],w=h[1];return c[0]=l*o[0*4+0],c[1]=l*o[0*4+1],c[2]=l*o[0*4+2],c[4]=w*o[1*4+0],c[5]=w*o[1*4+1],c[6]=w*o[1*4+2],o!==c&&(c[8]=o[8],c[9]=o[9],c[10]=o[10]),c}function qt(o,h){const e=h??new u(12);return e[0]=o[0],e[1]=0,e[2]=0,e[4]=0,e[5]=o[1],e[6]=0,e[8]=0,e[9]=0,e[10]=o[2],e}function Bt(o,h,e){const c=e??new u(12),l=h[0],w=h[1],y=h[2];return c[0]=l*o[0*4+0],c[1]=l*o[0*4+1],c[2]=l*o[0*4+2],c[4]=w*o[1*4+0],c[5]=w*o[1*4+1],c[6]=w*o[1*4+2],c[8]=y*o[2*4+0],c[9]=y*o[2*4+1],c[10]=y*o[2*4+2],c}function Ft(o,h){const e=h??new u(12);return e[0]=o,e[1]=0,e[2]=0,e[4]=0,e[5]=o,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function At(o,h,e){const c=e??new u(12);return c[0]=h*o[0*4+0],c[1]=h*o[0*4+1],c[2]=h*o[0*4+2],c[4]=h*o[1*4+0],c[5]=h*o[1*4+1],c[6]=h*o[1*4+2],o!==c&&(c[8]=o[8],c[9]=o[9],c[10]=o[10]),c}function Vt(o,h){const e=h??new u(12);return e[0]=o,e[1]=0,e[2]=0,e[4]=0,e[5]=o,e[6]=0,e[8]=0,e[9]=0,e[10]=o,e}function _t(o,h,e){const c=e??new u(12);return c[0]=h*o[0*4+0],c[1]=h*o[0*4+1],c[2]=h*o[0*4+2],c[4]=h*o[1*4+0],c[5]=h*o[1*4+1],c[6]=h*o[1*4+2],c[8]=h*o[2*4+0],c[9]=h*o[2*4+1],c[10]=h*o[2*4+2],c}return{clone:ht,create:A,set:P,fromMat4:_,fromQuat:I,negate:N,copy:F,equalsApproximately:k,equals:$,identity:R,transpose:Z,inverse:C,invert:et,determinant:tt,mul:nt,multiply:wt,setTranslation:b,getTranslation:Pt,getAxis:dt,setAxis:ct,getScaling:zt,get3DScaling:pt,translation:Mt,translate:W,rotation:vt,rotate:V,rotationX:Y,rotateX:U,rotationY:Lt,rotateY:st,rotationZ:Gt,rotateZ:gt,scaling:Ot,scale:X,uniformScaling:Ft,uniformScale:At,scaling3D:qt,scale3D:Bt,uniformScaling3D:Vt,uniformScale3D:_t}}const dn=new Map;function Fn(u){let g=dn.get(u);return g||(g=qn(u),dn.set(u,g)),g}function In(u){const g=tn(u);function B(t,r,n,s,a,p,x,i,f,d,M,D,m,v,L,T){const z=new u(16);return t!==void 0&&(z[0]=t,r!==void 0&&(z[1]=r,n!==void 0&&(z[2]=n,s!==void 0&&(z[3]=s,a!==void 0&&(z[4]=a,p!==void 0&&(z[5]=p,x!==void 0&&(z[6]=x,i!==void 0&&(z[7]=i,f!==void 0&&(z[8]=f,d!==void 0&&(z[9]=d,M!==void 0&&(z[10]=M,D!==void 0&&(z[11]=D,m!==void 0&&(z[12]=m,v!==void 0&&(z[13]=v,L!==void 0&&(z[14]=L,T!==void 0&&(z[15]=T)))))))))))))))),z}function A(t,r,n,s,a,p,x,i,f,d,M,D,m,v,L,T,z){const G=z??new u(16);return G[0]=t,G[1]=r,G[2]=n,G[3]=s,G[4]=a,G[5]=p,G[6]=x,G[7]=i,G[8]=f,G[9]=d,G[10]=M,G[11]=D,G[12]=m,G[13]=v,G[14]=L,G[15]=T,G}function P(t,r){const n=r??new u(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=0,n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=0,n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function _(t,r){const n=r??new u(16),s=t[0],a=t[1],p=t[2],x=t[3],i=s+s,f=a+a,d=p+p,M=s*i,D=a*i,m=a*f,v=p*i,L=p*f,T=p*d,z=x*i,G=x*f,O=x*d;return n[0]=1-m-T,n[1]=D+O,n[2]=v-G,n[3]=0,n[4]=D-O,n[5]=1-M-T,n[6]=L+z,n[7]=0,n[8]=v+G,n[9]=L-z,n[10]=1-M-m,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function I(t,r){const n=r??new u(16);return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n[4]=-t[4],n[5]=-t[5],n[6]=-t[6],n[7]=-t[7],n[8]=-t[8],n[9]=-t[9],n[10]=-t[10],n[11]=-t[11],n[12]=-t[12],n[13]=-t[13],n[14]=-t[14],n[15]=-t[15],n}function N(t,r){const n=r??new u(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}const F=N;function ht(t,r){return Math.abs(t[0]-r[0])<E&&Math.abs(t[1]-r[1])<E&&Math.abs(t[2]-r[2])<E&&Math.abs(t[3]-r[3])<E&&Math.abs(t[4]-r[4])<E&&Math.abs(t[5]-r[5])<E&&Math.abs(t[6]-r[6])<E&&Math.abs(t[7]-r[7])<E&&Math.abs(t[8]-r[8])<E&&Math.abs(t[9]-r[9])<E&&Math.abs(t[10]-r[10])<E&&Math.abs(t[11]-r[11])<E&&Math.abs(t[12]-r[12])<E&&Math.abs(t[13]-r[13])<E&&Math.abs(t[14]-r[14])<E&&Math.abs(t[15]-r[15])<E}function k(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]&&t[4]===r[4]&&t[5]===r[5]&&t[6]===r[6]&&t[7]===r[7]&&t[8]===r[8]&&t[9]===r[9]&&t[10]===r[10]&&t[11]===r[11]&&t[12]===r[12]&&t[13]===r[13]&&t[14]===r[14]&&t[15]===r[15]}function $(t){const r=t??new u(16);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function R(t,r){const n=r??new u(16);if(n===t){let q;return q=t[1],t[1]=t[4],t[4]=q,q=t[2],t[2]=t[8],t[8]=q,q=t[3],t[3]=t[12],t[12]=q,q=t[6],t[6]=t[9],t[9]=q,q=t[7],t[7]=t[13],t[13]=q,q=t[11],t[11]=t[14],t[14]=q,n}const s=t[0*4+0],a=t[0*4+1],p=t[0*4+2],x=t[0*4+3],i=t[1*4+0],f=t[1*4+1],d=t[1*4+2],M=t[1*4+3],D=t[2*4+0],m=t[2*4+1],v=t[2*4+2],L=t[2*4+3],T=t[3*4+0],z=t[3*4+1],G=t[3*4+2],O=t[3*4+3];return n[0]=s,n[1]=i,n[2]=D,n[3]=T,n[4]=a,n[5]=f,n[6]=m,n[7]=z,n[8]=p,n[9]=d,n[10]=v,n[11]=G,n[12]=x,n[13]=M,n[14]=L,n[15]=O,n}function Z(t,r){const n=r??new u(16),s=t[0*4+0],a=t[0*4+1],p=t[0*4+2],x=t[0*4+3],i=t[1*4+0],f=t[1*4+1],d=t[1*4+2],M=t[1*4+3],D=t[2*4+0],m=t[2*4+1],v=t[2*4+2],L=t[2*4+3],T=t[3*4+0],z=t[3*4+1],G=t[3*4+2],O=t[3*4+3],q=v*O,Q=G*L,K=d*O,J=G*M,ot=d*L,rt=v*M,it=p*O,at=G*x,ut=p*L,ft=v*x,Dt=p*M,yt=d*x,xt=D*z,mt=T*m,Tt=i*z,Et=T*f,Ut=i*m,jt=D*f,Ht=s*z,Zt=T*a,bt=s*m,Wt=D*a,Kt=s*f,Jt=i*a,an=q*f+J*m+ot*z-(Q*f+K*m+rt*z),un=Q*a+it*m+ft*z-(q*a+at*m+ut*z),fn=K*a+at*f+Dt*z-(J*a+it*f+yt*z),ln=rt*a+ut*f+yt*m-(ot*a+ft*f+Dt*m),lt=1/(s*an+i*un+D*fn+T*ln);return n[0]=lt*an,n[1]=lt*un,n[2]=lt*fn,n[3]=lt*ln,n[4]=lt*(Q*i+K*D+rt*T-(q*i+J*D+ot*T)),n[5]=lt*(q*s+at*D+ut*T-(Q*s+it*D+ft*T)),n[6]=lt*(J*s+it*i+yt*T-(K*s+at*i+Dt*T)),n[7]=lt*(ot*s+ft*i+Dt*D-(rt*s+ut*i+yt*D)),n[8]=lt*(xt*M+Et*L+Ut*O-(mt*M+Tt*L+jt*O)),n[9]=lt*(mt*x+Ht*L+Wt*O-(xt*x+Zt*L+bt*O)),n[10]=lt*(Tt*x+Zt*M+Kt*O-(Et*x+Ht*M+Jt*O)),n[11]=lt*(jt*x+bt*M+Jt*L-(Ut*x+Wt*M+Kt*L)),n[12]=lt*(Tt*v+jt*G+mt*d-(Ut*G+xt*d+Et*v)),n[13]=lt*(bt*G+xt*p+Zt*v-(Ht*v+Wt*G+mt*p)),n[14]=lt*(Ht*d+Jt*G+Et*p-(Kt*G+Tt*p+Zt*d)),n[15]=lt*(Kt*v+Ut*p+Wt*d-(bt*d+Jt*v+jt*p)),n}function C(t){const r=t[0],n=t[0*4+1],s=t[0*4+2],a=t[0*4+3],p=t[1*4+0],x=t[1*4+1],i=t[1*4+2],f=t[1*4+3],d=t[2*4+0],M=t[2*4+1],D=t[2*4+2],m=t[2*4+3],v=t[3*4+0],L=t[3*4+1],T=t[3*4+2],z=t[3*4+3],G=D*z,O=T*m,q=i*z,Q=T*f,K=i*m,J=D*f,ot=s*z,rt=T*a,it=s*m,at=D*a,ut=s*f,ft=i*a,Dt=G*x+Q*M+K*L-(O*x+q*M+J*L),yt=O*n+ot*M+at*L-(G*n+rt*M+it*L),xt=q*n+rt*x+ut*L-(Q*n+ot*x+ft*L),mt=J*n+it*x+ft*M-(K*n+at*x+ut*M);return r*Dt+p*yt+d*xt+v*mt}const tt=Z;function et(t,r,n){const s=n??new u(16),a=t[0],p=t[1],x=t[2],i=t[3],f=t[4],d=t[5],M=t[6],D=t[7],m=t[8],v=t[9],L=t[10],T=t[11],z=t[12],G=t[13],O=t[14],q=t[15],Q=r[0],K=r[1],J=r[2],ot=r[3],rt=r[4],it=r[5],at=r[6],ut=r[7],ft=r[8],Dt=r[9],yt=r[10],xt=r[11],mt=r[12],Tt=r[13],Et=r[14],Ut=r[15];return s[0]=a*Q+f*K+m*J+z*ot,s[1]=p*Q+d*K+v*J+G*ot,s[2]=x*Q+M*K+L*J+O*ot,s[3]=i*Q+D*K+T*J+q*ot,s[4]=a*rt+f*it+m*at+z*ut,s[5]=p*rt+d*it+v*at+G*ut,s[6]=x*rt+M*it+L*at+O*ut,s[7]=i*rt+D*it+T*at+q*ut,s[8]=a*ft+f*Dt+m*yt+z*xt,s[9]=p*ft+d*Dt+v*yt+G*xt,s[10]=x*ft+M*Dt+L*yt+O*xt,s[11]=i*ft+D*Dt+T*yt+q*xt,s[12]=a*mt+f*Tt+m*Et+z*Ut,s[13]=p*mt+d*Tt+v*Et+G*Ut,s[14]=x*mt+M*Tt+L*Et+O*Ut,s[15]=i*mt+D*Tt+T*Et+q*Ut,s}const wt=et;function nt(t,r,n){const s=n??$();return t!==s&&(s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11]),s[12]=r[0],s[13]=r[1],s[14]=r[2],s[15]=1,s}function b(t,r){const n=r??g.create();return n[0]=t[12],n[1]=t[13],n[2]=t[14],n}function Pt(t,r,n){const s=n??g.create(),a=r*4;return s[0]=t[a+0],s[1]=t[a+1],s[2]=t[a+2],s}function dt(t,r,n,s){const a=s===t?s:N(t,s),p=n*4;return a[p+0]=r[0],a[p+1]=r[1],a[p+2]=r[2],a}function ct(t,r){const n=r??g.create(),s=t[0],a=t[1],p=t[2],x=t[4],i=t[5],f=t[6],d=t[8],M=t[9],D=t[10];return n[0]=Math.sqrt(s*s+a*a+p*p),n[1]=Math.sqrt(x*x+i*i+f*f),n[2]=Math.sqrt(d*d+M*M+D*D),n}function zt(t,r,n,s,a){const p=a??new u(16),x=Math.tan(Math.PI*.5-.5*t);if(p[0]=x/r,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=x,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,Number.isFinite(s)){const i=1/(n-s);p[10]=s*i,p[14]=s*n*i}else p[10]=-1,p[14]=-n;return p}function pt(t,r,n,s=1/0,a){const p=a??new u(16),x=1/Math.tan(t*.5);if(p[0]=x/r,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=x,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,s===1/0)p[10]=0,p[14]=n;else{const i=1/(s-n);p[10]=n*i,p[14]=s*n*i}return p}function Mt(t,r,n,s,a,p,x){const i=x??new u(16);return i[0]=2/(r-t),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/(s-n),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1/(a-p),i[11]=0,i[12]=(r+t)/(t-r),i[13]=(s+n)/(n-s),i[14]=a/(a-p),i[15]=1,i}function W(t,r,n,s,a,p,x){const i=x??new u(16),f=r-t,d=s-n,M=a-p;return i[0]=2*a/f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*a/d,i[6]=0,i[7]=0,i[8]=(t+r)/f,i[9]=(s+n)/d,i[10]=p/M,i[11]=-1,i[12]=0,i[13]=0,i[14]=a*p/M,i[15]=0,i}function vt(t,r,n,s,a,p=1/0,x){const i=x??new u(16),f=r-t,d=s-n;if(i[0]=2*a/f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*a/d,i[6]=0,i[7]=0,i[8]=(t+r)/f,i[9]=(s+n)/d,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p===1/0)i[10]=0,i[14]=a;else{const M=1/(p-a);i[10]=a*M,i[14]=p*a*M}return i}const V=g.create(),Y=g.create(),U=g.create();function Lt(t,r,n,s){const a=s??new u(16);return g.normalize(g.subtract(r,t,U),U),g.normalize(g.cross(n,U,V),V),g.normalize(g.cross(U,V,Y),Y),a[0]=V[0],a[1]=V[1],a[2]=V[2],a[3]=0,a[4]=Y[0],a[5]=Y[1],a[6]=Y[2],a[7]=0,a[8]=U[0],a[9]=U[1],a[10]=U[2],a[11]=0,a[12]=t[0],a[13]=t[1],a[14]=t[2],a[15]=1,a}function st(t,r,n,s){const a=s??new u(16);return g.normalize(g.subtract(t,r,U),U),g.normalize(g.cross(n,U,V),V),g.normalize(g.cross(U,V,Y),Y),a[0]=V[0],a[1]=V[1],a[2]=V[2],a[3]=0,a[4]=Y[0],a[5]=Y[1],a[6]=Y[2],a[7]=0,a[8]=U[0],a[9]=U[1],a[10]=U[2],a[11]=0,a[12]=t[0],a[13]=t[1],a[14]=t[2],a[15]=1,a}function Gt(t,r,n,s){const a=s??new u(16);return g.normalize(g.subtract(t,r,U),U),g.normalize(g.cross(n,U,V),V),g.normalize(g.cross(U,V,Y),Y),a[0]=V[0],a[1]=Y[0],a[2]=U[0],a[3]=0,a[4]=V[1],a[5]=Y[1],a[6]=U[1],a[7]=0,a[8]=V[2],a[9]=Y[2],a[10]=U[2],a[11]=0,a[12]=-(V[0]*t[0]+V[1]*t[1]+V[2]*t[2]),a[13]=-(Y[0]*t[0]+Y[1]*t[1]+Y[2]*t[2]),a[14]=-(U[0]*t[0]+U[1]*t[1]+U[2]*t[2]),a[15]=1,a}function gt(t,r){const n=r??new u(16);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n}function Ot(t,r,n){const s=n??new u(16),a=r[0],p=r[1],x=r[2],i=t[0],f=t[1],d=t[2],M=t[3],D=t[1*4+0],m=t[1*4+1],v=t[1*4+2],L=t[1*4+3],T=t[2*4+0],z=t[2*4+1],G=t[2*4+2],O=t[2*4+3],q=t[3*4+0],Q=t[3*4+1],K=t[3*4+2],J=t[3*4+3];return t!==s&&(s[0]=i,s[1]=f,s[2]=d,s[3]=M,s[4]=D,s[5]=m,s[6]=v,s[7]=L,s[8]=T,s[9]=z,s[10]=G,s[11]=O),s[12]=i*a+D*p+T*x+q,s[13]=f*a+m*p+z*x+Q,s[14]=d*a+v*p+G*x+K,s[15]=M*a+L*p+O*x+J,s}function X(t,r){const n=r??new u(16),s=Math.cos(t),a=Math.sin(t);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=a,n[7]=0,n[8]=0,n[9]=-a,n[10]=s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function qt(t,r,n){const s=n??new u(16),a=t[4],p=t[5],x=t[6],i=t[7],f=t[8],d=t[9],M=t[10],D=t[11],m=Math.cos(r),v=Math.sin(r);return s[4]=m*a+v*f,s[5]=m*p+v*d,s[6]=m*x+v*M,s[7]=m*i+v*D,s[8]=m*f-v*a,s[9]=m*d-v*p,s[10]=m*M-v*x,s[11]=m*D-v*i,t!==s&&(s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s}function Bt(t,r){const n=r??new u(16),s=Math.cos(t),a=Math.sin(t);return n[0]=s,n[1]=0,n[2]=-a,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=a,n[9]=0,n[10]=s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ft(t,r,n){const s=n??new u(16),a=t[0*4+0],p=t[0*4+1],x=t[0*4+2],i=t[0*4+3],f=t[2*4+0],d=t[2*4+1],M=t[2*4+2],D=t[2*4+3],m=Math.cos(r),v=Math.sin(r);return s[0]=m*a-v*f,s[1]=m*p-v*d,s[2]=m*x-v*M,s[3]=m*i-v*D,s[8]=m*f+v*a,s[9]=m*d+v*p,s[10]=m*M+v*x,s[11]=m*D+v*i,t!==s&&(s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s}function At(t,r){const n=r??new u(16),s=Math.cos(t),a=Math.sin(t);return n[0]=s,n[1]=a,n[2]=0,n[3]=0,n[4]=-a,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Vt(t,r,n){const s=n??new u(16),a=t[0*4+0],p=t[0*4+1],x=t[0*4+2],i=t[0*4+3],f=t[1*4+0],d=t[1*4+1],M=t[1*4+2],D=t[1*4+3],m=Math.cos(r),v=Math.sin(r);return s[0]=m*a+v*f,s[1]=m*p+v*d,s[2]=m*x+v*M,s[3]=m*i+v*D,s[4]=m*f-v*a,s[5]=m*d-v*p,s[6]=m*M-v*x,s[7]=m*D-v*i,t!==s&&(s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s}function _t(t,r,n){const s=n??new u(16);let a=t[0],p=t[1],x=t[2];const i=Math.sqrt(a*a+p*p+x*x);a/=i,p/=i,x/=i;const f=a*a,d=p*p,M=x*x,D=Math.cos(r),m=Math.sin(r),v=1-D;return s[0]=f+(1-f)*D,s[1]=a*p*v+x*m,s[2]=a*x*v-p*m,s[3]=0,s[4]=a*p*v-x*m,s[5]=d+(1-d)*D,s[6]=p*x*v+a*m,s[7]=0,s[8]=a*x*v+p*m,s[9]=p*x*v-a*m,s[10]=M+(1-M)*D,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}const o=_t;function h(t,r,n,s){const a=s??new u(16);let p=r[0],x=r[1],i=r[2];const f=Math.sqrt(p*p+x*x+i*i);p/=f,x/=f,i/=f;const d=p*p,M=x*x,D=i*i,m=Math.cos(n),v=Math.sin(n),L=1-m,T=d+(1-d)*m,z=p*x*L+i*v,G=p*i*L-x*v,O=p*x*L-i*v,q=M+(1-M)*m,Q=x*i*L+p*v,K=p*i*L+x*v,J=x*i*L-p*v,ot=D+(1-D)*m,rt=t[0],it=t[1],at=t[2],ut=t[3],ft=t[4],Dt=t[5],yt=t[6],xt=t[7],mt=t[8],Tt=t[9],Et=t[10],Ut=t[11];return a[0]=T*rt+z*ft+G*mt,a[1]=T*it+z*Dt+G*Tt,a[2]=T*at+z*yt+G*Et,a[3]=T*ut+z*xt+G*Ut,a[4]=O*rt+q*ft+Q*mt,a[5]=O*it+q*Dt+Q*Tt,a[6]=O*at+q*yt+Q*Et,a[7]=O*ut+q*xt+Q*Ut,a[8]=K*rt+J*ft+ot*mt,a[9]=K*it+J*Dt+ot*Tt,a[10]=K*at+J*yt+ot*Et,a[11]=K*ut+J*xt+ot*Ut,t!==a&&(a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a}const e=h;function c(t,r){const n=r??new u(16);return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function l(t,r,n){const s=n??new u(16),a=r[0],p=r[1],x=r[2];return s[0]=a*t[0*4+0],s[1]=a*t[0*4+1],s[2]=a*t[0*4+2],s[3]=a*t[0*4+3],s[4]=p*t[1*4+0],s[5]=p*t[1*4+1],s[6]=p*t[1*4+2],s[7]=p*t[1*4+3],s[8]=x*t[2*4+0],s[9]=x*t[2*4+1],s[10]=x*t[2*4+2],s[11]=x*t[2*4+3],t!==s&&(s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s}function w(t,r){const n=r??new u(16);return n[0]=t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function y(t,r,n){const s=n??new u(16);return s[0]=r*t[0*4+0],s[1]=r*t[0*4+1],s[2]=r*t[0*4+2],s[3]=r*t[0*4+3],s[4]=r*t[1*4+0],s[5]=r*t[1*4+1],s[6]=r*t[1*4+2],s[7]=r*t[1*4+3],s[8]=r*t[2*4+0],s[9]=r*t[2*4+1],s[10]=r*t[2*4+2],s[11]=r*t[2*4+3],t!==s&&(s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s}return{create:B,set:A,fromMat3:P,fromQuat:_,negate:I,copy:N,clone:F,equalsApproximately:ht,equals:k,identity:$,transpose:R,inverse:Z,determinant:C,invert:tt,multiply:et,mul:wt,setTranslation:nt,getTranslation:b,getAxis:Pt,setAxis:dt,getScaling:ct,perspective:zt,perspectiveReverseZ:pt,ortho:Mt,frustum:W,frustumReverseZ:vt,aim:Lt,cameraAim:st,lookAt:Gt,translation:gt,translate:Ot,rotationX:X,rotateX:qt,rotationY:Bt,rotateY:Ft,rotationZ:At,rotateZ:Vt,axisRotation:_t,rotation:o,axisRotate:h,rotate:e,scaling:c,scale:l,uniformScaling:w,uniformScale:y}}const pn=new Map;function Nn(u){let g=pn.get(u);return g||(g=In(u),pn.set(u,g)),g}function Yn(u){const g=tn(u);function B(o,h,e,c){const l=new u(4);return o!==void 0&&(l[0]=o,h!==void 0&&(l[1]=h,e!==void 0&&(l[2]=e,c!==void 0&&(l[3]=c)))),l}const A=B;function P(o,h,e,c,l){const w=l??new u(4);return w[0]=o,w[1]=h,w[2]=e,w[3]=c,w}function _(o,h,e){const c=e??new u(4),l=h*.5,w=Math.sin(l);return c[0]=w*o[0],c[1]=w*o[1],c[2]=w*o[2],c[3]=Math.cos(l),c}function I(o,h){const e=h??g.create(3),c=Math.acos(o[3])*2,l=Math.sin(c*.5);return l>E?(e[0]=o[0]/l,e[1]=o[1]/l,e[2]=o[2]/l):(e[0]=1,e[1]=0,e[2]=0),{angle:c,axis:e}}function N(o,h){const e=W(o,h);return Math.acos(2*e*e-1)}function F(o,h,e){const c=e??new u(4),l=o[0],w=o[1],y=o[2],t=o[3],r=h[0],n=h[1],s=h[2],a=h[3];return c[0]=l*a+t*r+w*s-y*n,c[1]=w*a+t*n+y*r-l*s,c[2]=y*a+t*s+l*n-w*r,c[3]=t*a-l*r-w*n-y*s,c}const ht=F;function k(o,h,e){const c=e??new u(4),l=h*.5,w=o[0],y=o[1],t=o[2],r=o[3],n=Math.sin(l),s=Math.cos(l);return c[0]=w*s+r*n,c[1]=y*s+t*n,c[2]=t*s-y*n,c[3]=r*s-w*n,c}function $(o,h,e){const c=e??new u(4),l=h*.5,w=o[0],y=o[1],t=o[2],r=o[3],n=Math.sin(l),s=Math.cos(l);return c[0]=w*s-t*n,c[1]=y*s+r*n,c[2]=t*s+w*n,c[3]=r*s-y*n,c}function R(o,h,e){const c=e??new u(4),l=h*.5,w=o[0],y=o[1],t=o[2],r=o[3],n=Math.sin(l),s=Math.cos(l);return c[0]=w*s+y*n,c[1]=y*s-w*n,c[2]=t*s+r*n,c[3]=r*s-t*n,c}function Z(o,h,e,c){const l=c??new u(4),w=o[0],y=o[1],t=o[2],r=o[3];let n=h[0],s=h[1],a=h[2],p=h[3],x=w*n+y*s+t*a+r*p;x<0&&(x=-x,n=-n,s=-s,a=-a,p=-p);let i,f;if(1-x>E){const d=Math.acos(x),M=Math.sin(d);i=Math.sin((1-e)*d)/M,f=Math.sin(e*d)/M}else i=1-e,f=e;return l[0]=i*w+f*n,l[1]=i*y+f*s,l[2]=i*t+f*a,l[3]=i*r+f*p,l}function C(o,h){const e=h??new u(4),c=o[0],l=o[1],w=o[2],y=o[3],t=c*c+l*l+w*w+y*y,r=t?1/t:0;return e[0]=-c*r,e[1]=-l*r,e[2]=-w*r,e[3]=y*r,e}function tt(o,h){const e=h??new u(4);return e[0]=-o[0],e[1]=-o[1],e[2]=-o[2],e[3]=o[3],e}function et(o,h){const e=h??new u(4),c=o[0]+o[5]+o[10];if(c>0){const l=Math.sqrt(c+1);e[3]=.5*l;const w=.5/l;e[0]=(o[6]-o[9])*w,e[1]=(o[8]-o[2])*w,e[2]=(o[1]-o[4])*w}else{let l=0;o[5]>o[0]&&(l=1),o[10]>o[l*4+l]&&(l=2);const w=(l+1)%3,y=(l+2)%3,t=Math.sqrt(o[l*4+l]-o[w*4+w]-o[y*4+y]+1);e[l]=.5*t;const r=.5/t;e[3]=(o[w*4+y]-o[y*4+w])*r,e[w]=(o[w*4+l]+o[l*4+w])*r,e[y]=(o[y*4+l]+o[l*4+y])*r}return e}function wt(o,h,e,c,l){const w=l??new u(4),y=o*.5,t=h*.5,r=e*.5,n=Math.sin(y),s=Math.cos(y),a=Math.sin(t),p=Math.cos(t),x=Math.sin(r),i=Math.cos(r);switch(c){case"xyz":w[0]=n*p*i+s*a*x,w[1]=s*a*i-n*p*x,w[2]=s*p*x+n*a*i,w[3]=s*p*i-n*a*x;break;case"xzy":w[0]=n*p*i-s*a*x,w[1]=s*a*i-n*p*x,w[2]=s*p*x+n*a*i,w[3]=s*p*i+n*a*x;break;case"yxz":w[0]=n*p*i+s*a*x,w[1]=s*a*i-n*p*x,w[2]=s*p*x-n*a*i,w[3]=s*p*i+n*a*x;break;case"yzx":w[0]=n*p*i+s*a*x,w[1]=s*a*i+n*p*x,w[2]=s*p*x-n*a*i,w[3]=s*p*i-n*a*x;break;case"zxy":w[0]=n*p*i-s*a*x,w[1]=s*a*i+n*p*x,w[2]=s*p*x+n*a*i,w[3]=s*p*i-n*a*x;break;case"zyx":w[0]=n*p*i-s*a*x,w[1]=s*a*i+n*p*x,w[2]=s*p*x-n*a*i,w[3]=s*p*i+n*a*x;break;default:throw new Error(`Unknown rotation order: ${c}`)}return w}function nt(o,h){const e=h??new u(4);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e}const b=nt;function Pt(o,h,e){const c=e??new u(4);return c[0]=o[0]+h[0],c[1]=o[1]+h[1],c[2]=o[2]+h[2],c[3]=o[3]+h[3],c}function dt(o,h,e){const c=e??new u(4);return c[0]=o[0]-h[0],c[1]=o[1]-h[1],c[2]=o[2]-h[2],c[3]=o[3]-h[3],c}const ct=dt;function zt(o,h,e){const c=e??new u(4);return c[0]=o[0]*h,c[1]=o[1]*h,c[2]=o[2]*h,c[3]=o[3]*h,c}const pt=zt;function Mt(o,h,e){const c=e??new u(4);return c[0]=o[0]/h,c[1]=o[1]/h,c[2]=o[2]/h,c[3]=o[3]/h,c}function W(o,h){return o[0]*h[0]+o[1]*h[1]+o[2]*h[2]+o[3]*h[3]}function vt(o,h,e,c){const l=c??new u(4);return l[0]=o[0]+e*(h[0]-o[0]),l[1]=o[1]+e*(h[1]-o[1]),l[2]=o[2]+e*(h[2]-o[2]),l[3]=o[3]+e*(h[3]-o[3]),l}function V(o){const h=o[0],e=o[1],c=o[2],l=o[3];return Math.sqrt(h*h+e*e+c*c+l*l)}const Y=V;function U(o){const h=o[0],e=o[1],c=o[2],l=o[3];return h*h+e*e+c*c+l*l}const Lt=U;function st(o,h){const e=h??new u(4),c=o[0],l=o[1],w=o[2],y=o[3],t=Math.sqrt(c*c+l*l+w*w+y*y);return t>1e-5?(e[0]=c/t,e[1]=l/t,e[2]=w/t,e[3]=y/t):(e[0]=0,e[1]=0,e[2]=0,e[3]=1),e}function Gt(o,h){return Math.abs(o[0]-h[0])<E&&Math.abs(o[1]-h[1])<E&&Math.abs(o[2]-h[2])<E&&Math.abs(o[3]-h[3])<E}function gt(o,h){return o[0]===h[0]&&o[1]===h[1]&&o[2]===h[2]&&o[3]===h[3]}function Ot(o){const h=o??new u(4);return h[0]=0,h[1]=0,h[2]=0,h[3]=1,h}const X=g.create(),qt=g.create(),Bt=g.create();function Ft(o,h,e){const c=e??new u(4),l=g.dot(o,h);return l<-.999999?(g.cross(qt,o,X),g.len(X)<1e-6&&g.cross(Bt,o,X),g.normalize(X,X),_(X,Math.PI,c),c):l>.999999?(c[0]=0,c[1]=0,c[2]=0,c[3]=1,c):(g.cross(o,h,X),c[0]=X[0],c[1]=X[1],c[2]=X[2],c[3]=1+l,st(c,c))}const At=new u(4),Vt=new u(4);function _t(o,h,e,c,l,w){const y=w??new u(4);return Z(o,c,l,At),Z(h,e,l,Vt),Z(At,Vt,2*l*(1-l),y),y}return{create:B,fromValues:A,set:P,fromAxisAngle:_,toAxisAngle:I,angle:N,multiply:F,mul:ht,rotateX:k,rotateY:$,rotateZ:R,slerp:Z,inverse:C,conjugate:tt,fromMat:et,fromEuler:wt,copy:nt,clone:b,add:Pt,subtract:dt,sub:ct,mulScalar:zt,scale:pt,divScalar:Mt,dot:W,lerp:vt,length:V,len:Y,lengthSq:U,lenSq:Lt,normalize:st,equalsApproximately:Gt,equals:gt,identity:Ot,rotationTo:Ft,sqlerp:_t}}const Mn=new Map;function Rn(u){let g=Mn.get(u);return g||(g=Yn(u),Mn.set(u,g)),g}function Xn(u){function g(e,c,l,w){const y=new u(4);return e!==void 0&&(y[0]=e,c!==void 0&&(y[1]=c,l!==void 0&&(y[2]=l,w!==void 0&&(y[3]=w)))),y}const B=g;function A(e,c,l,w,y){const t=y??new u(4);return t[0]=e,t[1]=c,t[2]=l,t[3]=w,t}function P(e,c){const l=c??new u(4);return l[0]=Math.ceil(e[0]),l[1]=Math.ceil(e[1]),l[2]=Math.ceil(e[2]),l[3]=Math.ceil(e[3]),l}function _(e,c){const l=c??new u(4);return l[0]=Math.floor(e[0]),l[1]=Math.floor(e[1]),l[2]=Math.floor(e[2]),l[3]=Math.floor(e[3]),l}function I(e,c){const l=c??new u(4);return l[0]=Math.round(e[0]),l[1]=Math.round(e[1]),l[2]=Math.round(e[2]),l[3]=Math.round(e[3]),l}function N(e,c=0,l=1,w){const y=w??new u(4);return y[0]=Math.min(l,Math.max(c,e[0])),y[1]=Math.min(l,Math.max(c,e[1])),y[2]=Math.min(l,Math.max(c,e[2])),y[3]=Math.min(l,Math.max(c,e[3])),y}function F(e,c,l){const w=l??new u(4);return w[0]=e[0]+c[0],w[1]=e[1]+c[1],w[2]=e[2]+c[2],w[3]=e[3]+c[3],w}function ht(e,c,l,w){const y=w??new u(4);return y[0]=e[0]+c[0]*l,y[1]=e[1]+c[1]*l,y[2]=e[2]+c[2]*l,y[3]=e[3]+c[3]*l,y}function k(e,c,l){const w=l??new u(4);return w[0]=e[0]-c[0],w[1]=e[1]-c[1],w[2]=e[2]-c[2],w[3]=e[3]-c[3],w}const $=k;function R(e,c){return Math.abs(e[0]-c[0])<E&&Math.abs(e[1]-c[1])<E&&Math.abs(e[2]-c[2])<E&&Math.abs(e[3]-c[3])<E}function Z(e,c){return e[0]===c[0]&&e[1]===c[1]&&e[2]===c[2]&&e[3]===c[3]}function C(e,c,l,w){const y=w??new u(4);return y[0]=e[0]+l*(c[0]-e[0]),y[1]=e[1]+l*(c[1]-e[1]),y[2]=e[2]+l*(c[2]-e[2]),y[3]=e[3]+l*(c[3]-e[3]),y}function tt(e,c,l,w){const y=w??new u(4);return y[0]=e[0]+l[0]*(c[0]-e[0]),y[1]=e[1]+l[1]*(c[1]-e[1]),y[2]=e[2]+l[2]*(c[2]-e[2]),y[3]=e[3]+l[3]*(c[3]-e[3]),y}function et(e,c,l){const w=l??new u(4);return w[0]=Math.max(e[0],c[0]),w[1]=Math.max(e[1],c[1]),w[2]=Math.max(e[2],c[2]),w[3]=Math.max(e[3],c[3]),w}function wt(e,c,l){const w=l??new u(4);return w[0]=Math.min(e[0],c[0]),w[1]=Math.min(e[1],c[1]),w[2]=Math.min(e[2],c[2]),w[3]=Math.min(e[3],c[3]),w}function nt(e,c,l){const w=l??new u(4);return w[0]=e[0]*c,w[1]=e[1]*c,w[2]=e[2]*c,w[3]=e[3]*c,w}const b=nt;function Pt(e,c,l){const w=l??new u(4);return w[0]=e[0]/c,w[1]=e[1]/c,w[2]=e[2]/c,w[3]=e[3]/c,w}function dt(e,c){const l=c??new u(4);return l[0]=1/e[0],l[1]=1/e[1],l[2]=1/e[2],l[3]=1/e[3],l}const ct=dt;function zt(e,c){return e[0]*c[0]+e[1]*c[1]+e[2]*c[2]+e[3]*c[3]}function pt(e){const c=e[0],l=e[1],w=e[2],y=e[3];return Math.sqrt(c*c+l*l+w*w+y*y)}const Mt=pt;function W(e){const c=e[0],l=e[1],w=e[2],y=e[3];return c*c+l*l+w*w+y*y}const vt=W;function V(e,c){const l=e[0]-c[0],w=e[1]-c[1],y=e[2]-c[2],t=e[3]-c[3];return Math.sqrt(l*l+w*w+y*y+t*t)}const Y=V;function U(e,c){const l=e[0]-c[0],w=e[1]-c[1],y=e[2]-c[2],t=e[3]-c[3];return l*l+w*w+y*y+t*t}const Lt=U;function st(e,c){const l=c??new u(4),w=e[0],y=e[1],t=e[2],r=e[3],n=Math.sqrt(w*w+y*y+t*t+r*r);return n>1e-5?(l[0]=w/n,l[1]=y/n,l[2]=t/n,l[3]=r/n):(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function Gt(e,c){const l=c??new u(4);return l[0]=-e[0],l[1]=-e[1],l[2]=-e[2],l[3]=-e[3],l}function gt(e,c){const l=c??new u(4);return l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l}const Ot=gt;function X(e,c,l){const w=l??new u(4);return w[0]=e[0]*c[0],w[1]=e[1]*c[1],w[2]=e[2]*c[2],w[3]=e[3]*c[3],w}const qt=X;function Bt(e,c,l){const w=l??new u(4);return w[0]=e[0]/c[0],w[1]=e[1]/c[1],w[2]=e[2]/c[2],w[3]=e[3]/c[3],w}const Ft=Bt;function At(e){const c=e??new u(4);return c[0]=0,c[1]=0,c[2]=0,c[3]=0,c}function Vt(e,c,l){const w=l??new u(4),y=e[0],t=e[1],r=e[2],n=e[3];return w[0]=c[0]*y+c[4]*t+c[8]*r+c[12]*n,w[1]=c[1]*y+c[5]*t+c[9]*r+c[13]*n,w[2]=c[2]*y+c[6]*t+c[10]*r+c[14]*n,w[3]=c[3]*y+c[7]*t+c[11]*r+c[15]*n,w}function _t(e,c,l){const w=l??new u(4);return st(e,w),nt(w,c,w)}function o(e,c,l){const w=l??new u(4);return pt(e)>c?_t(e,c,w):gt(e,w)}function h(e,c,l){const w=l??new u(4);return C(e,c,.5,w)}return{create:g,fromValues:B,set:A,ceil:P,floor:_,round:I,clamp:N,add:F,addScaled:ht,subtract:k,sub:$,equalsApproximately:R,equals:Z,lerp:C,lerpV:tt,max:et,min:wt,mulScalar:nt,scale:b,divScalar:Pt,inverse:dt,invert:ct,dot:zt,length:pt,len:Mt,lengthSq:W,lenSq:vt,distance:V,dist:Y,distanceSq:U,distSq:Lt,normalize:st,negate:Gt,copy:gt,clone:Ot,multiply:X,mul:qt,divide:Bt,div:Ft,zero:At,transformMat4:Vt,setLength:_t,truncate:o,midpoint:h}}const gn=new Map;function $n(u){let g=gn.get(u);return g||(g=Xn(u),gn.set(u,g)),g}function cn(u,g,B,A,P,_){return{mat3:Fn(u),mat4:Nn(g),quat:Rn(B),vec2:yn(A),vec3:tn(P),vec4:$n(_)}}const{mat3:pe,mat4:j,quat:kt,vec2:Me,vec3:St,vec4:ge}=cn(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);cn(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);cn(zn,Array,Array,Array,Array,Array);const It={vsync:!1,resolution:{width:1024,height:768},maxStaticObjects:2048};let Ct,xn,mn;const Qn="back";async function jn(){const u=await navigator.gpu.requestAdapter();if(!u)throw new Error("No appropriate GPU Adapter found!");Ct=await u.requestDevice(),xn=Ct.queue,bn()}function H(){return Ct}function Nt(){return xn}const Hn={cullMode:Qn,topology:"triangle-list"};j.perspective(2*Math.PI/5,It.resolution.width/It.resolution.height,1,100);const Zn={depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"};function bn(){mn=Ct.createTexture({size:[It.resolution.width,It.resolution.height,1],dimension:"2d",format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC})}function Wn(){return mn.createView()}async function vn(u){const B=await(await fetch(u)).blob();return await createImageBitmap(B)}function Kn(u,g,B){return Math.max(g,Math.min(u,B))}class Jn{constructor(){S(this,"position_",St.fromValues(0,0,0));S(this,"rotation_",St.fromValues(0,0,0));S(this,"scale_",St.fromValues(1,1,1));S(this,"dirty",!0);S(this,"mvpMatrix_",j.create());S(this,"modelMatrix_",j.create())}setScale(g=1,B=1,A=1){g*B*A!==0&&(this.scale_=St.fromValues(g,B,A),this.dirty=!0)}translate(g=0,B=0,A=0){this.position_=St.fromValues(g,B,A),this.dirty=!0}rotate(g=0,B=0,A=0){const P=Xt.degToRad(g),_=Xt.degToRad(B),I=Xt.degToRad(A);this.rotation_=St.fromValues(P,_,I),this.dirty=!0}get scale(){return[...this.scale_]}get position(){return[...this.position_]}get rotation(){return[...this.rotation_]}get forward(){const g=St.create(0,0,-1),B=kt.fromEuler(this.rotation_[0],this.rotation_[1],this.rotation_[2],"xyz"),A=j.fromQuat(B),P=St.transformMat4(g,A);return St.normalize(P)}get mvpMatrix(){return j.copy(this.mvpMatrix_)}get modelMatrix(){return this.modelMatrix_}calculateMVPMatrix(g,B){return this.dirty?(j.identity(this.modelMatrix_),j.translate(this.modelMatrix_,this.position,this.modelMatrix_),j.rotateX(this.modelMatrix_,this.rotation[0],this.modelMatrix_),j.rotateY(this.modelMatrix_,this.rotation[1],this.modelMatrix_),j.rotateZ(this.modelMatrix_,this.rotation[2],this.modelMatrix_),j.scale(this.modelMatrix_,this.scale,this.modelMatrix_),j.multiply(B,g,this.mvpMatrix_),j.multiply(this.mvpMatrix_,this.modelMatrix_,this.mvpMatrix_),this.mvpMatrix_):this.mvpMatrix_}}const $t=class $t{constructor(g="New Entity"){S(this,"transform_",new Jn);S(this,"name","");$t.id_++,this.name=g}get transform(){return this.transform_}get id(){return $t.id_}};S($t,"id_",0);let Qt=$t;class kn extends Qt{constructor(){super(...arguments);S(this,"pitchAngle",0);S(this,"yawAngle",0);S(this,"distance",6);S(this,"maxDist",100);S(this,"minDist",.5);S(this,"zoomSpeed",.01);S(this,"fov",60*Math.PI/180);S(this,"aspect",It.resolution.width/It.resolution.height);S(this,"near",.1);S(this,"far",1e3);S(this,"projectionMatrix",j.perspective(this.fov,this.aspect,this.near,this.far));S(this,"up",St.fromValues(0,1,0));S(this,"viewMatrix",j.identity())}set setFOV(B){this.fov=B*Math.PI/180}set setNear(B){this.near=Math.max(.001,B)}set setFar(B){this.far=Math.max(this.near+.001,B)}orbitEuler(B,A,P){const _=j.identity();j.rotateY(_,B,_),j.rotateX(_,A,_),j.translate(_,[0,0,P],_),this.viewMatrix=j.invert(_)}orbitQuat(B,A,P){this.distance+=P*this.zoomSpeed,this.distance=Kn(this.distance,this.minDist,this.maxDist),this.yawAngle+=Xt.degToRad(B),this.pitchAngle+=Xt.degToRad(A);const _=kt.fromAxisAngle(this.up,this.yawAngle),I=kt.fromAxisAngle([1,0,0],this.pitchAngle),N=kt.multiply(_,I),F=j.fromQuat(N);j.translate(F,[0,0,this.distance],F),this.viewMatrix=j.invert(F),this.transform.rotate(this.pitchAngle,this.yawAngle,0),this.transform.translate(F[12],F[13],F[14])}update(){return[this.projectionMatrix,this.viewMatrix]}get shaderData(){const B=this.transform.forward,A=this.transform.position;return new Float32Array([B[0],B[1],B[2],0,A[0],A[1],A[2],0])}}class Cn{constructor(g){S(this,"canvas",null);S(this,"deltaX",0);S(this,"deltaY",0);S(this,"lastDeltaX",0);S(this,"lastDeltaY",0);S(this,"lastScrollDelta",0);S(this,"currentScrollDelta",0);S(this,"onMouseWheel",g=>{this.currentScrollDelta=g.deltaY});S(this,"onMouseDown",()=>{var g;(g=this.canvas)==null||g.requestPointerLock()});S(this,"onMouseMove",g=>{document.pointerLockElement===this.canvas&&(this.deltaX=g.movementX,this.deltaY=g.movementY)});S(this,"onMouseUp",()=>{document.exitPointerLock(),this.deltaX=0,this.deltaY=0});S(this,"update",()=>{this.deltaX===this.lastDeltaX&&this.deltaY===this.lastDeltaY&&(this.deltaX=0,this.deltaY=0),this.lastDeltaX=this.deltaX,this.lastDeltaY=this.deltaY,this.lastScrollDelta===this.currentScrollDelta&&(this.currentScrollDelta=0),this.lastScrollDelta=this.currentScrollDelta,requestAnimationFrame(this.update)});if(this.canvas=document.getElementById(g),!this.canvas){console.error("Could find Canvas to attach controls");return}this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseup",this.onMouseUp),this.canvas.addEventListener("mouseleave",this.onMouseUp),this.canvas.addEventListener("wheel",this.onMouseWheel,{passive:!0}),requestAnimationFrame(this.update)}get x(){return this.deltaX}get y(){return this.deltaY}get scrollDelta(){return this.currentScrollDelta}}const sn=new Map,en=(u,g,B=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST)=>{if(sn.has(u)){console.log("Buffer already exists");return}sn.set(u,H().createBuffer({size:g,usage:B}))},Yt=u=>sn.get(u),te={name:"Global Uniforms",wgsl:`
        struct Uniforms {
            mvpMatrix: mat4x4f,
            modelMatrix: mat4x4f
        }
        @group(0) @binding(0) var<uniform> matrices: Uniforms;
    `},ne={name:"Directional Light Uniform",wgsl:`
    struct DirLight {
        forward: vec3f,
        intensity: f32,
        color: vec3f,
        pad0: f32
        };
        @group(1) @binding(0) var<uniform> dirLight: DirLight;
        `},ee={name:"Camera Uniforms",wgsl:`
        struct Camera {
            forward: vec3f,
            position: vec3f
        }
        @group(1) @binding(1) var<uniform> mainCam: Camera;
    `},se={name:"Albedo Texture Sampler",wgsl:`
        @group(2) @binding(0) var albedoSampler: sampler;
        @group(2) @binding(1) var albedo: texture_2d<f32>;
    `};class on extends Qt{constructor(B=null,A="New Mesh"){super(A);S(this,"mesh_",null);S(this,"mvpBindGroup_");this.setMesh(B)}get mesh(){return this.mesh_}setMesh(B){return this.mesh_=B,this.mesh_}get mvpBindGroup(){return this.mvpBindGroup_}generateMVPBindGroup(B){const A=Yt("mvp");this.mesh_&&A&&(this.mvpBindGroup_=H().createBindGroup({layout:this.mesh_.material.getPipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:A,offset:B,size:4*16*2}}]}))}get shaderData(){return Float32Array.of(...this.transform.mvpMatrix,...this.transform.modelMatrix)}}var nn=(u=>(u[u.Directional=0]="Directional",u[u.Point=1]="Point",u))(nn||{});class rn extends Qt{constructor(B={}){super();S(this,"type");S(this,"color");S(this,"intensity");S(this,"faloff");S(this,"radius");this.type=B.type??0,this.color=B.color??St.create(1,1,1),this.intensity=B.intensity??1,this.faloff=B.faloff??4,this.radius=B.radius??8}get shaderData(){const B=this.transform.forward;return new Float32Array([B[0],B[1],B[2],this.intensity,this.color[0],this.color[1],this.color[2],0])}}const oe=new rn({type:nn.Directional,intensity:0,color:St.create(0,0,0)});class ce{constructor(){S(this,"context",null);S(this,"canvasFormat");S(this,"entityList",[]);S(this,"meshEntityList",[]);S(this,"lightEntityList",[]);S(this,"lastFrameMS",Date.now());S(this,"simpleOrbitCam");S(this,"input")}get dirLight(){return this.lightEntityList.find(g=>g.type===nn.Directional)??oe}async init(g){await jn();const B=document.getElementById(g);if(B)B.width=It.resolution.width,B.height=It.resolution.height;else return;console.log("GPU Device initialized",H()),this.canvasFormat=navigator.gpu.getPreferredCanvasFormat(),this.input=new Cn("viewport"),this.context=B.getContext("webgpu"),this.context!=null&&(this.context.configure({device:H(),format:this.canvasFormat}),this.simpleOrbitCam=new kn,en("camera",32),en("dirLight",32),en("mvp",It.maxStaticObjects*256))}renderFrame(){if(this.context==null)return;const g=Date.now(),B=(g-this.lastFrameMS)/1e3;this.lastFrameMS=g;const A=H().createCommandEncoder(),P=A.beginRenderPass({colorAttachments:[{view:this.context.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:Wn(),depthLoadOp:"clear",depthStoreOp:"store",stencilLoadOp:"clear",stencilStoreOp:"store",depthClearValue:1,stencilClearValue:0}});this.simpleOrbitCam.orbitQuat(this.input.x*B,this.input.y*B,this.input.scrollDelta);const[_,I]=this.simpleOrbitCam.update(),N=Yt("dirLight");N&&Nt().writeBuffer(N,0,this.dirLight.shaderData);const F=Yt("camera");F&&Nt().writeBuffer(F,0,this.simpleOrbitCam.shaderData);for(let k=0;k<this.meshEntityList.length;k++){const $=this.meshEntityList[k],R=$.mesh,Z=R==null?void 0:R.material,C=Z==null?void 0:Z.getPipeline,tt=Yt("mvp");if(!R||!C||!Z.ready||!tt)continue;P.setPipeline(C),$.transform.calculateMVPMatrix(I,_);const et=$.mvpBindGroup,wt=R.material.getLightsBindGroup,nt=R.material.getMaterialBindGroup,b=k*256;H().queue.writeBuffer(tt,b,$.shaderData),P.setBindGroup(0,et),P.setBindGroup(1,wt),P.setBindGroup(2,nt),P.setVertexBuffer(0,R.positionBuffer),P.setVertexBuffer(1,R.colorBuffer),P.setVertexBuffer(2,R.normalBuffer),P.setVertexBuffer(3,R.uvBuffer),P.setIndexBuffer(R.indexBuffer,"uint16"),P.drawIndexed(R.indexCount)}P.end();const ht=A.finish();Nt().submit([ht])}addEntity(g){if(g instanceof on){this.meshEntityList.push(g);const B=(this.meshEntityList.length-1)*256;g.generateMVPBindGroup(B)}else g instanceof rn?this.lightEntityList.push(g):this.entityList.push(g)}}class Bn{constructor(g,B,A=null,P=null,_){S(this,"positionBuffer");S(this,"colorBuffer");S(this,"indexBuffer");S(this,"normalBuffer");S(this,"uvBuffer");S(this,"positions");S(this,"colors");S(this,"indices");S(this,"normals");S(this,"uvs");S(this,"material_");S(this,"passIndex",0);this.positions=g,this.positionBuffer=H().createBuffer({label:"Positions",size:this.positions.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),Nt().writeBuffer(this.positionBuffer,0,this.positions),this.indices=B,this.indexBuffer=H().createBuffer({label:"Indices",size:B.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST}),Nt().writeBuffer(this.indexBuffer,0,B);let I=g.length/3;if(A===null){const N=new Float32Array(I*3);for(let F=0;F<I;F++)N[F*3]=1,N[F*3+1]=0,N[F*3+2]=1;this.colors=N}else this.colors=A;this.colorBuffer=H().createBuffer({label:"Colors",size:this.colors.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),Nt().writeBuffer(this.colorBuffer,0,this.colors),P===null?(console.log("No normals found!"),this.normals=new Float32Array(I*3).fill(0)):this.normals=P,this.normalBuffer=H().createBuffer({label:"Normals",size:this.normals.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),Nt().writeBuffer(this.normalBuffer,0,this.normals),_===null?this.uvs=new Float32Array(I*2).fill(0):this.uvs=_,this.uvBuffer=H().createBuffer({label:"UVs",size:this.uvs.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),Nt().writeBuffer(this.uvBuffer,0,this.uvs)}get material(){return this.material_}set material(g){this.material_=g}get indexCount(){return this.indices.length}}function re(u){const g=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,1,1,-1,1,1,-1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1]),B=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),A=new Float32Array([0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0]),P=new Uint16Array([0,1,2,0,2,3,4,7,6,4,6,5,8,9,10,8,10,11,12,14,13,12,15,14,16,19,18,16,18,17,20,21,22,20,22,23]);return new Bn(g,P,u,B,A)}class ie{static async loadFile(g){const B=await fetch(g);if(!B.ok)return Promise.reject(console.error(`Failed to load file:${B.statusText}`));const A=await B.json(),_=A.meshes[0].primitives[0],I=_.attributes.POSITION,N=A.accessors[I],F=A.bufferViews[N.bufferView],ht=A.buffers[F.buffer],$=await(await fetch("./mesh/"+ht.uri)).arrayBuffer(),R=F.byteOffset,Z=N.type==="VEC3"?3:2,C=new Float32Array($,R,N.count*Z),tt=_.attributes.TEXCOORD_0,et=A.accessors[tt],nt=A.bufferViews[et.bufferView].byteOffset,b=2,Pt=new Float32Array($,nt,et.count*b),dt=_.attributes.NORMAL,ct=A.accessors[dt],pt=A.bufferViews[ct.bufferView].byteOffset,Mt=3,W=new Float32Array($,pt,ct.count*Mt),vt=_.indices,V=A.accessors[vt],U=A.bufferViews[V.bufferView].byteOffset,Lt=new Uint16Array($,U,V.count),st=new Bn(C,Lt,null,W,Pt);return new Promise(Gt=>{Gt(st)})}}const ae=`struct VSOut {\r
    @builtin(position) Position: vec4f,\r
    @location(0) color: vec3f,\r
    @location(1) uv: vec2f,\r
    @location(2) outNrm: vec3f,\r
    @location(3) worldPos: vec3f\r
 };\r
\r
@vertex\r
fn main_vert(@location(0) inPos: vec4f,\r
        @location(1) inColor: vec3f,\r
        @location(2) inNrm: vec3f,\r
        @location(3) inUV: vec2f) -> VSOut {\r
    var vsOut: VSOut;\r
\r
    var col: vec4f;\r
    vsOut.uv = inUV;\r
    vsOut.Position =  matrices.mvpMatrix * inPos;\r
    vsOut.color = col.xyz;\r
    vsOut.outNrm = inNrm;\r
    vsOut.worldPos = (matrices.modelMatrix * inPos).xyz;\r
    return vsOut;\r
}\r
\r
`,ue=`@fragment\r
fn main_frag(\r
    @builtin(position) fragPos: vec4f,\r
    @location(0) vertColor: vec3f,\r
    @location(1) uv: vec2f,\r
    @location(2) fragNrm: vec3f,\r
    @location(3) worldPos: vec3f\r
    ) -> @location(0) vec4f {\r
        let ambient: vec3f = vec3f (0.06, 0.06, 0.06);\r
        var finalColor: vec4f;\r
\r
        let viewDir = normalize( worldPos - mainCam.position);\r
        let diffuse: vec3f = computeDiffuse(fragNrm, dirLight.forward, dirLight.color, dirLight.intensity);\r
\r
        let specular: f32 = computeSpecular(viewDir, fragNrm, dirLight.forward, 16);\r
\r
        finalColor = textureSample(albedo, albedoSampler, uv) * vec4f(diffuse + ambient, 1) + specular;\r
\r
        return finalColor;\r
}\r
`,fe=`fn reflect(ray: vec3f, normal: vec3f) -> vec3f {\r
    let R = ray - 2 * dot(normal, ray) * normal;\r
    return normalize(R);\r
}\r
\r
fn computeDiffuse(normal: vec3f, lightDir: vec3f, lightColor: vec3f, intensity: f32) -> vec3f {\r
    let N = normalize(normal);\r
    let L = normalize(lightDir);\r
    let lightMagnitude = dot(N, -L);\r
    let diffuseFinal = intensity * saturate(lightMagnitude) * lightColor;\r
    return diffuseFinal;\r
}\r
\r
fn computeSpecular(viewDir: vec3f, normal: vec3f, lightDir: vec3f, exponent: f32) -> f32 {\r
    let N = normalize(normal);\r
    let L = normalize(lightDir);\r
    let V = normalize(viewDir);\r
\r
    let R = reflect(-L, N);\r
    let specBase = saturate(dot(R, V));\r
    return pow(specBase, exponent);\r
}\r
\r
`;class le{constructor(g,B,A){S(this,"pipeline");S(this,"assembledShaderModule");S(this,"vertexCode","");S(this,"fragmentCode","");S(this,"properties");S(this,"lightsBindGroup");S(this,"materialBindGroup");S(this,"generateStates",()=>{const g={arrayStride:12,attributes:[{format:"float32x3",offset:0,shaderLocation:0}]},B={arrayStride:3*4,attributes:[{format:"float32x3",offset:0,shaderLocation:1}]},A={arrayStride:3*4,attributes:[{shaderLocation:2,format:"float32x3",offset:0}]},P={arrayStride:2*4,attributes:[{shaderLocation:3,format:"float32x2",offset:0}]},_={module:this.assembledShaderModule,entryPoint:"main_vert",buffers:[g,B,A,P]},I={module:this.assembledShaderModule,entryPoint:"main_frag",targets:[{format:"bgra8unorm"}]};return[_,I]});this.properties=g,this.fragmentCode=A,this.vertexCode=B,this.compileShader(),this.generatePipeline(),this.generateCommonBindGroup(),this.generateMaterialBindGroup()}get getPipeline(){return this.pipeline}get getLightsBindGroup(){return this.lightsBindGroup}get getMaterialBindGroup(){return this.materialBindGroup}get ready(){return this.lightsBindGroup!=null&&this.materialBindGroup!=null}async setTexture(g,B){const A=await vn(B),P=H().createTexture({size:[A.width,A.height],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});this.properties.textures[g]={image:A,textureHandle:P,uri:B},this.generateMaterialBindGroup(),A.close()}async generateCommonBindGroup(){const g=Yt("camera"),B=Yt("dirLight");if(g&&B)this.lightsBindGroup=H().createBindGroup({layout:this.pipeline.getBindGroupLayout(1),entries:[{binding:0,resource:{buffer:B}},{binding:1,resource:{buffer:g}}]});else throw new Error("Camera buffer not initialized")}async generateMaterialBindGroup(){Object.entries(this.properties.textures).forEach(([g,B])=>{const A=B;H().queue.copyExternalImageToTexture({source:A.image},{texture:A.textureHandle},[A.image.width,A.image.height]);const P=A.textureHandle.createView(),_=H().createSampler({magFilter:"linear",minFilter:"linear"});this.materialBindGroup=H().createBindGroup({layout:this.pipeline.getBindGroupLayout(2),entries:[{binding:0,resource:_},{binding:1,resource:P}]})})}generatePipeline(){const g=H().createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),B=H().createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),A=H().createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{type:"filtering"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}}]}),[P,_]=this.generateStates(),N={layout:H().createPipelineLayout({bindGroupLayouts:[g,B,A]}),vertex:P,fragment:_,primitive:Hn,depthStencil:Zn};this.pipeline=H().createRenderPipeline(N)}compileShader(){const g=`
        ${te.wgsl}
        ${ne.wgsl}
        ${ee.wgsl}
        ${se.wgsl}

        ${fe}

        ${this.vertexCode}
        
        ${this.fragmentCode}
        `;try{this.assembledShaderModule=H().createShaderModule({code:g})}catch(B){console.error(B)}}}const Dn=async()=>{const u=await vn("uv1.png"),g=H().createTexture({size:[u.width,u.height],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),B={textures:{albedo:{image:u,uri:"uv1.png",textureHandle:g}},scalars:{baseColor:St.fromValues(1,1,1)}};return new le(B,ae,ue)},Rt=new ce,he=async()=>{await Rt.init("viewport");const u=re(),g=new on(u);u.material=await Dn(),u.material.setTexture("albedo","./test.jpg"),g.transform.translate(3.5,0,1),Rt.addEntity(g);const B=await ie.loadFile("./mesh/octo.gltf"),A=new on(B),P=A.mesh;P.material=await Dn(),await P.material.setTexture("albedo","./mesh/octo.png"),A.transform.setScale(3,3,3),A.transform.translate(0,0,0),Rt.addEntity(A);const _=new rn({type:nn.Directional,intensity:1,color:St.create(1,1,1)});_.transform.rotate(45,-45,0),Rt.addEntity(_)},we=async()=>{await he();let u=performance.now();const g=()=>{performance.now()-u,u=performance.now(),Rt.renderFrame(),requestAnimationFrame(g)};g()};we();
