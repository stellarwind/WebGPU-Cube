var An=Object.defineProperty;var Pn=(u,g,v)=>g in u?An(u,g,{enumerable:!0,configurable:!0,writable:!0,value:v}):u[g]=v;var P=(u,g,v)=>Pn(u,typeof g!="symbol"?g+"":g,v);(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const S of document.querySelectorAll('link[rel="modulepreload"]'))A(S);new MutationObserver(S=>{for(const G of S)if(G.type==="childList")for(const I of G.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&A(I)}).observe(document,{childList:!0,subtree:!0});function v(S){const G={};return S.integrity&&(G.integrity=S.integrity),S.referrerPolicy&&(G.referrerPolicy=S.referrerPolicy),S.crossOrigin==="use-credentials"?G.credentials="include":S.crossOrigin==="anonymous"?G.credentials="omit":G.credentials="same-origin",G}function A(S){if(S.ep)return;S.ep=!0;const G=v(S);fetch(S.href,G)}})();function Sn(u,g){return class extends u{constructor(...v){super(...v),g(this)}}}const zn=Sn(Array,u=>u.fill(0));let _=1e-6;function Un(u){const g=_;return _=u,g}function Ln(u){return u*Math.PI/180}function Gn(u){return u*180/Math.PI}function Tn(u,g,v){return u+(g-u)*v}function _n(u,g,v){const A=g-u;return Math.abs(g-u)<_?u:(v-u)/A}function Vn(u,g){return(u%g+g)%g}var $t={__proto__:null,get EPSILON(){return _},degToRad:Ln,euclideanModulo:Vn,inverseLerp:_n,lerp:Tn,radToDeg:Gn,setEpsilon:Un};function En(u){function g(t=0,r=0){const n=new u(2);return t!==void 0&&(n[0]=t,r!==void 0&&(n[1]=r)),n}const v=g;function A(t,r,n){const s=n??new u(2);return s[0]=t,s[1]=r,s}function S(t,r){const n=r??new u(2);return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n}function G(t,r){const n=r??new u(2);return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n}function I(t,r){const n=r??new u(2);return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n}function R(t,r=0,n=1,s){const a=s??new u(2);return a[0]=Math.min(n,Math.max(r,t[0])),a[1]=Math.min(n,Math.max(r,t[1])),a}function N(t,r,n){const s=n??new u(2);return s[0]=t[0]+r[0],s[1]=t[1]+r[1],s}function k(t,r,n,s){const a=s??new u(2);return a[0]=t[0]+r[0]*n,a[1]=t[1]+r[1]*n,a}function C(t,r){const n=t[0],s=t[1],a=r[0],p=r[1],x=Math.sqrt(n*n+s*s),i=Math.sqrt(a*a+p*p),f=x*i,d=f&&pt(t,r)/f;return Math.acos(d)}function F(t,r,n){const s=n??new u(2);return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s}const b=F;function Z(t,r){return Math.abs(t[0]-r[0])<_&&Math.abs(t[1]-r[1])<_}function j(t,r){return t[0]===r[0]&&t[1]===r[1]}function tt(t,r,n,s){const a=s??new u(2);return a[0]=t[0]+n*(r[0]-t[0]),a[1]=t[1]+n*(r[1]-t[1]),a}function nt(t,r,n,s){const a=s??new u(2);return a[0]=t[0]+n[0]*(r[0]-t[0]),a[1]=t[1]+n[1]*(r[1]-t[1]),a}function Pt(t,r,n){const s=n??new u(2);return s[0]=Math.max(t[0],r[0]),s[1]=Math.max(t[1],r[1]),s}function ct(t,r,n){const s=n??new u(2);return s[0]=Math.min(t[0],r[0]),s[1]=Math.min(t[1],r[1]),s}function et(t,r,n){const s=n??new u(2);return s[0]=t[0]*r,s[1]=t[1]*r,s}const St=et;function wt(t,r,n){const s=n??new u(2);return s[0]=t[0]/r,s[1]=t[1]/r,s}function rt(t,r){const n=r??new u(2);return n[0]=1/t[0],n[1]=1/t[1],n}const zt=rt;function dt(t,r,n){const s=n??new u(3),a=t[0]*r[1]-t[1]*r[0];return s[0]=0,s[1]=0,s[2]=a,s}function pt(t,r){return t[0]*r[0]+t[1]*r[1]}function W(t){const r=t[0],n=t[1];return Math.sqrt(r*r+n*n)}const mt=W;function E(t){const r=t[0],n=t[1];return r*r+n*n}const Y=E;function V(t,r){const n=t[0]-r[0],s=t[1]-r[1];return Math.sqrt(n*n+s*s)}const Ut=V;function st(t,r){const n=t[0]-r[0],s=t[1]-r[1];return n*n+s*s}const Lt=st;function Mt(t,r){const n=r??new u(2),s=t[0],a=t[1],p=Math.sqrt(s*s+a*a);return p>1e-5?(n[0]=s/p,n[1]=a/p):(n[0]=0,n[1]=0),n}function Ot(t,r){const n=r??new u(2);return n[0]=-t[0],n[1]=-t[1],n}function X(t,r){const n=r??new u(2);return n[0]=t[0],n[1]=t[1],n}const qt=X;function Bt(t,r,n){const s=n??new u(2);return s[0]=t[0]*r[0],s[1]=t[1]*r[1],s}const Ft=Bt;function vt(t,r,n){const s=n??new u(2);return s[0]=t[0]/r[0],s[1]=t[1]/r[1],s}const Et=vt;function Gt(t=1,r){const n=r??new u(2),s=Math.random()*2*Math.PI;return n[0]=Math.cos(s)*t,n[1]=Math.sin(s)*t,n}function o(t){const r=t??new u(2);return r[0]=0,r[1]=0,r}function h(t,r,n){const s=n??new u(2),a=t[0],p=t[1];return s[0]=a*r[0]+p*r[4]+r[12],s[1]=a*r[1]+p*r[5]+r[13],s}function e(t,r,n){const s=n??new u(2),a=t[0],p=t[1];return s[0]=r[0]*a+r[4]*p+r[8],s[1]=r[1]*a+r[5]*p+r[9],s}function c(t,r,n,s){const a=s??new u(2),p=t[0]-r[0],x=t[1]-r[1],i=Math.sin(n),f=Math.cos(n);return a[0]=p*f-x*i+r[0],a[1]=p*i+x*f+r[1],a}function l(t,r,n){const s=n??new u(2);return Mt(t,s),et(s,r,s)}function w(t,r,n){const s=n??new u(2);return W(t)>r?l(t,r,s):X(t,s)}function y(t,r,n){const s=n??new u(2);return tt(t,r,.5,s)}return{create:g,fromValues:v,set:A,ceil:S,floor:G,round:I,clamp:R,add:N,addScaled:k,angle:C,subtract:F,sub:b,equalsApproximately:Z,equals:j,lerp:tt,lerpV:nt,max:Pt,min:ct,mulScalar:et,scale:St,divScalar:wt,inverse:rt,invert:zt,cross:dt,dot:pt,length:W,len:mt,lengthSq:E,lenSq:Y,distance:V,dist:Ut,distanceSq:st,distSq:Lt,normalize:Mt,negate:Ot,copy:X,clone:qt,multiply:Bt,mul:Ft,divide:vt,div:Et,random:Gt,zero:o,transformMat4:h,transformMat3:e,rotate:c,setLength:l,truncate:w,midpoint:y}}const ln=new Map;function Dn(u){let g=ln.get(u);return g||(g=En(u),ln.set(u,g)),g}function On(u){function g(i,f,d){const M=new u(3);return i!==void 0&&(M[0]=i,f!==void 0&&(M[1]=f,d!==void 0&&(M[2]=d))),M}const v=g;function A(i,f,d,M){const D=M??new u(3);return D[0]=i,D[1]=f,D[2]=d,D}function S(i,f){const d=f??new u(3);return d[0]=Math.ceil(i[0]),d[1]=Math.ceil(i[1]),d[2]=Math.ceil(i[2]),d}function G(i,f){const d=f??new u(3);return d[0]=Math.floor(i[0]),d[1]=Math.floor(i[1]),d[2]=Math.floor(i[2]),d}function I(i,f){const d=f??new u(3);return d[0]=Math.round(i[0]),d[1]=Math.round(i[1]),d[2]=Math.round(i[2]),d}function R(i,f=0,d=1,M){const D=M??new u(3);return D[0]=Math.min(d,Math.max(f,i[0])),D[1]=Math.min(d,Math.max(f,i[1])),D[2]=Math.min(d,Math.max(f,i[2])),D}function N(i,f,d){const M=d??new u(3);return M[0]=i[0]+f[0],M[1]=i[1]+f[1],M[2]=i[2]+f[2],M}function k(i,f,d,M){const D=M??new u(3);return D[0]=i[0]+f[0]*d,D[1]=i[1]+f[1]*d,D[2]=i[2]+f[2]*d,D}function C(i,f){const d=i[0],M=i[1],D=i[2],m=f[0],B=f[1],U=f[2],T=Math.sqrt(d*d+M*M+D*D),z=Math.sqrt(m*m+B*B+U*U),L=T*z,O=L&&pt(i,f)/L;return Math.acos(O)}function F(i,f,d){const M=d??new u(3);return M[0]=i[0]-f[0],M[1]=i[1]-f[1],M[2]=i[2]-f[2],M}const b=F;function Z(i,f){return Math.abs(i[0]-f[0])<_&&Math.abs(i[1]-f[1])<_&&Math.abs(i[2]-f[2])<_}function j(i,f){return i[0]===f[0]&&i[1]===f[1]&&i[2]===f[2]}function tt(i,f,d,M){const D=M??new u(3);return D[0]=i[0]+d*(f[0]-i[0]),D[1]=i[1]+d*(f[1]-i[1]),D[2]=i[2]+d*(f[2]-i[2]),D}function nt(i,f,d,M){const D=M??new u(3);return D[0]=i[0]+d[0]*(f[0]-i[0]),D[1]=i[1]+d[1]*(f[1]-i[1]),D[2]=i[2]+d[2]*(f[2]-i[2]),D}function Pt(i,f,d){const M=d??new u(3);return M[0]=Math.max(i[0],f[0]),M[1]=Math.max(i[1],f[1]),M[2]=Math.max(i[2],f[2]),M}function ct(i,f,d){const M=d??new u(3);return M[0]=Math.min(i[0],f[0]),M[1]=Math.min(i[1],f[1]),M[2]=Math.min(i[2],f[2]),M}function et(i,f,d){const M=d??new u(3);return M[0]=i[0]*f,M[1]=i[1]*f,M[2]=i[2]*f,M}const St=et;function wt(i,f,d){const M=d??new u(3);return M[0]=i[0]/f,M[1]=i[1]/f,M[2]=i[2]/f,M}function rt(i,f){const d=f??new u(3);return d[0]=1/i[0],d[1]=1/i[1],d[2]=1/i[2],d}const zt=rt;function dt(i,f,d){const M=d??new u(3),D=i[2]*f[0]-i[0]*f[2],m=i[0]*f[1]-i[1]*f[0];return M[0]=i[1]*f[2]-i[2]*f[1],M[1]=D,M[2]=m,M}function pt(i,f){return i[0]*f[0]+i[1]*f[1]+i[2]*f[2]}function W(i){const f=i[0],d=i[1],M=i[2];return Math.sqrt(f*f+d*d+M*M)}const mt=W;function E(i){const f=i[0],d=i[1],M=i[2];return f*f+d*d+M*M}const Y=E;function V(i,f){const d=i[0]-f[0],M=i[1]-f[1],D=i[2]-f[2];return Math.sqrt(d*d+M*M+D*D)}const Ut=V;function st(i,f){const d=i[0]-f[0],M=i[1]-f[1],D=i[2]-f[2];return d*d+M*M+D*D}const Lt=st;function Mt(i,f){const d=f??new u(3),M=i[0],D=i[1],m=i[2],B=Math.sqrt(M*M+D*D+m*m);return B>1e-5?(d[0]=M/B,d[1]=D/B,d[2]=m/B):(d[0]=0,d[1]=0,d[2]=0),d}function Ot(i,f){const d=f??new u(3);return d[0]=-i[0],d[1]=-i[1],d[2]=-i[2],d}function X(i,f){const d=f??new u(3);return d[0]=i[0],d[1]=i[1],d[2]=i[2],d}const qt=X;function Bt(i,f,d){const M=d??new u(3);return M[0]=i[0]*f[0],M[1]=i[1]*f[1],M[2]=i[2]*f[2],M}const Ft=Bt;function vt(i,f,d){const M=d??new u(3);return M[0]=i[0]/f[0],M[1]=i[1]/f[1],M[2]=i[2]/f[2],M}const Et=vt;function Gt(i=1,f){const d=f??new u(3),M=Math.random()*2*Math.PI,D=Math.random()*2-1,m=Math.sqrt(1-D*D)*i;return d[0]=Math.cos(M)*m,d[1]=Math.sin(M)*m,d[2]=D*i,d}function o(i){const f=i??new u(3);return f[0]=0,f[1]=0,f[2]=0,f}function h(i,f,d){const M=d??new u(3),D=i[0],m=i[1],B=i[2],U=f[3]*D+f[7]*m+f[11]*B+f[15]||1;return M[0]=(f[0]*D+f[4]*m+f[8]*B+f[12])/U,M[1]=(f[1]*D+f[5]*m+f[9]*B+f[13])/U,M[2]=(f[2]*D+f[6]*m+f[10]*B+f[14])/U,M}function e(i,f,d){const M=d??new u(3),D=i[0],m=i[1],B=i[2];return M[0]=D*f[0*4+0]+m*f[1*4+0]+B*f[2*4+0],M[1]=D*f[0*4+1]+m*f[1*4+1]+B*f[2*4+1],M[2]=D*f[0*4+2]+m*f[1*4+2]+B*f[2*4+2],M}function c(i,f,d){const M=d??new u(3),D=i[0],m=i[1],B=i[2];return M[0]=D*f[0]+m*f[4]+B*f[8],M[1]=D*f[1]+m*f[5]+B*f[9],M[2]=D*f[2]+m*f[6]+B*f[10],M}function l(i,f,d){const M=d??new u(3),D=f[0],m=f[1],B=f[2],U=f[3]*2,T=i[0],z=i[1],L=i[2],O=m*L-B*z,q=B*T-D*L,$=D*z-m*T;return M[0]=T+O*U+(m*$-B*q)*2,M[1]=z+q*U+(B*O-D*$)*2,M[2]=L+$*U+(D*q-m*O)*2,M}function w(i,f){const d=f??new u(3);return d[0]=i[12],d[1]=i[13],d[2]=i[14],d}function y(i,f,d){const M=d??new u(3),D=f*4;return M[0]=i[D+0],M[1]=i[D+1],M[2]=i[D+2],M}function t(i,f){const d=f??new u(3),M=i[0],D=i[1],m=i[2],B=i[4],U=i[5],T=i[6],z=i[8],L=i[9],O=i[10];return d[0]=Math.sqrt(M*M+D*D+m*m),d[1]=Math.sqrt(B*B+U*U+T*T),d[2]=Math.sqrt(z*z+L*L+O*O),d}function r(i,f,d,M){const D=M??new u(3),m=[],B=[];return m[0]=i[0]-f[0],m[1]=i[1]-f[1],m[2]=i[2]-f[2],B[0]=m[0],B[1]=m[1]*Math.cos(d)-m[2]*Math.sin(d),B[2]=m[1]*Math.sin(d)+m[2]*Math.cos(d),D[0]=B[0]+f[0],D[1]=B[1]+f[1],D[2]=B[2]+f[2],D}function n(i,f,d,M){const D=M??new u(3),m=[],B=[];return m[0]=i[0]-f[0],m[1]=i[1]-f[1],m[2]=i[2]-f[2],B[0]=m[2]*Math.sin(d)+m[0]*Math.cos(d),B[1]=m[1],B[2]=m[2]*Math.cos(d)-m[0]*Math.sin(d),D[0]=B[0]+f[0],D[1]=B[1]+f[1],D[2]=B[2]+f[2],D}function s(i,f,d,M){const D=M??new u(3),m=[],B=[];return m[0]=i[0]-f[0],m[1]=i[1]-f[1],m[2]=i[2]-f[2],B[0]=m[0]*Math.cos(d)-m[1]*Math.sin(d),B[1]=m[0]*Math.sin(d)+m[1]*Math.cos(d),B[2]=m[2],D[0]=B[0]+f[0],D[1]=B[1]+f[1],D[2]=B[2]+f[2],D}function a(i,f,d){const M=d??new u(3);return Mt(i,M),et(M,f,M)}function p(i,f,d){const M=d??new u(3);return W(i)>f?a(i,f,M):X(i,M)}function x(i,f,d){const M=d??new u(3);return tt(i,f,.5,M)}return{create:g,fromValues:v,set:A,ceil:S,floor:G,round:I,clamp:R,add:N,addScaled:k,angle:C,subtract:F,sub:b,equalsApproximately:Z,equals:j,lerp:tt,lerpV:nt,max:Pt,min:ct,mulScalar:et,scale:St,divScalar:wt,inverse:rt,invert:zt,cross:dt,dot:pt,length:W,len:mt,lengthSq:E,lenSq:Y,distance:V,dist:Ut,distanceSq:st,distSq:Lt,normalize:Mt,negate:Ot,copy:X,clone:qt,multiply:Bt,mul:Ft,divide:vt,div:Et,random:Gt,zero:o,transformMat4:h,transformMat4Upper3x3:e,transformMat3:c,transformQuat:l,getTranslation:w,getAxis:y,getScaling:t,rotateX:r,rotateY:n,rotateZ:s,setLength:a,truncate:p,midpoint:x}}const hn=new Map;function nn(u){let g=hn.get(u);return g||(g=On(u),hn.set(u,g)),g}function qn(u){const g=Dn(u),v=nn(u);function A(o,h,e,c,l,w,y,t,r){const n=new u(12);return n[3]=0,n[7]=0,n[11]=0,o!==void 0&&(n[0]=o,h!==void 0&&(n[1]=h,e!==void 0&&(n[2]=e,c!==void 0&&(n[4]=c,l!==void 0&&(n[5]=l,w!==void 0&&(n[6]=w,y!==void 0&&(n[8]=y,t!==void 0&&(n[9]=t,r!==void 0&&(n[10]=r))))))))),n}function S(o,h,e,c,l,w,y,t,r,n){const s=n??new u(12);return s[0]=o,s[1]=h,s[2]=e,s[3]=0,s[4]=c,s[5]=l,s[6]=w,s[7]=0,s[8]=y,s[9]=t,s[10]=r,s[11]=0,s}function G(o,h){const e=h??new u(12);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=0,e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=0,e[8]=o[8],e[9]=o[9],e[10]=o[10],e[11]=0,e}function I(o,h){const e=h??new u(12),c=o[0],l=o[1],w=o[2],y=o[3],t=c+c,r=l+l,n=w+w,s=c*t,a=l*t,p=l*r,x=w*t,i=w*r,f=w*n,d=y*t,M=y*r,D=y*n;return e[0]=1-p-f,e[1]=a+D,e[2]=x-M,e[3]=0,e[4]=a-D,e[5]=1-s-f,e[6]=i+d,e[7]=0,e[8]=x+M,e[9]=i-d,e[10]=1-s-p,e[11]=0,e}function R(o,h){const e=h??new u(12);return e[0]=-o[0],e[1]=-o[1],e[2]=-o[2],e[4]=-o[4],e[5]=-o[5],e[6]=-o[6],e[8]=-o[8],e[9]=-o[9],e[10]=-o[10],e}function N(o,h){const e=h??new u(12);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[8]=o[8],e[9]=o[9],e[10]=o[10],e}const k=N;function C(o,h){return Math.abs(o[0]-h[0])<_&&Math.abs(o[1]-h[1])<_&&Math.abs(o[2]-h[2])<_&&Math.abs(o[4]-h[4])<_&&Math.abs(o[5]-h[5])<_&&Math.abs(o[6]-h[6])<_&&Math.abs(o[8]-h[8])<_&&Math.abs(o[9]-h[9])<_&&Math.abs(o[10]-h[10])<_}function F(o,h){return o[0]===h[0]&&o[1]===h[1]&&o[2]===h[2]&&o[4]===h[4]&&o[5]===h[5]&&o[6]===h[6]&&o[8]===h[8]&&o[9]===h[9]&&o[10]===h[10]}function b(o){const h=o??new u(12);return h[0]=1,h[1]=0,h[2]=0,h[4]=0,h[5]=1,h[6]=0,h[8]=0,h[9]=0,h[10]=1,h}function Z(o,h){const e=h??new u(12);if(e===o){let p;return p=o[1],o[1]=o[4],o[4]=p,p=o[2],o[2]=o[8],o[8]=p,p=o[6],o[6]=o[9],o[9]=p,e}const c=o[0*4+0],l=o[0*4+1],w=o[0*4+2],y=o[1*4+0],t=o[1*4+1],r=o[1*4+2],n=o[2*4+0],s=o[2*4+1],a=o[2*4+2];return e[0]=c,e[1]=y,e[2]=n,e[4]=l,e[5]=t,e[6]=s,e[8]=w,e[9]=r,e[10]=a,e}function j(o,h){const e=h??new u(12),c=o[0*4+0],l=o[0*4+1],w=o[0*4+2],y=o[1*4+0],t=o[1*4+1],r=o[1*4+2],n=o[2*4+0],s=o[2*4+1],a=o[2*4+2],p=a*t-r*s,x=-a*y+r*n,i=s*y-t*n,f=1/(c*p+l*x+w*i);return e[0]=p*f,e[1]=(-a*l+w*s)*f,e[2]=(r*l-w*t)*f,e[4]=x*f,e[5]=(a*c-w*n)*f,e[6]=(-r*c+w*y)*f,e[8]=i*f,e[9]=(-s*c+l*n)*f,e[10]=(t*c-l*y)*f,e}function tt(o){const h=o[0],e=o[0*4+1],c=o[0*4+2],l=o[1*4+0],w=o[1*4+1],y=o[1*4+2],t=o[2*4+0],r=o[2*4+1],n=o[2*4+2];return h*(w*n-r*y)-l*(e*n-r*c)+t*(e*y-w*c)}const nt=j;function Pt(o,h,e){const c=e??new u(12),l=o[0],w=o[1],y=o[2],t=o[4],r=o[5],n=o[6],s=o[8],a=o[9],p=o[10],x=h[0],i=h[1],f=h[2],d=h[4],M=h[5],D=h[6],m=h[8],B=h[9],U=h[10];return c[0]=l*x+t*i+s*f,c[1]=w*x+r*i+a*f,c[2]=y*x+n*i+p*f,c[4]=l*d+t*M+s*D,c[5]=w*d+r*M+a*D,c[6]=y*d+n*M+p*D,c[8]=l*m+t*B+s*U,c[9]=w*m+r*B+a*U,c[10]=y*m+n*B+p*U,c}const ct=Pt;function et(o,h,e){const c=e??b();return o!==c&&(c[0]=o[0],c[1]=o[1],c[2]=o[2],c[4]=o[4],c[5]=o[5],c[6]=o[6]),c[8]=h[0],c[9]=h[1],c[10]=1,c}function St(o,h){const e=h??g.create();return e[0]=o[8],e[1]=o[9],e}function wt(o,h,e){const c=e??g.create(),l=h*4;return c[0]=o[l+0],c[1]=o[l+1],c}function rt(o,h,e,c){const l=c===o?o:N(o,c),w=e*4;return l[w+0]=h[0],l[w+1]=h[1],l}function zt(o,h){const e=h??g.create(),c=o[0],l=o[1],w=o[4],y=o[5];return e[0]=Math.sqrt(c*c+l*l),e[1]=Math.sqrt(w*w+y*y),e}function dt(o,h){const e=h??v.create(),c=o[0],l=o[1],w=o[2],y=o[4],t=o[5],r=o[6],n=o[8],s=o[9],a=o[10];return e[0]=Math.sqrt(c*c+l*l+w*w),e[1]=Math.sqrt(y*y+t*t+r*r),e[2]=Math.sqrt(n*n+s*s+a*a),e}function pt(o,h){const e=h??new u(12);return e[0]=1,e[1]=0,e[2]=0,e[4]=0,e[5]=1,e[6]=0,e[8]=o[0],e[9]=o[1],e[10]=1,e}function W(o,h,e){const c=e??new u(12),l=h[0],w=h[1],y=o[0],t=o[1],r=o[2],n=o[1*4+0],s=o[1*4+1],a=o[1*4+2],p=o[2*4+0],x=o[2*4+1],i=o[2*4+2];return o!==c&&(c[0]=y,c[1]=t,c[2]=r,c[4]=n,c[5]=s,c[6]=a),c[8]=y*l+n*w+p,c[9]=t*l+s*w+x,c[10]=r*l+a*w+i,c}function mt(o,h){const e=h??new u(12),c=Math.cos(o),l=Math.sin(o);return e[0]=c,e[1]=l,e[2]=0,e[4]=-l,e[5]=c,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function E(o,h,e){const c=e??new u(12),l=o[0*4+0],w=o[0*4+1],y=o[0*4+2],t=o[1*4+0],r=o[1*4+1],n=o[1*4+2],s=Math.cos(h),a=Math.sin(h);return c[0]=s*l+a*t,c[1]=s*w+a*r,c[2]=s*y+a*n,c[4]=s*t-a*l,c[5]=s*r-a*w,c[6]=s*n-a*y,o!==c&&(c[8]=o[8],c[9]=o[9],c[10]=o[10]),c}function Y(o,h){const e=h??new u(12),c=Math.cos(o),l=Math.sin(o);return e[0]=1,e[1]=0,e[2]=0,e[4]=0,e[5]=c,e[6]=l,e[8]=0,e[9]=-l,e[10]=c,e}function V(o,h,e){const c=e??new u(12),l=o[4],w=o[5],y=o[6],t=o[8],r=o[9],n=o[10],s=Math.cos(h),a=Math.sin(h);return c[4]=s*l+a*t,c[5]=s*w+a*r,c[6]=s*y+a*n,c[8]=s*t-a*l,c[9]=s*r-a*w,c[10]=s*n-a*y,o!==c&&(c[0]=o[0],c[1]=o[1],c[2]=o[2]),c}function Ut(o,h){const e=h??new u(12),c=Math.cos(o),l=Math.sin(o);return e[0]=c,e[1]=0,e[2]=-l,e[4]=0,e[5]=1,e[6]=0,e[8]=l,e[9]=0,e[10]=c,e}function st(o,h,e){const c=e??new u(12),l=o[0*4+0],w=o[0*4+1],y=o[0*4+2],t=o[2*4+0],r=o[2*4+1],n=o[2*4+2],s=Math.cos(h),a=Math.sin(h);return c[0]=s*l-a*t,c[1]=s*w-a*r,c[2]=s*y-a*n,c[8]=s*t+a*l,c[9]=s*r+a*w,c[10]=s*n+a*y,o!==c&&(c[4]=o[4],c[5]=o[5],c[6]=o[6]),c}const Lt=mt,Mt=E;function Ot(o,h){const e=h??new u(12);return e[0]=o[0],e[1]=0,e[2]=0,e[4]=0,e[5]=o[1],e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function X(o,h,e){const c=e??new u(12),l=h[0],w=h[1];return c[0]=l*o[0*4+0],c[1]=l*o[0*4+1],c[2]=l*o[0*4+2],c[4]=w*o[1*4+0],c[5]=w*o[1*4+1],c[6]=w*o[1*4+2],o!==c&&(c[8]=o[8],c[9]=o[9],c[10]=o[10]),c}function qt(o,h){const e=h??new u(12);return e[0]=o[0],e[1]=0,e[2]=0,e[4]=0,e[5]=o[1],e[6]=0,e[8]=0,e[9]=0,e[10]=o[2],e}function Bt(o,h,e){const c=e??new u(12),l=h[0],w=h[1],y=h[2];return c[0]=l*o[0*4+0],c[1]=l*o[0*4+1],c[2]=l*o[0*4+2],c[4]=w*o[1*4+0],c[5]=w*o[1*4+1],c[6]=w*o[1*4+2],c[8]=y*o[2*4+0],c[9]=y*o[2*4+1],c[10]=y*o[2*4+2],c}function Ft(o,h){const e=h??new u(12);return e[0]=o,e[1]=0,e[2]=0,e[4]=0,e[5]=o,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function vt(o,h,e){const c=e??new u(12);return c[0]=h*o[0*4+0],c[1]=h*o[0*4+1],c[2]=h*o[0*4+2],c[4]=h*o[1*4+0],c[5]=h*o[1*4+1],c[6]=h*o[1*4+2],o!==c&&(c[8]=o[8],c[9]=o[9],c[10]=o[10]),c}function Et(o,h){const e=h??new u(12);return e[0]=o,e[1]=0,e[2]=0,e[4]=0,e[5]=o,e[6]=0,e[8]=0,e[9]=0,e[10]=o,e}function Gt(o,h,e){const c=e??new u(12);return c[0]=h*o[0*4+0],c[1]=h*o[0*4+1],c[2]=h*o[0*4+2],c[4]=h*o[1*4+0],c[5]=h*o[1*4+1],c[6]=h*o[1*4+2],c[8]=h*o[2*4+0],c[9]=h*o[2*4+1],c[10]=h*o[2*4+2],c}return{clone:k,create:A,set:S,fromMat4:G,fromQuat:I,negate:R,copy:N,equalsApproximately:C,equals:F,identity:b,transpose:Z,inverse:j,invert:nt,determinant:tt,mul:ct,multiply:Pt,setTranslation:et,getTranslation:St,getAxis:wt,setAxis:rt,getScaling:zt,get3DScaling:dt,translation:pt,translate:W,rotation:mt,rotate:E,rotationX:Y,rotateX:V,rotationY:Ut,rotateY:st,rotationZ:Lt,rotateZ:Mt,scaling:Ot,scale:X,uniformScaling:Ft,uniformScale:vt,scaling3D:qt,scale3D:Bt,uniformScaling3D:Et,uniformScale3D:Gt}}const wn=new Map;function Fn(u){let g=wn.get(u);return g||(g=qn(u),wn.set(u,g)),g}function In(u){const g=nn(u);function v(t,r,n,s,a,p,x,i,f,d,M,D,m,B,U,T){const z=new u(16);return t!==void 0&&(z[0]=t,r!==void 0&&(z[1]=r,n!==void 0&&(z[2]=n,s!==void 0&&(z[3]=s,a!==void 0&&(z[4]=a,p!==void 0&&(z[5]=p,x!==void 0&&(z[6]=x,i!==void 0&&(z[7]=i,f!==void 0&&(z[8]=f,d!==void 0&&(z[9]=d,M!==void 0&&(z[10]=M,D!==void 0&&(z[11]=D,m!==void 0&&(z[12]=m,B!==void 0&&(z[13]=B,U!==void 0&&(z[14]=U,T!==void 0&&(z[15]=T)))))))))))))))),z}function A(t,r,n,s,a,p,x,i,f,d,M,D,m,B,U,T,z){const L=z??new u(16);return L[0]=t,L[1]=r,L[2]=n,L[3]=s,L[4]=a,L[5]=p,L[6]=x,L[7]=i,L[8]=f,L[9]=d,L[10]=M,L[11]=D,L[12]=m,L[13]=B,L[14]=U,L[15]=T,L}function S(t,r){const n=r??new u(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=0,n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=0,n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function G(t,r){const n=r??new u(16),s=t[0],a=t[1],p=t[2],x=t[3],i=s+s,f=a+a,d=p+p,M=s*i,D=a*i,m=a*f,B=p*i,U=p*f,T=p*d,z=x*i,L=x*f,O=x*d;return n[0]=1-m-T,n[1]=D+O,n[2]=B-L,n[3]=0,n[4]=D-O,n[5]=1-M-T,n[6]=U+z,n[7]=0,n[8]=B+L,n[9]=U-z,n[10]=1-M-m,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function I(t,r){const n=r??new u(16);return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n[4]=-t[4],n[5]=-t[5],n[6]=-t[6],n[7]=-t[7],n[8]=-t[8],n[9]=-t[9],n[10]=-t[10],n[11]=-t[11],n[12]=-t[12],n[13]=-t[13],n[14]=-t[14],n[15]=-t[15],n}function R(t,r){const n=r??new u(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}const N=R;function k(t,r){return Math.abs(t[0]-r[0])<_&&Math.abs(t[1]-r[1])<_&&Math.abs(t[2]-r[2])<_&&Math.abs(t[3]-r[3])<_&&Math.abs(t[4]-r[4])<_&&Math.abs(t[5]-r[5])<_&&Math.abs(t[6]-r[6])<_&&Math.abs(t[7]-r[7])<_&&Math.abs(t[8]-r[8])<_&&Math.abs(t[9]-r[9])<_&&Math.abs(t[10]-r[10])<_&&Math.abs(t[11]-r[11])<_&&Math.abs(t[12]-r[12])<_&&Math.abs(t[13]-r[13])<_&&Math.abs(t[14]-r[14])<_&&Math.abs(t[15]-r[15])<_}function C(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]&&t[4]===r[4]&&t[5]===r[5]&&t[6]===r[6]&&t[7]===r[7]&&t[8]===r[8]&&t[9]===r[9]&&t[10]===r[10]&&t[11]===r[11]&&t[12]===r[12]&&t[13]===r[13]&&t[14]===r[14]&&t[15]===r[15]}function F(t){const r=t??new u(16);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function b(t,r){const n=r??new u(16);if(n===t){let q;return q=t[1],t[1]=t[4],t[4]=q,q=t[2],t[2]=t[8],t[8]=q,q=t[3],t[3]=t[12],t[12]=q,q=t[6],t[6]=t[9],t[9]=q,q=t[7],t[7]=t[13],t[13]=q,q=t[11],t[11]=t[14],t[14]=q,n}const s=t[0*4+0],a=t[0*4+1],p=t[0*4+2],x=t[0*4+3],i=t[1*4+0],f=t[1*4+1],d=t[1*4+2],M=t[1*4+3],D=t[2*4+0],m=t[2*4+1],B=t[2*4+2],U=t[2*4+3],T=t[3*4+0],z=t[3*4+1],L=t[3*4+2],O=t[3*4+3];return n[0]=s,n[1]=i,n[2]=D,n[3]=T,n[4]=a,n[5]=f,n[6]=m,n[7]=z,n[8]=p,n[9]=d,n[10]=B,n[11]=L,n[12]=x,n[13]=M,n[14]=U,n[15]=O,n}function Z(t,r){const n=r??new u(16),s=t[0*4+0],a=t[0*4+1],p=t[0*4+2],x=t[0*4+3],i=t[1*4+0],f=t[1*4+1],d=t[1*4+2],M=t[1*4+3],D=t[2*4+0],m=t[2*4+1],B=t[2*4+2],U=t[2*4+3],T=t[3*4+0],z=t[3*4+1],L=t[3*4+2],O=t[3*4+3],q=B*O,$=L*U,K=d*O,J=L*M,ot=d*U,it=B*M,at=p*O,ut=L*x,ft=p*U,lt=B*x,gt=p*M,Dt=d*x,yt=D*z,xt=T*m,Tt=i*z,_t=T*f,Vt=i*m,Zt=D*f,bt=s*z,jt=T*a,Wt=s*m,Kt=D*a,Jt=s*f,kt=i*a,rn=q*f+J*m+ot*z-($*f+K*m+it*z),an=$*a+at*m+lt*z-(q*a+ut*m+ft*z),un=K*a+ut*f+gt*z-(J*a+at*f+Dt*z),fn=it*a+ft*f+Dt*m-(ot*a+lt*f+gt*m),ht=1/(s*rn+i*an+D*un+T*fn);return n[0]=ht*rn,n[1]=ht*an,n[2]=ht*un,n[3]=ht*fn,n[4]=ht*($*i+K*D+it*T-(q*i+J*D+ot*T)),n[5]=ht*(q*s+ut*D+ft*T-($*s+at*D+lt*T)),n[6]=ht*(J*s+at*i+Dt*T-(K*s+ut*i+gt*T)),n[7]=ht*(ot*s+lt*i+gt*D-(it*s+ft*i+Dt*D)),n[8]=ht*(yt*M+_t*U+Vt*O-(xt*M+Tt*U+Zt*O)),n[9]=ht*(xt*x+bt*U+Kt*O-(yt*x+jt*U+Wt*O)),n[10]=ht*(Tt*x+jt*M+Jt*O-(_t*x+bt*M+kt*O)),n[11]=ht*(Zt*x+Wt*M+kt*U-(Vt*x+Kt*M+Jt*U)),n[12]=ht*(Tt*B+Zt*L+xt*d-(Vt*L+yt*d+_t*B)),n[13]=ht*(Wt*L+yt*p+jt*B-(bt*B+Kt*L+xt*p)),n[14]=ht*(bt*d+kt*L+_t*p-(Jt*L+Tt*p+jt*d)),n[15]=ht*(Jt*B+Vt*p+Kt*d-(Wt*d+kt*B+Zt*p)),n}function j(t){const r=t[0],n=t[0*4+1],s=t[0*4+2],a=t[0*4+3],p=t[1*4+0],x=t[1*4+1],i=t[1*4+2],f=t[1*4+3],d=t[2*4+0],M=t[2*4+1],D=t[2*4+2],m=t[2*4+3],B=t[3*4+0],U=t[3*4+1],T=t[3*4+2],z=t[3*4+3],L=D*z,O=T*m,q=i*z,$=T*f,K=i*m,J=D*f,ot=s*z,it=T*a,at=s*m,ut=D*a,ft=s*f,lt=i*a,gt=L*x+$*M+K*U-(O*x+q*M+J*U),Dt=O*n+ot*M+ut*U-(L*n+it*M+at*U),yt=q*n+it*x+ft*U-($*n+ot*x+lt*U),xt=J*n+at*x+lt*M-(K*n+ut*x+ft*M);return r*gt+p*Dt+d*yt+B*xt}const tt=Z;function nt(t,r,n){const s=n??new u(16),a=t[0],p=t[1],x=t[2],i=t[3],f=t[4],d=t[5],M=t[6],D=t[7],m=t[8],B=t[9],U=t[10],T=t[11],z=t[12],L=t[13],O=t[14],q=t[15],$=r[0],K=r[1],J=r[2],ot=r[3],it=r[4],at=r[5],ut=r[6],ft=r[7],lt=r[8],gt=r[9],Dt=r[10],yt=r[11],xt=r[12],Tt=r[13],_t=r[14],Vt=r[15];return s[0]=a*$+f*K+m*J+z*ot,s[1]=p*$+d*K+B*J+L*ot,s[2]=x*$+M*K+U*J+O*ot,s[3]=i*$+D*K+T*J+q*ot,s[4]=a*it+f*at+m*ut+z*ft,s[5]=p*it+d*at+B*ut+L*ft,s[6]=x*it+M*at+U*ut+O*ft,s[7]=i*it+D*at+T*ut+q*ft,s[8]=a*lt+f*gt+m*Dt+z*yt,s[9]=p*lt+d*gt+B*Dt+L*yt,s[10]=x*lt+M*gt+U*Dt+O*yt,s[11]=i*lt+D*gt+T*Dt+q*yt,s[12]=a*xt+f*Tt+m*_t+z*Vt,s[13]=p*xt+d*Tt+B*_t+L*Vt,s[14]=x*xt+M*Tt+U*_t+O*Vt,s[15]=i*xt+D*Tt+T*_t+q*Vt,s}const Pt=nt;function ct(t,r,n){const s=n??F();return t!==s&&(s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11]),s[12]=r[0],s[13]=r[1],s[14]=r[2],s[15]=1,s}function et(t,r){const n=r??g.create();return n[0]=t[12],n[1]=t[13],n[2]=t[14],n}function St(t,r,n){const s=n??g.create(),a=r*4;return s[0]=t[a+0],s[1]=t[a+1],s[2]=t[a+2],s}function wt(t,r,n,s){const a=s===t?s:R(t,s),p=n*4;return a[p+0]=r[0],a[p+1]=r[1],a[p+2]=r[2],a}function rt(t,r){const n=r??g.create(),s=t[0],a=t[1],p=t[2],x=t[4],i=t[5],f=t[6],d=t[8],M=t[9],D=t[10];return n[0]=Math.sqrt(s*s+a*a+p*p),n[1]=Math.sqrt(x*x+i*i+f*f),n[2]=Math.sqrt(d*d+M*M+D*D),n}function zt(t,r,n,s,a){const p=a??new u(16),x=Math.tan(Math.PI*.5-.5*t);if(p[0]=x/r,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=x,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,Number.isFinite(s)){const i=1/(n-s);p[10]=s*i,p[14]=s*n*i}else p[10]=-1,p[14]=-n;return p}function dt(t,r,n,s=1/0,a){const p=a??new u(16),x=1/Math.tan(t*.5);if(p[0]=x/r,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=x,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,s===1/0)p[10]=0,p[14]=n;else{const i=1/(s-n);p[10]=n*i,p[14]=s*n*i}return p}function pt(t,r,n,s,a,p,x){const i=x??new u(16);return i[0]=2/(r-t),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/(s-n),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1/(a-p),i[11]=0,i[12]=(r+t)/(t-r),i[13]=(s+n)/(n-s),i[14]=a/(a-p),i[15]=1,i}function W(t,r,n,s,a,p,x){const i=x??new u(16),f=r-t,d=s-n,M=a-p;return i[0]=2*a/f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*a/d,i[6]=0,i[7]=0,i[8]=(t+r)/f,i[9]=(s+n)/d,i[10]=p/M,i[11]=-1,i[12]=0,i[13]=0,i[14]=a*p/M,i[15]=0,i}function mt(t,r,n,s,a,p=1/0,x){const i=x??new u(16),f=r-t,d=s-n;if(i[0]=2*a/f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*a/d,i[6]=0,i[7]=0,i[8]=(t+r)/f,i[9]=(s+n)/d,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p===1/0)i[10]=0,i[14]=a;else{const M=1/(p-a);i[10]=a*M,i[14]=p*a*M}return i}const E=g.create(),Y=g.create(),V=g.create();function Ut(t,r,n,s){const a=s??new u(16);return g.normalize(g.subtract(r,t,V),V),g.normalize(g.cross(n,V,E),E),g.normalize(g.cross(V,E,Y),Y),a[0]=E[0],a[1]=E[1],a[2]=E[2],a[3]=0,a[4]=Y[0],a[5]=Y[1],a[6]=Y[2],a[7]=0,a[8]=V[0],a[9]=V[1],a[10]=V[2],a[11]=0,a[12]=t[0],a[13]=t[1],a[14]=t[2],a[15]=1,a}function st(t,r,n,s){const a=s??new u(16);return g.normalize(g.subtract(t,r,V),V),g.normalize(g.cross(n,V,E),E),g.normalize(g.cross(V,E,Y),Y),a[0]=E[0],a[1]=E[1],a[2]=E[2],a[3]=0,a[4]=Y[0],a[5]=Y[1],a[6]=Y[2],a[7]=0,a[8]=V[0],a[9]=V[1],a[10]=V[2],a[11]=0,a[12]=t[0],a[13]=t[1],a[14]=t[2],a[15]=1,a}function Lt(t,r,n,s){const a=s??new u(16);return g.normalize(g.subtract(t,r,V),V),g.normalize(g.cross(n,V,E),E),g.normalize(g.cross(V,E,Y),Y),a[0]=E[0],a[1]=Y[0],a[2]=V[0],a[3]=0,a[4]=E[1],a[5]=Y[1],a[6]=V[1],a[7]=0,a[8]=E[2],a[9]=Y[2],a[10]=V[2],a[11]=0,a[12]=-(E[0]*t[0]+E[1]*t[1]+E[2]*t[2]),a[13]=-(Y[0]*t[0]+Y[1]*t[1]+Y[2]*t[2]),a[14]=-(V[0]*t[0]+V[1]*t[1]+V[2]*t[2]),a[15]=1,a}function Mt(t,r){const n=r??new u(16);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n}function Ot(t,r,n){const s=n??new u(16),a=r[0],p=r[1],x=r[2],i=t[0],f=t[1],d=t[2],M=t[3],D=t[1*4+0],m=t[1*4+1],B=t[1*4+2],U=t[1*4+3],T=t[2*4+0],z=t[2*4+1],L=t[2*4+2],O=t[2*4+3],q=t[3*4+0],$=t[3*4+1],K=t[3*4+2],J=t[3*4+3];return t!==s&&(s[0]=i,s[1]=f,s[2]=d,s[3]=M,s[4]=D,s[5]=m,s[6]=B,s[7]=U,s[8]=T,s[9]=z,s[10]=L,s[11]=O),s[12]=i*a+D*p+T*x+q,s[13]=f*a+m*p+z*x+$,s[14]=d*a+B*p+L*x+K,s[15]=M*a+U*p+O*x+J,s}function X(t,r){const n=r??new u(16),s=Math.cos(t),a=Math.sin(t);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=a,n[7]=0,n[8]=0,n[9]=-a,n[10]=s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function qt(t,r,n){const s=n??new u(16),a=t[4],p=t[5],x=t[6],i=t[7],f=t[8],d=t[9],M=t[10],D=t[11],m=Math.cos(r),B=Math.sin(r);return s[4]=m*a+B*f,s[5]=m*p+B*d,s[6]=m*x+B*M,s[7]=m*i+B*D,s[8]=m*f-B*a,s[9]=m*d-B*p,s[10]=m*M-B*x,s[11]=m*D-B*i,t!==s&&(s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s}function Bt(t,r){const n=r??new u(16),s=Math.cos(t),a=Math.sin(t);return n[0]=s,n[1]=0,n[2]=-a,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=a,n[9]=0,n[10]=s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ft(t,r,n){const s=n??new u(16),a=t[0*4+0],p=t[0*4+1],x=t[0*4+2],i=t[0*4+3],f=t[2*4+0],d=t[2*4+1],M=t[2*4+2],D=t[2*4+3],m=Math.cos(r),B=Math.sin(r);return s[0]=m*a-B*f,s[1]=m*p-B*d,s[2]=m*x-B*M,s[3]=m*i-B*D,s[8]=m*f+B*a,s[9]=m*d+B*p,s[10]=m*M+B*x,s[11]=m*D+B*i,t!==s&&(s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s}function vt(t,r){const n=r??new u(16),s=Math.cos(t),a=Math.sin(t);return n[0]=s,n[1]=a,n[2]=0,n[3]=0,n[4]=-a,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Et(t,r,n){const s=n??new u(16),a=t[0*4+0],p=t[0*4+1],x=t[0*4+2],i=t[0*4+3],f=t[1*4+0],d=t[1*4+1],M=t[1*4+2],D=t[1*4+3],m=Math.cos(r),B=Math.sin(r);return s[0]=m*a+B*f,s[1]=m*p+B*d,s[2]=m*x+B*M,s[3]=m*i+B*D,s[4]=m*f-B*a,s[5]=m*d-B*p,s[6]=m*M-B*x,s[7]=m*D-B*i,t!==s&&(s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s}function Gt(t,r,n){const s=n??new u(16);let a=t[0],p=t[1],x=t[2];const i=Math.sqrt(a*a+p*p+x*x);a/=i,p/=i,x/=i;const f=a*a,d=p*p,M=x*x,D=Math.cos(r),m=Math.sin(r),B=1-D;return s[0]=f+(1-f)*D,s[1]=a*p*B+x*m,s[2]=a*x*B-p*m,s[3]=0,s[4]=a*p*B-x*m,s[5]=d+(1-d)*D,s[6]=p*x*B+a*m,s[7]=0,s[8]=a*x*B+p*m,s[9]=p*x*B-a*m,s[10]=M+(1-M)*D,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}const o=Gt;function h(t,r,n,s){const a=s??new u(16);let p=r[0],x=r[1],i=r[2];const f=Math.sqrt(p*p+x*x+i*i);p/=f,x/=f,i/=f;const d=p*p,M=x*x,D=i*i,m=Math.cos(n),B=Math.sin(n),U=1-m,T=d+(1-d)*m,z=p*x*U+i*B,L=p*i*U-x*B,O=p*x*U-i*B,q=M+(1-M)*m,$=x*i*U+p*B,K=p*i*U+x*B,J=x*i*U-p*B,ot=D+(1-D)*m,it=t[0],at=t[1],ut=t[2],ft=t[3],lt=t[4],gt=t[5],Dt=t[6],yt=t[7],xt=t[8],Tt=t[9],_t=t[10],Vt=t[11];return a[0]=T*it+z*lt+L*xt,a[1]=T*at+z*gt+L*Tt,a[2]=T*ut+z*Dt+L*_t,a[3]=T*ft+z*yt+L*Vt,a[4]=O*it+q*lt+$*xt,a[5]=O*at+q*gt+$*Tt,a[6]=O*ut+q*Dt+$*_t,a[7]=O*ft+q*yt+$*Vt,a[8]=K*it+J*lt+ot*xt,a[9]=K*at+J*gt+ot*Tt,a[10]=K*ut+J*Dt+ot*_t,a[11]=K*ft+J*yt+ot*Vt,t!==a&&(a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a}const e=h;function c(t,r){const n=r??new u(16);return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function l(t,r,n){const s=n??new u(16),a=r[0],p=r[1],x=r[2];return s[0]=a*t[0*4+0],s[1]=a*t[0*4+1],s[2]=a*t[0*4+2],s[3]=a*t[0*4+3],s[4]=p*t[1*4+0],s[5]=p*t[1*4+1],s[6]=p*t[1*4+2],s[7]=p*t[1*4+3],s[8]=x*t[2*4+0],s[9]=x*t[2*4+1],s[10]=x*t[2*4+2],s[11]=x*t[2*4+3],t!==s&&(s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s}function w(t,r){const n=r??new u(16);return n[0]=t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function y(t,r,n){const s=n??new u(16);return s[0]=r*t[0*4+0],s[1]=r*t[0*4+1],s[2]=r*t[0*4+2],s[3]=r*t[0*4+3],s[4]=r*t[1*4+0],s[5]=r*t[1*4+1],s[6]=r*t[1*4+2],s[7]=r*t[1*4+3],s[8]=r*t[2*4+0],s[9]=r*t[2*4+1],s[10]=r*t[2*4+2],s[11]=r*t[2*4+3],t!==s&&(s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s}return{create:v,set:A,fromMat3:S,fromQuat:G,negate:I,copy:R,clone:N,equalsApproximately:k,equals:C,identity:F,transpose:b,inverse:Z,determinant:j,invert:tt,multiply:nt,mul:Pt,setTranslation:ct,getTranslation:et,getAxis:St,setAxis:wt,getScaling:rt,perspective:zt,perspectiveReverseZ:dt,ortho:pt,frustum:W,frustumReverseZ:mt,aim:Ut,cameraAim:st,lookAt:Lt,translation:Mt,translate:Ot,rotationX:X,rotateX:qt,rotationY:Bt,rotateY:Ft,rotationZ:vt,rotateZ:Et,axisRotation:Gt,rotation:o,axisRotate:h,rotate:e,scaling:c,scale:l,uniformScaling:w,uniformScale:y}}const dn=new Map;function Nn(u){let g=dn.get(u);return g||(g=In(u),dn.set(u,g)),g}function Yn(u){const g=nn(u);function v(o,h,e,c){const l=new u(4);return o!==void 0&&(l[0]=o,h!==void 0&&(l[1]=h,e!==void 0&&(l[2]=e,c!==void 0&&(l[3]=c)))),l}const A=v;function S(o,h,e,c,l){const w=l??new u(4);return w[0]=o,w[1]=h,w[2]=e,w[3]=c,w}function G(o,h,e){const c=e??new u(4),l=h*.5,w=Math.sin(l);return c[0]=w*o[0],c[1]=w*o[1],c[2]=w*o[2],c[3]=Math.cos(l),c}function I(o,h){const e=h??g.create(3),c=Math.acos(o[3])*2,l=Math.sin(c*.5);return l>_?(e[0]=o[0]/l,e[1]=o[1]/l,e[2]=o[2]/l):(e[0]=1,e[1]=0,e[2]=0),{angle:c,axis:e}}function R(o,h){const e=W(o,h);return Math.acos(2*e*e-1)}function N(o,h,e){const c=e??new u(4),l=o[0],w=o[1],y=o[2],t=o[3],r=h[0],n=h[1],s=h[2],a=h[3];return c[0]=l*a+t*r+w*s-y*n,c[1]=w*a+t*n+y*r-l*s,c[2]=y*a+t*s+l*n-w*r,c[3]=t*a-l*r-w*n-y*s,c}const k=N;function C(o,h,e){const c=e??new u(4),l=h*.5,w=o[0],y=o[1],t=o[2],r=o[3],n=Math.sin(l),s=Math.cos(l);return c[0]=w*s+r*n,c[1]=y*s+t*n,c[2]=t*s-y*n,c[3]=r*s-w*n,c}function F(o,h,e){const c=e??new u(4),l=h*.5,w=o[0],y=o[1],t=o[2],r=o[3],n=Math.sin(l),s=Math.cos(l);return c[0]=w*s-t*n,c[1]=y*s+r*n,c[2]=t*s+w*n,c[3]=r*s-y*n,c}function b(o,h,e){const c=e??new u(4),l=h*.5,w=o[0],y=o[1],t=o[2],r=o[3],n=Math.sin(l),s=Math.cos(l);return c[0]=w*s+y*n,c[1]=y*s-w*n,c[2]=t*s+r*n,c[3]=r*s-t*n,c}function Z(o,h,e,c){const l=c??new u(4),w=o[0],y=o[1],t=o[2],r=o[3];let n=h[0],s=h[1],a=h[2],p=h[3],x=w*n+y*s+t*a+r*p;x<0&&(x=-x,n=-n,s=-s,a=-a,p=-p);let i,f;if(1-x>_){const d=Math.acos(x),M=Math.sin(d);i=Math.sin((1-e)*d)/M,f=Math.sin(e*d)/M}else i=1-e,f=e;return l[0]=i*w+f*n,l[1]=i*y+f*s,l[2]=i*t+f*a,l[3]=i*r+f*p,l}function j(o,h){const e=h??new u(4),c=o[0],l=o[1],w=o[2],y=o[3],t=c*c+l*l+w*w+y*y,r=t?1/t:0;return e[0]=-c*r,e[1]=-l*r,e[2]=-w*r,e[3]=y*r,e}function tt(o,h){const e=h??new u(4);return e[0]=-o[0],e[1]=-o[1],e[2]=-o[2],e[3]=o[3],e}function nt(o,h){const e=h??new u(4),c=o[0]+o[5]+o[10];if(c>0){const l=Math.sqrt(c+1);e[3]=.5*l;const w=.5/l;e[0]=(o[6]-o[9])*w,e[1]=(o[8]-o[2])*w,e[2]=(o[1]-o[4])*w}else{let l=0;o[5]>o[0]&&(l=1),o[10]>o[l*4+l]&&(l=2);const w=(l+1)%3,y=(l+2)%3,t=Math.sqrt(o[l*4+l]-o[w*4+w]-o[y*4+y]+1);e[l]=.5*t;const r=.5/t;e[3]=(o[w*4+y]-o[y*4+w])*r,e[w]=(o[w*4+l]+o[l*4+w])*r,e[y]=(o[y*4+l]+o[l*4+y])*r}return e}function Pt(o,h,e,c,l){const w=l??new u(4),y=o*.5,t=h*.5,r=e*.5,n=Math.sin(y),s=Math.cos(y),a=Math.sin(t),p=Math.cos(t),x=Math.sin(r),i=Math.cos(r);switch(c){case"xyz":w[0]=n*p*i+s*a*x,w[1]=s*a*i-n*p*x,w[2]=s*p*x+n*a*i,w[3]=s*p*i-n*a*x;break;case"xzy":w[0]=n*p*i-s*a*x,w[1]=s*a*i-n*p*x,w[2]=s*p*x+n*a*i,w[3]=s*p*i+n*a*x;break;case"yxz":w[0]=n*p*i+s*a*x,w[1]=s*a*i-n*p*x,w[2]=s*p*x-n*a*i,w[3]=s*p*i+n*a*x;break;case"yzx":w[0]=n*p*i+s*a*x,w[1]=s*a*i+n*p*x,w[2]=s*p*x-n*a*i,w[3]=s*p*i-n*a*x;break;case"zxy":w[0]=n*p*i-s*a*x,w[1]=s*a*i+n*p*x,w[2]=s*p*x+n*a*i,w[3]=s*p*i-n*a*x;break;case"zyx":w[0]=n*p*i-s*a*x,w[1]=s*a*i+n*p*x,w[2]=s*p*x-n*a*i,w[3]=s*p*i+n*a*x;break;default:throw new Error(`Unknown rotation order: ${c}`)}return w}function ct(o,h){const e=h??new u(4);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e}const et=ct;function St(o,h,e){const c=e??new u(4);return c[0]=o[0]+h[0],c[1]=o[1]+h[1],c[2]=o[2]+h[2],c[3]=o[3]+h[3],c}function wt(o,h,e){const c=e??new u(4);return c[0]=o[0]-h[0],c[1]=o[1]-h[1],c[2]=o[2]-h[2],c[3]=o[3]-h[3],c}const rt=wt;function zt(o,h,e){const c=e??new u(4);return c[0]=o[0]*h,c[1]=o[1]*h,c[2]=o[2]*h,c[3]=o[3]*h,c}const dt=zt;function pt(o,h,e){const c=e??new u(4);return c[0]=o[0]/h,c[1]=o[1]/h,c[2]=o[2]/h,c[3]=o[3]/h,c}function W(o,h){return o[0]*h[0]+o[1]*h[1]+o[2]*h[2]+o[3]*h[3]}function mt(o,h,e,c){const l=c??new u(4);return l[0]=o[0]+e*(h[0]-o[0]),l[1]=o[1]+e*(h[1]-o[1]),l[2]=o[2]+e*(h[2]-o[2]),l[3]=o[3]+e*(h[3]-o[3]),l}function E(o){const h=o[0],e=o[1],c=o[2],l=o[3];return Math.sqrt(h*h+e*e+c*c+l*l)}const Y=E;function V(o){const h=o[0],e=o[1],c=o[2],l=o[3];return h*h+e*e+c*c+l*l}const Ut=V;function st(o,h){const e=h??new u(4),c=o[0],l=o[1],w=o[2],y=o[3],t=Math.sqrt(c*c+l*l+w*w+y*y);return t>1e-5?(e[0]=c/t,e[1]=l/t,e[2]=w/t,e[3]=y/t):(e[0]=0,e[1]=0,e[2]=0,e[3]=1),e}function Lt(o,h){return Math.abs(o[0]-h[0])<_&&Math.abs(o[1]-h[1])<_&&Math.abs(o[2]-h[2])<_&&Math.abs(o[3]-h[3])<_}function Mt(o,h){return o[0]===h[0]&&o[1]===h[1]&&o[2]===h[2]&&o[3]===h[3]}function Ot(o){const h=o??new u(4);return h[0]=0,h[1]=0,h[2]=0,h[3]=1,h}const X=g.create(),qt=g.create(),Bt=g.create();function Ft(o,h,e){const c=e??new u(4),l=g.dot(o,h);return l<-.999999?(g.cross(qt,o,X),g.len(X)<1e-6&&g.cross(Bt,o,X),g.normalize(X,X),G(X,Math.PI,c),c):l>.999999?(c[0]=0,c[1]=0,c[2]=0,c[3]=1,c):(g.cross(o,h,X),c[0]=X[0],c[1]=X[1],c[2]=X[2],c[3]=1+l,st(c,c))}const vt=new u(4),Et=new u(4);function Gt(o,h,e,c,l,w){const y=w??new u(4);return Z(o,c,l,vt),Z(h,e,l,Et),Z(vt,Et,2*l*(1-l),y),y}return{create:v,fromValues:A,set:S,fromAxisAngle:G,toAxisAngle:I,angle:R,multiply:N,mul:k,rotateX:C,rotateY:F,rotateZ:b,slerp:Z,inverse:j,conjugate:tt,fromMat:nt,fromEuler:Pt,copy:ct,clone:et,add:St,subtract:wt,sub:rt,mulScalar:zt,scale:dt,divScalar:pt,dot:W,lerp:mt,length:E,len:Y,lengthSq:V,lenSq:Ut,normalize:st,equalsApproximately:Lt,equals:Mt,identity:Ot,rotationTo:Ft,sqlerp:Gt}}const pn=new Map;function Rn(u){let g=pn.get(u);return g||(g=Yn(u),pn.set(u,g)),g}function Xn(u){function g(e,c,l,w){const y=new u(4);return e!==void 0&&(y[0]=e,c!==void 0&&(y[1]=c,l!==void 0&&(y[2]=l,w!==void 0&&(y[3]=w)))),y}const v=g;function A(e,c,l,w,y){const t=y??new u(4);return t[0]=e,t[1]=c,t[2]=l,t[3]=w,t}function S(e,c){const l=c??new u(4);return l[0]=Math.ceil(e[0]),l[1]=Math.ceil(e[1]),l[2]=Math.ceil(e[2]),l[3]=Math.ceil(e[3]),l}function G(e,c){const l=c??new u(4);return l[0]=Math.floor(e[0]),l[1]=Math.floor(e[1]),l[2]=Math.floor(e[2]),l[3]=Math.floor(e[3]),l}function I(e,c){const l=c??new u(4);return l[0]=Math.round(e[0]),l[1]=Math.round(e[1]),l[2]=Math.round(e[2]),l[3]=Math.round(e[3]),l}function R(e,c=0,l=1,w){const y=w??new u(4);return y[0]=Math.min(l,Math.max(c,e[0])),y[1]=Math.min(l,Math.max(c,e[1])),y[2]=Math.min(l,Math.max(c,e[2])),y[3]=Math.min(l,Math.max(c,e[3])),y}function N(e,c,l){const w=l??new u(4);return w[0]=e[0]+c[0],w[1]=e[1]+c[1],w[2]=e[2]+c[2],w[3]=e[3]+c[3],w}function k(e,c,l,w){const y=w??new u(4);return y[0]=e[0]+c[0]*l,y[1]=e[1]+c[1]*l,y[2]=e[2]+c[2]*l,y[3]=e[3]+c[3]*l,y}function C(e,c,l){const w=l??new u(4);return w[0]=e[0]-c[0],w[1]=e[1]-c[1],w[2]=e[2]-c[2],w[3]=e[3]-c[3],w}const F=C;function b(e,c){return Math.abs(e[0]-c[0])<_&&Math.abs(e[1]-c[1])<_&&Math.abs(e[2]-c[2])<_&&Math.abs(e[3]-c[3])<_}function Z(e,c){return e[0]===c[0]&&e[1]===c[1]&&e[2]===c[2]&&e[3]===c[3]}function j(e,c,l,w){const y=w??new u(4);return y[0]=e[0]+l*(c[0]-e[0]),y[1]=e[1]+l*(c[1]-e[1]),y[2]=e[2]+l*(c[2]-e[2]),y[3]=e[3]+l*(c[3]-e[3]),y}function tt(e,c,l,w){const y=w??new u(4);return y[0]=e[0]+l[0]*(c[0]-e[0]),y[1]=e[1]+l[1]*(c[1]-e[1]),y[2]=e[2]+l[2]*(c[2]-e[2]),y[3]=e[3]+l[3]*(c[3]-e[3]),y}function nt(e,c,l){const w=l??new u(4);return w[0]=Math.max(e[0],c[0]),w[1]=Math.max(e[1],c[1]),w[2]=Math.max(e[2],c[2]),w[3]=Math.max(e[3],c[3]),w}function Pt(e,c,l){const w=l??new u(4);return w[0]=Math.min(e[0],c[0]),w[1]=Math.min(e[1],c[1]),w[2]=Math.min(e[2],c[2]),w[3]=Math.min(e[3],c[3]),w}function ct(e,c,l){const w=l??new u(4);return w[0]=e[0]*c,w[1]=e[1]*c,w[2]=e[2]*c,w[3]=e[3]*c,w}const et=ct;function St(e,c,l){const w=l??new u(4);return w[0]=e[0]/c,w[1]=e[1]/c,w[2]=e[2]/c,w[3]=e[3]/c,w}function wt(e,c){const l=c??new u(4);return l[0]=1/e[0],l[1]=1/e[1],l[2]=1/e[2],l[3]=1/e[3],l}const rt=wt;function zt(e,c){return e[0]*c[0]+e[1]*c[1]+e[2]*c[2]+e[3]*c[3]}function dt(e){const c=e[0],l=e[1],w=e[2],y=e[3];return Math.sqrt(c*c+l*l+w*w+y*y)}const pt=dt;function W(e){const c=e[0],l=e[1],w=e[2],y=e[3];return c*c+l*l+w*w+y*y}const mt=W;function E(e,c){const l=e[0]-c[0],w=e[1]-c[1],y=e[2]-c[2],t=e[3]-c[3];return Math.sqrt(l*l+w*w+y*y+t*t)}const Y=E;function V(e,c){const l=e[0]-c[0],w=e[1]-c[1],y=e[2]-c[2],t=e[3]-c[3];return l*l+w*w+y*y+t*t}const Ut=V;function st(e,c){const l=c??new u(4),w=e[0],y=e[1],t=e[2],r=e[3],n=Math.sqrt(w*w+y*y+t*t+r*r);return n>1e-5?(l[0]=w/n,l[1]=y/n,l[2]=t/n,l[3]=r/n):(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function Lt(e,c){const l=c??new u(4);return l[0]=-e[0],l[1]=-e[1],l[2]=-e[2],l[3]=-e[3],l}function Mt(e,c){const l=c??new u(4);return l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l}const Ot=Mt;function X(e,c,l){const w=l??new u(4);return w[0]=e[0]*c[0],w[1]=e[1]*c[1],w[2]=e[2]*c[2],w[3]=e[3]*c[3],w}const qt=X;function Bt(e,c,l){const w=l??new u(4);return w[0]=e[0]/c[0],w[1]=e[1]/c[1],w[2]=e[2]/c[2],w[3]=e[3]/c[3],w}const Ft=Bt;function vt(e){const c=e??new u(4);return c[0]=0,c[1]=0,c[2]=0,c[3]=0,c}function Et(e,c,l){const w=l??new u(4),y=e[0],t=e[1],r=e[2],n=e[3];return w[0]=c[0]*y+c[4]*t+c[8]*r+c[12]*n,w[1]=c[1]*y+c[5]*t+c[9]*r+c[13]*n,w[2]=c[2]*y+c[6]*t+c[10]*r+c[14]*n,w[3]=c[3]*y+c[7]*t+c[11]*r+c[15]*n,w}function Gt(e,c,l){const w=l??new u(4);return st(e,w),ct(w,c,w)}function o(e,c,l){const w=l??new u(4);return dt(e)>c?Gt(e,c,w):Mt(e,w)}function h(e,c,l){const w=l??new u(4);return j(e,c,.5,w)}return{create:g,fromValues:v,set:A,ceil:S,floor:G,round:I,clamp:R,add:N,addScaled:k,subtract:C,sub:F,equalsApproximately:b,equals:Z,lerp:j,lerpV:tt,max:nt,min:Pt,mulScalar:ct,scale:et,divScalar:St,inverse:wt,invert:rt,dot:zt,length:dt,len:pt,lengthSq:W,lenSq:mt,distance:E,dist:Y,distanceSq:V,distSq:Ut,normalize:st,negate:Lt,copy:Mt,clone:Ot,multiply:X,mul:qt,divide:Bt,div:Ft,zero:vt,transformMat4:Et,setLength:Gt,truncate:o,midpoint:h}}const Mn=new Map;function $n(u){let g=Mn.get(u);return g||(g=Xn(u),Mn.set(u,g)),g}function cn(u,g,v,A,S,G){return{mat3:Fn(u),mat4:Nn(g),quat:Rn(v),vec2:Dn(A),vec3:nn(S),vec4:$n(G)}}const{mat3:Me,mat4:Q,quat:Ct,vec2:ge,vec3:At,vec4:De}=cn(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);cn(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);cn(zn,Array,Array,Array,Array,Array);const Nt={vsync:!1,resolution:{width:1024,height:768}};let tn,yn,xn;const Qn="back";async function Hn(){const u=await navigator.gpu.requestAdapter();if(!u)throw new Error("No appropriate GPU Adapter found!");tn=await u.requestDevice(),yn=tn.queue,jn()}function H(){return tn}function It(){return yn}const Zn={cullMode:Qn,topology:"triangle-list"};Q.perspective(2*Math.PI/5,Nt.resolution.width/Nt.resolution.height,1,100);const bn={depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"};function jn(){xn=tn.createTexture({size:[Nt.resolution.width,Nt.resolution.height,1],dimension:"2d",format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC})}function Wn(){return xn.createView()}async function mn(u){const v=await(await fetch(u)).blob();return await createImageBitmap(v)}function Kn(u,g,v){return Math.max(g,Math.min(u,v))}class Jn{constructor(){P(this,"position_",At.fromValues(0,0,0));P(this,"rotation_",At.fromValues(0,0,0));P(this,"scale_",At.fromValues(1,1,1));P(this,"dirty",!0);P(this,"mvpMatrix_",Q.create());P(this,"modelMatrix_",Q.create())}setScale(g=1,v=1,A=1){g*v*A!==0&&(this.scale_=At.fromValues(g,v,A),this.dirty=!0)}translate(g=0,v=0,A=0){this.position_=At.fromValues(g,v,A),this.dirty=!0}rotate(g=0,v=0,A=0){const S=$t.degToRad(g),G=$t.degToRad(v),I=$t.degToRad(A);this.rotation_=At.fromValues(S,G,I),this.dirty=!0}get scale(){return[...this.scale_]}get position(){return[...this.position_]}get rotation(){return[...this.rotation_]}get forward(){const g=At.create(0,0,-1),v=Ct.fromEuler(this.rotation_[0],this.rotation_[1],this.rotation_[2],"xyz"),A=Q.fromQuat(v),S=At.transformMat4(g,A);return At.normalize(S)}get mvpMatrix(){return Q.copy(this.mvpMatrix_)}get modelMatrix(){return this.modelMatrix_}calculateMVPMatrix(g,v){return this.dirty?(Q.identity(this.modelMatrix_),Q.translate(this.modelMatrix_,this.position,this.modelMatrix_),Q.rotateX(this.modelMatrix_,this.rotation[0],this.modelMatrix_),Q.rotateY(this.modelMatrix_,this.rotation[1],this.modelMatrix_),Q.rotateZ(this.modelMatrix_,this.rotation[2],this.modelMatrix_),Q.scale(this.modelMatrix_,this.scale,this.modelMatrix_),Q.multiply(v,g,this.mvpMatrix_),Q.multiply(this.mvpMatrix_,this.modelMatrix_,this.mvpMatrix_),this.mvpMatrix_):this.mvpMatrix_}}const Qt=class Qt{constructor(g="New Entity"){P(this,"transform_",new Jn);P(this,"name","");Qt.id_++,this.name=g}get transform(){return this.transform_}get id(){return Qt.id_}};P(Qt,"id_",0);let Ht=Qt;class kn extends Ht{constructor(){super(...arguments);P(this,"pitchAngle",0);P(this,"yawAngle",0);P(this,"distance",6);P(this,"maxDist",100);P(this,"minDist",.5);P(this,"zoomSpeed",.01);P(this,"fov",60*Math.PI/180);P(this,"aspect",Nt.resolution.width/Nt.resolution.height);P(this,"near",.1);P(this,"far",1e3);P(this,"projectionMatrix",Q.perspective(this.fov,this.aspect,this.near,this.far));P(this,"up",At.fromValues(0,1,0));P(this,"viewMatrix",Q.identity())}set setFOV(v){this.fov=v*Math.PI/180}set setNear(v){this.near=Math.max(.001,v)}set setFar(v){this.far=Math.max(this.near+.001,v)}orbitEuler(v,A,S){const G=Q.identity();Q.rotateY(G,v,G),Q.rotateX(G,A,G),Q.translate(G,[0,0,S],G),this.viewMatrix=Q.invert(G)}orbitQuat(v,A,S){this.distance+=S*this.zoomSpeed,this.distance=Kn(this.distance,this.minDist,this.maxDist),this.yawAngle+=$t.degToRad(v),this.pitchAngle+=$t.degToRad(A);const G=Ct.fromAxisAngle(this.up,this.yawAngle),I=Ct.fromAxisAngle([1,0,0],this.pitchAngle),R=Ct.multiply(G,I),N=Q.fromQuat(R);Q.translate(N,[0,0,this.distance],N),this.viewMatrix=Q.invert(N),this.transform.rotate(this.pitchAngle,this.yawAngle,0),this.transform.translate(N[12],N[13],N[14])}update(){return[this.projectionMatrix,this.viewMatrix]}get shaderData(){const v=this.transform.forward,A=this.transform.position;return new Float32Array([v[0],v[1],v[2],0,A[0],A[1],A[2],0])}}class Cn{constructor(g){P(this,"canvas",null);P(this,"deltaX",0);P(this,"deltaY",0);P(this,"lastDeltaX",0);P(this,"lastDeltaY",0);P(this,"lastScrollDelta",0);P(this,"currentScrollDelta",0);P(this,"onMouseWheel",g=>{this.currentScrollDelta=g.deltaY});P(this,"onMouseDown",()=>{var g;(g=this.canvas)==null||g.requestPointerLock()});P(this,"onMouseMove",g=>{document.pointerLockElement===this.canvas&&(this.deltaX=g.movementX,this.deltaY=g.movementY)});P(this,"onMouseUp",()=>{document.exitPointerLock(),this.deltaX=0,this.deltaY=0});P(this,"update",()=>{this.deltaX===this.lastDeltaX&&this.deltaY===this.lastDeltaY&&(this.deltaX=0,this.deltaY=0),this.lastDeltaX=this.deltaX,this.lastDeltaY=this.deltaY,this.lastScrollDelta===this.currentScrollDelta&&(this.currentScrollDelta=0),this.lastScrollDelta=this.currentScrollDelta,requestAnimationFrame(this.update)});if(this.canvas=document.getElementById(g),!this.canvas){console.error("Could find Canvas to attach controls");return}this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseup",this.onMouseUp),this.canvas.addEventListener("mouseleave",this.onMouseUp),this.canvas.addEventListener("wheel",this.onMouseWheel,{passive:!0}),requestAnimationFrame(this.update)}get x(){return this.deltaX}get y(){return this.deltaY}get scrollDelta(){return this.currentScrollDelta}}class sn extends Ht{constructor(v=null,A="New Mesh"){super(A);P(this,"mesh_",null);this.setMesh(v)}get mesh(){return this.mesh_}setMesh(v){return this.mesh_=v,this.mesh_}get shaderData(){return Float32Array.of(...this.transform.mvpMatrix,...this.transform.modelMatrix)}}var en=(u=>(u[u.Directional=0]="Directional",u[u.Point=1]="Point",u))(en||{});const Yt=class Yt extends Ht{constructor(v={}){super();P(this,"type");P(this,"color");P(this,"intensity");P(this,"faloff");P(this,"radius");this.type=v.type??0,this.color=v.color??At.create(1,1,1),this.intensity=v.intensity??1,this.faloff=v.faloff??4,this.radius=v.radius??8}static get dirLightBuffer(){return Yt.dirLightBuffer_??Yt.generateBuffers()}static generateBuffers(){return Yt.dirLightBuffer_=H().createBuffer({size:16*2,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),Yt.dirLightBuffer_}get shaderData(){const v=this.transform.forward;return new Float32Array([v[0],v[1],v[2],this.intensity,this.color[0],this.color[1],this.color[2],0])}};P(Yt,"dirLightBuffer_");let Rt=Yt;const te=new Rt({type:en.Directional,intensity:0,color:At.create(0,0,0)}),on=new Map,ne=(u,g,v=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST)=>{if(on.has(u)){console.log("Buffer already exists");return}on.set(u,H().createBuffer({size:g,usage:v}))},Bn=u=>on.get(u),ee={name:"Global Uniforms",wgsl:`
        struct Uniforms {
            mvpMatrix: mat4x4f,
            modelMatrix: mat4x4f
        }
        @binding(0) @group(0) var<uniform> uniforms: Uniforms;
    `},se={name:"Directional Light Uniform",wgsl:`
    struct DirLight {
        forward: vec3f,
        intensity: f32,
        color: vec3f,
        pad0: f32
        };
        @group(0) @binding(1) var<uniform> dirLight: DirLight;
        `},oe={name:"Camera Uniforms",wgsl:`
        struct Camera {
            forward: vec3f,
            position: vec3f
        }
        @group(0) @binding(2) var<uniform> mainCam: Camera;
    `},ce={name:"Albedo Texture Sampler",wgsl:`
        @group(1) @binding(0) var albedoSampler: sampler;
        @group(1) @binding(1) var albedo: texture_2d<f32>;
    `};class re{constructor(){P(this,"context",null);P(this,"canvasFormat");P(this,"entityList",[]);P(this,"meshEntityList",[]);P(this,"lightEntityList",[]);P(this,"lastFrameMS",Date.now());P(this,"simpleOrbitCam");P(this,"input")}get dirLight(){return this.lightEntityList.find(g=>g.type===en.Directional)??te}async init(g){await Hn();const v=document.getElementById(g);if(v)v.width=Nt.resolution.width,v.height=Nt.resolution.height;else return;console.log("GPU Device initialized",H()),this.canvasFormat=navigator.gpu.getPreferredCanvasFormat(),this.input=new Cn("viewport"),this.context=v.getContext("webgpu"),this.context!=null&&(this.context.configure({device:H(),format:this.canvasFormat}),this.simpleOrbitCam=new kn,ne("camera",32))}renderFrame(){if(this.context==null)return;const g=Date.now(),v=(g-this.lastFrameMS)/1e3;this.lastFrameMS=g;const A=H().createCommandEncoder(),S=A.beginRenderPass({colorAttachments:[{view:this.context.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:Wn(),depthLoadOp:"clear",depthStoreOp:"store",stencilLoadOp:"clear",stencilStoreOp:"store",depthClearValue:1,stencilClearValue:0}});this.simpleOrbitCam.orbitQuat(this.input.x*v,this.input.y*v,this.input.scrollDelta);const[G,I]=this.simpleOrbitCam.update();It().writeBuffer(Rt.dirLightBuffer,0,this.dirLight.shaderData);const R=Bn("camera");R&&It().writeBuffer(R,0,this.simpleOrbitCam.shaderData);for(let k=0;k<this.meshEntityList.length;k++){const C=this.meshEntityList[k],F=C.mesh,b=F==null?void 0:F.material,Z=b==null?void 0:b.getPipeline;if(!F||!Z||!b.ready)continue;S.setPipeline(Z),C.transform.calculateMVPMatrix(I,G);const j=C.shaderData;It().writeBuffer(F.material.getMVPUniformBuffer,0,j.buffer,j.byteOffset,j.byteLength);const tt=F.material.getCommonBindGroup,nt=F.material.getMaterialBindGroup;S.setBindGroup(0,tt),S.setBindGroup(1,nt),S.setVertexBuffer(0,F.positionBuffer),S.setVertexBuffer(1,F.colorBuffer),S.setVertexBuffer(2,F.normalBuffer),S.setVertexBuffer(3,F.uvBuffer),S.setIndexBuffer(F.indexBuffer,"uint16"),S.drawIndexed(F.indexCount)}S.end();const N=A.finish();It().submit([N])}addEntity(g){g instanceof sn?this.meshEntityList.push(g):g instanceof Rt?this.lightEntityList.push(g):this.entityList.push(g)}}class vn{constructor(g,v,A=null,S=null,G){P(this,"positionBuffer");P(this,"colorBuffer");P(this,"indexBuffer");P(this,"normalBuffer");P(this,"uvBuffer");P(this,"positions");P(this,"colors");P(this,"indices");P(this,"normals");P(this,"uvs");P(this,"material_");P(this,"passIndex",0);this.positions=g,this.positionBuffer=H().createBuffer({label:"Positions",size:this.positions.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),It().writeBuffer(this.positionBuffer,0,this.positions),this.indices=v,this.indexBuffer=H().createBuffer({label:"Indices",size:v.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST}),It().writeBuffer(this.indexBuffer,0,v);let I=g.length/3;if(A===null){const R=new Float32Array(I*3);for(let N=0;N<I;N++)R[N*3]=1,R[N*3+1]=0,R[N*3+2]=1;this.colors=R}else this.colors=A;this.colorBuffer=H().createBuffer({label:"Colors",size:this.colors.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),It().writeBuffer(this.colorBuffer,0,this.colors),S===null?(console.log("No normals found!"),this.normals=new Float32Array(I*3).fill(0)):this.normals=S,this.normalBuffer=H().createBuffer({label:"Normals",size:this.normals.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),It().writeBuffer(this.normalBuffer,0,this.normals),G===null?this.uvs=new Float32Array(I*2).fill(0):this.uvs=G,this.uvBuffer=H().createBuffer({label:"UVs",size:this.uvs.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),It().writeBuffer(this.uvBuffer,0,this.uvs)}get material(){return this.material_}set material(g){this.material_=g}get indexCount(){return this.indices.length}}function ie(u){const g=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,1,1,-1,1,1,-1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1]),v=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),A=new Float32Array([0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0]),S=new Uint16Array([0,1,2,0,2,3,4,7,6,4,6,5,8,9,10,8,10,11,12,14,13,12,15,14,16,19,18,16,18,17,20,21,22,20,22,23]);return new vn(g,S,u,v,A)}class ae{static async loadFile(g){const v=await fetch(g);if(!v.ok)return Promise.reject(console.error(`Failed to load file:${v.statusText}`));const A=await v.json(),G=A.meshes[0].primitives[0],I=G.attributes.POSITION,R=A.accessors[I],N=A.bufferViews[R.bufferView],k=A.buffers[N.buffer],F=await(await fetch("./mesh/"+k.uri)).arrayBuffer(),b=N.byteOffset,Z=R.type==="VEC3"?3:2,j=new Float32Array(F,b,R.count*Z),tt=G.attributes.TEXCOORD_0,nt=A.accessors[tt],ct=A.bufferViews[nt.bufferView].byteOffset,et=2,St=new Float32Array(F,ct,nt.count*et),wt=G.attributes.NORMAL,rt=A.accessors[wt],dt=A.bufferViews[rt.bufferView].byteOffset,pt=3,W=new Float32Array(F,dt,rt.count*pt),mt=G.indices,E=A.accessors[mt],V=A.bufferViews[E.bufferView].byteOffset,Ut=new Uint16Array(F,V,E.count),st=new vn(j,Ut,null,W,St);return new Promise(Lt=>{Lt(st)})}}const ue=`struct VSOut {\r
    @builtin(position) Position: vec4f,\r
    @location(0) color: vec3f,\r
    @location(1) uv: vec2f,\r
    @location(2) outNrm: vec3f,\r
    @location(3) worldPos: vec3f\r
 };\r
\r
@vertex\r
fn main_vert(@location(0) inPos: vec4f,\r
        @location(1) inColor: vec3f,\r
        @location(2) inNrm: vec3f,\r
        @location(3) inUV: vec2f) -> VSOut {\r
    var vsOut: VSOut;\r
\r
    var col: vec4f;\r
    vsOut.uv = inUV;\r
    vsOut.Position =  uniforms.mvpMatrix * inPos;\r
    vsOut.color = col.xyz;\r
    vsOut.outNrm = inNrm;\r
    vsOut.worldPos = (inPos * uniforms.modelMatrix).xyz;\r
    return vsOut;\r
}\r
\r
`,fe=`@fragment\r
fn main_frag(\r
    @builtin(position) fragPos: vec4f,\r
    @location(0) vertColor: vec3f,\r
    @location(1) uv: vec2f,\r
    @location(2) fragNrm: vec3f,\r
    @location(3) worldPos: vec3f\r
    ) -> @location(0) vec4f {\r
        let ambient: vec3f = vec3f (0.06, 0.06, 0.06);\r
        var finalColor: vec4f;\r
\r
        let viewDir = normalize(mainCam.position - worldPos);\r
        let diffuse: vec3f = computeDiffuse(fragNrm, dirLight.forward, dirLight.color, dirLight.intensity);\r
\r
        let specular: f32 = computeSpecular(mainCam.forward, fragNrm, viewDir, 64);\r
\r
        finalColor = textureSample(albedo, albedoSampler, uv) * vec4f(diffuse + ambient, 1) + specular;\r
\r
        return finalColor;\r
}\r
`,le=`fn reflect(ray: vec3f, normal: vec3f) -> vec3f {\r
    let R = ray - 2 * dot(normal, ray) * normal;\r
    return normalize(R);\r
}\r
\r
fn computeDiffuse(normal: vec3f, lightDir: vec3f, lightColor: vec3f, intensity: f32) -> vec3f {\r
    let N = normalize(normal);\r
    let L = normalize(lightDir);\r
    let lightMagnitude = dot(N, -L);\r
    let diffuseFinal = intensity * saturate(lightMagnitude) * lightColor;\r
    return diffuseFinal;\r
}\r
\r
fn computeSpecular(viewDir: vec3f, normal: vec3f, lightDir: vec3f, exponent: f32) -> f32 {\r
    let N = normalize(normal);\r
    let L = normalize(lightDir);\r
    let V = normalize(viewDir);\r
\r
    let R = reflect(N, -L);\r
    let specBase = saturate(dot(R, V));\r
    return pow(specBase, exponent);\r
}\r
\r
`;class he{constructor(g,v,A){P(this,"pipeline");P(this,"assembledShaderModule");P(this,"vertexCode","");P(this,"fragmentCode","");P(this,"properties");P(this,"MVPUniformBuffer");P(this,"commonBindGroup");P(this,"materialBindGroup");P(this,"lightsBindGroup");P(this,"generateStates",()=>{const g={arrayStride:12,attributes:[{format:"float32x3",offset:0,shaderLocation:0}]},v={arrayStride:3*4,attributes:[{format:"float32x3",offset:0,shaderLocation:1}]},A={arrayStride:3*4,attributes:[{shaderLocation:2,format:"float32x3",offset:0}]},S={arrayStride:2*4,attributes:[{shaderLocation:3,format:"float32x2",offset:0}]},G={module:this.assembledShaderModule,entryPoint:"main_vert",buffers:[g,v,A,S]},I={module:this.assembledShaderModule,entryPoint:"main_frag",targets:[{format:"bgra8unorm"}]};return[G,I]});this.properties=g,this.fragmentCode=A,this.vertexCode=v,this.compileShader(),this.generatePipeline(),this.generateCommonBindGroup(),this.generateMaterialBindGroup()}get getPipeline(){return this.pipeline}get getMVPUniformBuffer(){return this.MVPUniformBuffer}get getCommonBindGroup(){return this.commonBindGroup}get getMaterialBindGroup(){return this.materialBindGroup}get getLightsBindGroup(){return this.lightsBindGroup}get ready(){return this.commonBindGroup!=null&&this.materialBindGroup!=null}async setTexture(g,v){const A=await mn(v),S=H().createTexture({size:[A.width,A.height],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});this.properties.textures[g]={image:A,textureHandle:S,uri:v},this.generateMaterialBindGroup(),A.close()}async generateCommonBindGroup(){this.MVPUniformBuffer=H().createBuffer({size:4*16*2,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const g=Bn("camera");if(g)this.commonBindGroup=H().createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.MVPUniformBuffer}},{binding:1,resource:{buffer:Rt.dirLightBuffer}},{binding:2,resource:{buffer:g}}]});else throw new Error("Camera buffer not initialized")}async generateMaterialBindGroup(){Object.entries(this.properties.textures).forEach(([g,v])=>{const A=v;H().queue.copyExternalImageToTexture({source:A.image},{texture:A.textureHandle},[A.image.width,A.image.height]);const S=A.textureHandle.createView(),G=H().createSampler({magFilter:"linear",minFilter:"linear"});this.materialBindGroup=H().createBindGroup({layout:this.pipeline.getBindGroupLayout(1),entries:[{binding:0,resource:G},{binding:1,resource:S}]})})}generatePipeline(){const g=H().createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),v=H().createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{type:"filtering"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}}]}),[A,S]=this.generateStates(),I={layout:H().createPipelineLayout({bindGroupLayouts:[g,v]}),vertex:A,fragment:S,primitive:Zn,depthStencil:bn};this.pipeline=H().createRenderPipeline(I)}compileShader(){const g=`
        ${ee.wgsl}
        ${se.wgsl}
        ${oe.wgsl}
        ${ce.wgsl}

        ${le}

        ${this.vertexCode}
        
        ${this.fragmentCode}
        `;try{this.assembledShaderModule=H().createShaderModule({code:g})}catch(v){console.error(v)}}}const gn=async()=>{const u=await mn("uv1.png"),g=H().createTexture({size:[u.width,u.height],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),v={textures:{albedo:{image:u,uri:"uv1.png",textureHandle:g}},scalars:{baseColor:At.fromValues(1,1,1)}};return new he(v,ue,fe)},Xt=new re,we=async()=>{await Xt.init("viewport");const u=ie(),g=new sn(u);u.material=await gn(),u.material.setTexture("albedo","./test.jpg"),g.transform.translate(3.5,0,1),Xt.addEntity(g);const v=await ae.loadFile("./mesh/octo.gltf"),A=new sn(v),S=A.mesh;S.material=await gn(),await S.material.setTexture("albedo","./mesh/octo.png"),A.transform.setScale(3,3,3),A.transform.translate(0,0,0),Xt.addEntity(A);const G=new Rt({type:en.Directional,intensity:1,color:At.create(1,1,0)});G.transform.rotate(45,45,0),Xt.addEntity(G)},de=async()=>{await we();let u=performance.now();const g=()=>{performance.now()-u,u=performance.now(),Xt.renderFrame(),requestAnimationFrame(g)};g()};de();
